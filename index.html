<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <meta name="googlebot" content="noindex, nofollow">

    <title>Flux Modeler</title>

    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 511.987 511.987'><rect x='66.717' y='204.027' transform='matrix(-0.2411 -0.9705 0.9705 -0.2411 -177.6681 420.4137)' fill='%23B6F2FC' width='17.648' height='151.29'/><polygon fill='%238ED7E0' points='235.67,98.502 417.524,413.484 53.815,413.484'/><polygon fill='%23F4BD64' points='511.987,268.44 511.987,315.737 368.184,337.491 344.872,329.255 296.635,235.133'/><polygon fill='%234EB79B' points='511.987,315.737 511.987,363.022 384.886,356.939 384.874,356.939 344.872,329.255 356.814,308.325'/><polygon fill='%23E88158' points='511.987,221.156 511.987,268.44 328.73,259.687 276.634,248.075 300.658,211.061'/><polygon fill='%23B6F2FC' points='384.874,356.939 385.874,358.669 113.88,263.558 300.658,211.061 328.73,259.687 356.802,308.325 356.814,308.325'/></svg>">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="stylesheet" href="styles.css">

    <style>
        /* Password Manager Prevention */
        input[type="password"],
        input[type="text"],
        input[type="email"],
        input[type="tel"],
        input[type="url"],
        textarea,
        select {
            -webkit-text-security: none !important;
            -webkit-appearance: none !important;
            -moz-appearance: none !important;
            appearance: none !important;
        }

        /* Hide password manager overlays and suggestions */
        div[data-lastpass],
        div[data-dashlane],
        div[data-bitwarden],
        div[data-keeper],
        div[data-roboform],
        div[data-1password],
        div[data-password-manager],
        .password-manager-overlay,
        .password-suggestion,
        .autocomplete-suggestion,
        .password-autofill {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            pointer-events: none !important;
        }

        /* Prevent password manager icons and buttons */
        input::-webkit-credentials-auto-fill-button,
        input::-webkit-contacts-auto-fill-button,
        input::-webkit-credit-card-auto-fill-button {
            display: none !important;
            visibility: hidden !important;
        }

        /* Additional password manager prevention */
        input:-webkit-autofill,
        input:-webkit-autofill:hover,
        input:-webkit-autofill:focus,
        input:-webkit-autofill:active {
            -webkit-box-shadow: 0 0 0 1000px white inset !important;
            -webkit-text-fill-color: inherit !important;
            transition: background-color 5000s ease-in-out 0s !important;
        }

        #render-container {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            display: grid;
            grid-template-columns: 1fr;
            grid-template-rows: 1fr;
            background-color: var(--bg-main);
        }

        #render-container.quad-view-active {
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 2px;
            background-color: var(--text-secondary);
        }

        .label-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
        }

        .viewport {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
            border: 1px solid var(--grid-color);
            box-sizing: border-box;
            /* Important for grid layout with borders */
            pointer-events: auto;
            /* Make sure the viewport divs can receive mouse events */
        }

        .viewport canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100% !important;
            height: 100% !important;
        }

        /* Hide the extra viewports by default */
        #viewport-top,
        #viewport-front,
        #viewport-side {
            display: none;
        }

        /* Show them when quad view is active */
        #render-container.quad-view-active>.viewport {
            display: block;
        }

        .viewport-label {
            position: absolute;
            top: 8px;
            left: 8px;
            color: var(--text-primary);
            background-color: rgba(0, 0, 0, 0.4);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
            pointer-events: none;
            z-index: 1;
        }

        /* Only move the top-row viewport labels down when the top bar is docked */
        body.top-sidebar-docked #viewport-main .viewport-label,
        body.top-sidebar-docked #viewport-top .viewport-label {
            top: 56px;
            /* Adjust to be below the docked top toolbar */
        }

        /* Helios Mode Toggle Styles */
        #helios-mode-toggle:checked+div .dot {
            transform: translateX(32px);
        }

        #helios-mode-toggle:checked+div+div .generator-label {
            display: none;
        }

        #helios-mode-toggle:checked+div+div .ep-label {
            display: inline;
        }

        #helios-mode-toggle:not(:checked)+div+div .generator-label {
            display: inline;
        }

        #helios-mode-toggle:not(:checked)+div+div .ep-label {
            display: none;
        }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
</head>

<body autocomplete="off">
    <div id="welcome-screen" autocomplete="off">
        <div id="glow-portal"></div>
        <canvas id="glow-canvas"></canvas>
        <div class="welcome-content">
            <div class="welcome-header">
                <div id="welcome-logo-container">
                    <svg id="welcome-logo-light" class="welcome-logo" xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 511.987 511.987" xml:space="preserve">
                        <rect x="75" y="95" width="320" height="320" style="fill:#858585" />
                        <rect x="76" y="155" width="319" height="200" style="fill:#cccccc" />
                        <path transform="rotate(256.049 75.54 279.672)" style="fill:#cccccc"
                            d="M66.717 204.027h17.648v151.29H66.717z" />
                        <rect x="395" y="170" width="117" height="60" style="fill:#fa2c15" />
                        <rect x="395" y="230" width="117" height="60" style="fill:#ffbf00" />
                        <rect x="395" y="290" width="117" height="55" style="fill:#3b82f6" />
                    </svg>
                    <svg id="welcome-logo-dark" class="welcome-logo" xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 511.987 511.987" xml:space="preserve">
                        <rect x="75" y="95" width="320" height="320" style="fill:#bdbdbd" />
                        <rect x="76" y="155" width="319" height="200" style="fill:#616161" />
                        <path transform="rotate(256.049 75.54 279.672)" style="fill:#616161"
                            d="M66.717 204.027h17.648v151.29H66.717z" />
                        <rect x="395" y="170" width="117" height="60" style="fill:#fa2c15" />
                        <rect x="395" y="230" width="117" height="60" style="fill:#ffff00" />
                        <rect x="395" y="290" width="117" height="55" style="fill:#3b82f6" />
                    </svg>
                    <svg id="welcome-logo-cyber" class="welcome-logo" xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 511.987 511.987" xml:space="preserve">
                        <rect x="75" y="95" width="320" height="320" style="fill:#11215e" />
                        <rect x="76" y="155" width="319" height="200" style="fill:#4d8bee" />
                        <path transform="rotate(256.049 75.54 279.672)" style="fill:#4d8bee"
                            d="M66.717 204.027h17.648v151.29H66.717z" />
                        <rect x="395" y="170" width="117" height="60" style="fill:#ff2e97" />
                        <rect x="395" y="230" width="117" height="60" style="fill:#ffd400" />
                        <rect x="395" y="290" width="117" height="55" style="fill:#00f6ff" />
                    </svg>
                    <svg id="welcome-logo-cafe58" class="welcome-logo" xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 511.987 511.987" xml:space="preserve">
                        <rect x="75" y="95" width="320" height="320" style="fill:#26303D" />
                        <rect x="76" y="155" width="319" height="200" style="fill:#707C8A" />
                        <path transform="rotate(256.049 75.54 279.672)" style="fill:#707C8A"
                            d="M66.717 204.027h17.648v151.29H66.717z" />
                        <rect x="395" y="170" width="117" height="60" style="fill:#5a687a" />
                        <rect x="395" y="230" width="117" height="60" style="fill:#FFA518" />
                        <rect x="395" y="290" width="117" height="55" style="fill:#FF6D1D" />
                    </svg>
                </div>
                <div class="welcome-text-container">
                    <h1 class="welcome-title">Flux Modeler</h1>
                </div>
            </div>
            <p class="welcome-subheader">Your AI Assistant for Building Energy Simulation</p>
            <p class="welcome-description text-center max-w-lg text-lg text-[--text-secondary]">
                Choose how you'd like to begin your energy modeling project. You can start with a predefined parametric
                shape
                or import your own custom model.</p>
            <div class="welcome-options">
                <button id="start-with-shoebox" class="welcome-option-card">
                    <svg xmlns="http://www.w3.org/2000/svg" class="option-icon" viewBox="0 0 100 100"
                        fill="currentColor">
                        <path
                            d="M94.924 5.62A1 1 0 0 0 94 5H30a1 1 0 0 0-.707.293l-24 24A1 1 0 0 0 5 30v64a1 1 0 0 0 1 1h64l.01-.002a1 1 0 0 0 .697-.29l24-24A1 1 0 0 0 95 70V6a1 1 0 0 0-.076-.38M29.07 8.344A.995.995 0 0 0 31 8V7h60.586l-22 22H8.414ZM8.3 93A1 1 0 0 0 7 91.7V31h22v1a1 1 0 0 0 2 0v-1h38v38h-1a1 1 0 0 0 0 2h1v22ZM71 30.414l22-22V69h-1a.995.995 0 0 0-.345 1.93L71 91.586Z" />
                        <path
                            d="M30 61a1 1 0 0 0-1 1v2a1 1 0 0 0 2 0v-2a1 1 0 0 0-1-1m0-8a1 1 0 0 0-1 1v2a1 1 0 0 0 2 0v-2a1 1 0 0 0-1-1m0-36a1 1 0 0 0 1-1v-2a1 1 0 0 0-2 0v2a1 1 0 0 0 1 1m0 28a1 1 0 0 0-1 1v2a1 1 0 0 0 2 0v-2a1 1 0 0 0-1-1m1-21v-2a1 1 0 0 0-2 0v2a1 1 0 0 0 2 0m-1 13a1 1 0 0 0-1 1v2a1 1 0 0 0 2 0v-2a1 1 0 0 0-1-1m24 32h-2a1 1 0 0 0 0 2h2a1 1 0 0 0 0-2m8 0h-2a1 1 0 0 0 0 2h2a1 1 0 0 0 0-2m16 0h-2a1 1 0 0 0 0 2h2a1 1 0 0 0 0-2m8 0h-2a1 1 0 0 0 0 2h2a1 1 0 0 0 0-2m-40 0h-2a1 1 0 0 0 0 2h2a1 1 0 0 0 0-2m-8 0h-2a1 1 0 0 0 0 2h2a1 1 0 0 0 0-2m-7.077.618a1 1 0 0 0-1.626-.328l-.004.003-1.414 1.414a1 1 0 1 0 1.414 1.414l1.414-1.414a1 1 0 0 0 .216-1.09m-7.287 5.333-1.414 1.414a1 1 0 0 0 1.414 1.414l1.414-1.414a1 1 0 0 0-1.414-1.414m-5.656 5.657-1.415 1.414a1 1 0 0 0 1.414 1.414l1.414-1.414a1 1 0 0 0-1.414-1.414m-5.657 5.656-1.414 1.415a1 1 0 0 0 1.414 1.414l1.414-1.414a1 1 0 1 0-1.414-1.415" />
                    </svg>
                    <div class="option-text-wrapper">
                        <h3 class="option-title">Parametric Model</h3>
                        <p class="option-description">Start with a customizable box shape.</p>
                    </div>
                </button>
                <button id="start-with-import" class="welcome-option-card">
                    <svg xmlns="http://www.w3.org/2000/svg" class="option-icon" viewBox="0 0 24 24" fill="none">
                        <rect x="5" y="15" width="14" height="4" rx="2" fill="currentColor" fill-opacity=".24" />
                        <path
                            d="m12 14-.424.424.424.425.424-.425zm.6-9a.6.6 0 1 0-1.2 0zM6.576 9.424l5 5 .848-.848-5-5zm5.848 5 5-5-.848-.848-5 5zM12.6 14V5h-1.2v9z"
                            fill="currentColor" />
                        <path d="M5 16v1a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-1" stroke="currentColor" stroke-width="1.2" />
                    </svg>
                    <div class="option-text-wrapper">
                        <h3 class="option-title">Import Model</h3>
                        <p class="option-description">Bring in your own .obj file.</p>
                    </div>
                </button>
                <button id="start-with-draw" class="welcome-option-card">
                    <svg xmlns="http://www.w3.org/2000/svg" class="option-icon" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" />
                    </svg>
                    <div class="option-text-wrapper">
                        <h3 class="option-title">Draw Model</h3>
                        <p class="option-description">Draw your geometry from scratch.</p>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <div id="render-container">
        <div id="viewport-main" class="viewport">
            <div class="viewport-label">Perspective</div>
            <div class="label-container"></div>
        </div>
        <div id="viewport-top" class="viewport">
            <div class="viewport-label">Top</div>
            <div class="label-container"></div>
        </div>
        <div id="viewport-front" class="viewport">
            <div class="viewport-label">Front</div>
            <div class="label-container"></div>
        </div>
        <div id="viewport-side" class="viewport">
            <div class="viewport-label">Right</div>
            <div class="label-container"></div>
        </div>
    </div>
    <div id="toggle-buttons-container"
        class="absolute top-1/2 -translate-y-1/2 left-4 z-50 pointer-events-auto flex flex-col gap-4">
        <button id="toggle-buttons-btn" class="btn" aria-label="Toggle Buttons">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="1" />
            </svg>
        </button>
    </div>
    </div>
    <div id="left-controls-container"
        class="absolute top-1/2 -translate-y-1/2 left-4 z-50 pointer-events-auto flex flex-col gap-4">
        <div class="action-button-container self-center mb-1">
            <button id="dock-left-sidebar-btn"
                class="btn btn-icon p-1 bg-[--panel-bg] hover:bg-[--grid-color] rounded-full"
                aria-label="Dock Left Sidebar">
                <svg class="dock-icon-undocked" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none"
                    viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M14.25 2.25c-1.32.09-2.6.48-3.83.99l-3.82 2.01a1.5 1.5 0 0 0-.8 1.34v7.32a1.5 1.5 0 0 0 .8 1.34l3.82 2.01c1.23.51 2.51.9 3.83.99m8.25-10.5h-9m9 0c.93 0 1.69.76 1.69 1.69v5.62c0 .93-.76 1.69-1.69 1.69h-9" />
                </svg>
                <svg class="dock-icon-docked hidden" xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                    viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M14.25 2.25c-1.32.09-2.6.48-3.83.99l-3.82 2.01a1.5 1.5 0 0 0-.8 1.34v7.32a1.5 1.5 0 0 0 .8 1.34l3.82 2.01c1.23.51 2.51.9 3.83.99m8.25-10.5h-9m9 0c.93 0 1.69.76 1.69 1.69v5.62c0 .93-.76 1.69-1.69 1.69h-9" />
                </svg>
            </button>
            <span class="tooltip" role="tooltip">Dock Sidebar</span>
        </div>
        <div id="left-toolbar" class="ui-panel p-1">
            <div class="btn-group flex-col">
                <div class="action-button-container">
                    <button id="toggle-panel-project-btn" class="btn" aria-label="Project Setup">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 567.917 567.917" xml:space="preserve"
                            fill="currentColor" stroke="none">
                            <path
                                d="M32.902 161.491h502.106l4.302-35.974c1.004-8.39-5.033-15.192-13.482-15.192H287.017c-8.448 0-21.019-3.767-28.075-8.415l-46.175-30.417c-7.056-4.648-19.627-8.415-28.079-8.415H35.109c-8.449 0-14.397 6.79-13.284 15.166zm32.547 328.412c1.833 8.25 10.168 14.936 18.62 14.936h399.777c8.448 0 16.787-6.686 18.62-14.936l65.092-292.913c1.833-8.25-3.531-14.936-11.979-14.936H12.339c-8.449 0-13.813 6.686-11.98 14.936z" />
                        </svg>
                    </button>
                    <span class="tooltip" role="tooltip">Project Setup</span>
                </div>
                <div class="action-button-container">
                    <button id="toggle-panel-dimensions-btn" class="btn" aria-label="Dimensions">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" xml:space="preserve">
                            <path
                                d="M160 213.333c-5.888 0-10.667-4.779-10.667-10.667H0v202.667C0 411.221 4.779 416 10.667 416h330.667v-85.333c-5.888 0-10.667-4.779-10.667-10.667s4.779-10.667 10.667-10.667V202.667H170.667c0 5.888-4.779 10.666-10.667 10.666m-10.667 32c0-5.888 4.779-10.667 10.667-10.667s10.667 4.779 10.667 10.667v21.333c0 5.888-4.779 10.667-10.667 10.667s-10.667-4.779-10.667-10.667zM46.592 398.507l-9.216 5.376a10.64 10.64 0 0 1-5.355 1.451 10.66 10.66 0 0 1-9.216-5.291c-2.965-5.077-1.259-11.605 3.84-14.592l9.216-5.376c5.099-2.965 11.627-1.259 14.592 3.84 2.923 5.077 1.216 11.626-3.861 14.592m65.749-38.336L90.432 372.95a10.64 10.64 0 0 1-5.355 1.451 10.72 10.72 0 0 1-9.237-5.291c-2.965-5.099-1.237-11.627 3.84-14.592l21.909-12.779c5.099-2.944 11.627-1.237 14.592 3.84 2.944 5.077 1.238 11.626-3.84 14.592m164.992-50.838h21.333c5.888 0 10.667 4.779 10.667 10.667s-4.779 10.667-10.667 10.667h-21.333c-5.888 0-10.667-4.779-10.667-10.667s4.779-10.667 10.667-10.667m-64 0h21.333c5.888 0 10.667 4.779 10.667 10.667s-4.779 10.667-10.667 10.667h-21.333c-5.888 0-10.667-4.779-10.667-10.667s4.779-10.667 10.667-10.667M181.355 320c0 5.888-4.8 10.667-10.688 10.667h-7.787l-6.72 3.925a10.64 10.64 0 0 1-5.355 1.451 10.66 10.66 0 0 1-9.216-5.291c-2.965-5.077-1.259-11.605 3.84-14.592l3.925-2.283v-4.544c0-5.888 4.779-10.667 10.667-10.667s10.667 4.779 10.667 10.667c5.888 0 10.667 4.779 10.667 10.667m181.312-121.771v111.104c5.888 0 10.667 4.779 10.667 10.667s-4.779 10.667-10.667 10.667v80.853l143.957-82.261A10.67 10.67 0 0 0 512 320V114.24zm64 132.438h-21.333c-5.888 0-10.667-4.779-10.667-10.667s4.779-10.667 10.667-10.667h21.333c5.888 0 10.667 4.779 10.667 10.667s-4.779 10.667-10.667 10.667m53.333 0h-10.667c-5.888 0-10.667-4.779-10.667-10.667s4.779-10.667 10.667-10.667H480c5.888 0 10.667 4.779 10.667 10.667s-4.779 10.667-10.667 10.667M160 96c-1.856 0-3.669.491-5.291 1.408L7.829 181.333h141.504c0-5.888 4.779-10.667 10.667-10.667s10.667 4.779 10.667 10.667h178.539L500.907 96zm10.667 42.667c0 5.888-4.779 10.667-10.667 10.667s-10.667-4.779-10.667-10.667V128c0-5.888 4.779-10.667 10.667-10.667s10.667 4.779 10.667 10.667z" />
                        </svg>
                    </button>
                    <span class="tooltip" role="tooltip">Dimensions & Geometry</span>
                </div>
                <div class="action-button-container">
                    <button id="toggle-panel-aperture-btn" class="btn" aria-label="Apertures">
                        <svg viewBox="0 0 51 51" xmlns="http://www.w3.org/2000/svg" fill="currentColor" stroke="none">
                            <path
                                d="m8.375 8 .098.098L8.57 8zm3.117 0L9.934 9.559l1.46 1.46L14.413 8zm5.842 0-4.479 4.48 1.46 1.46L20.254 8zm5.844 0-7.403 7.4 1.461 1.461L26.1 8zm5.84 0-10.32 10.322 1.46 1.461L31.94 8Zm5.843 0L21.62 21.244l1.46 1.46L37.782 8Zm5.844 0L24.54 24.164 26 25.625l17-17V8zM27.461 27.086 11.547 43h2.922l14.453-14.453Zm2.92 2.92L17.387 43h2.922l11.533-11.533Zm2.922 2.922L23.23 43h2.922l8.612-8.611zm2.922 2.922L29.075 43h2.921l5.69-5.69zm2.92 2.92L34.915 43h2.92l2.77-2.77zm2.921 2.921L40.758 43H43v-.375z" />
                            <path d="m8 7.625 18 18-18 18z" />
                            <path d="M4 4v43h43V4Zm4 4h35v35H8Z" />
                        </svg>
                    </button>
                    <span class="tooltip" role="tooltip">Apertures</span>
                </div>

                <div class="action-button-container">
                    <button id="toggle-panel-shading-btn" class="btn" aria-label="Shading & Solar Control">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="3" y1="9" x2="21" y2="9"></line>
                            <line x1="9" y1="21" x2="9" y2="9"></line>
                        </svg>
                    </button>
                    <span class="tooltip" role="tooltip">Shading & Solar Control</span>
                </div>


                <div class="action-button-container">
                    <button id="btn-open-materials-panel" class="btn" aria-label="Materials & Constructions">
                        <svg viewBox="0 0 52 52" xmlns="http://www.w3.org/2000/svg" fill="currentColor" stroke="none">
                            <path
                                d="m35.435 9.494 7.071 7.071.002-.002a4 4 0 0 1 0 5.657l-.002.002L24 40.703V15.264l5.777-5.771h.001a4 4 0 0 1 5.656.002zM50 36v10a4 4 0 0 1-4 4H21l18-18h7a4 4 0 0 1 4 4M2 41.046V6a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4v35.046a9 9 0 0 1-18 0M11 45a4 4 0 1 0 0-8 4 4 0 0 0 0 8" />
                        </svg>
                    </button>
                    <span class="tooltip" role="tooltip">Materials & Constructions</span>
                </div>

                <div class="action-button-container">
                    <button id="toggle-panel-schedules-btn" class="btn" aria-label="Schedules">
                        <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" fill="currentColor">
                            <path
                                d="M928 224H768v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56H548v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56H328v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56H96c-17.7 0-32 14.3-32 32v576c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V256c0-17.7-14.3-32-32-32M424 688c0 4.4-3.6 8-8 8H232c-4.4 0-8-3.6-8-8v-48c0-4.4 3.6-8 8-8h184c4.4 0 8 3.6 8 8zm0-136c0 4.4-3.6 8-8 8H232c-4.4 0-8-3.6-8-8v-48c0-4.4 3.6-8 8-8h184c4.4 0 8 3.6 8 8zm374.5-91.3-165 228.7a15.9 15.9 0 0 1-25.8 0L493.5 531.2c-3.8-5.3 0-12.7 6.5-12.7h54.9c5.1 0 9.9 2.5 12.9 6.6l52.8 73.1 103.7-143.7c3-4.2 7.8-6.6 12.9-6.6H792c6.5.1 10.3 7.5 6.5 12.8" />
                        </svg>
                    </button>
                    <span class="tooltip" role="tooltip">Schedules</span>
                </div>

                <div class="action-button-container">
                    <button id="toggle-panel-thermostats-btn" class="btn" aria-label="Thermostats & IdealLoads">
                        <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" fill="currentColor">
                            <path
                                d="M30.381 14.757c-11.967 0-21.668 9.681-21.668 21.621C8.713 48.32 18.414 58 30.381 58s21.666-9.68 21.666-21.622c0-11.94-9.699-21.621-21.666-21.621m1.286 18.828a1.285 1.285 0 0 1-2.572 0v-14.3a1.287 1.287 0 0 1 2.572 0z" />
                            <path
                                d="M59.912 25.526a30.9 30.9 0 0 0-10.499-13.738A29.8 29.8 0 0 0 33.02 6.027a29.6 29.6 0 0 0-16.88 4.461c-5.012 3.129-9.07 7.78-11.504 13.226-2.434 5.396-3.205 11.557-2.216 17.44.661 4.018 2.194 7.893 4.418 11.331h2.968c-2.12-3.169-3.578-6.778-4.218-10.503-.86-4.94-.328-10.129 1.512-14.709a26.3 26.3 0 0 1 9.055-11.597c4.039-2.913 8.917-4.558 13.816-4.692a24.46 24.46 0 0 1 13.958 3.876c4.145 2.662 7.416 6.594 9.311 11.018 1.957 4.518 2.466 9.543 1.594 14.291a24.07 24.07 0 0 1-6.32 12.315h9.299a31.3 31.3 0 0 0 3.646-9.815c1.067-5.696.558-11.694-1.547-17.143" />
                        </svg>
                    </button>
                    <span class="tooltip" role="tooltip">Thermostats & IdealLoads</span>
                </div>

                <div class="action-button-container">
                    <button id="toggle-panel-zone-loads-btn" class="btn" aria-label="Zone Loads">
                        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg"
                            xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 227.772 227.772"
                            style="enable-background:new 0 0 227.772 227.772;" xml:space="preserve" fill="currentColor">
                            <path d="M214.198,63.824h-53.148c0.681-1,1.222-1.492,1.56-1.821c6.936-6.731,10.307-14.738,10.307-24.456
	c0-8.375-3.333-16.01-9.387-21.488c-5.776-5.229-13.581-8.112-21.974-8.112s-16.197,2.879-21.974,8.108
	c-6.054,5.479-9.388,13.108-9.388,21.483c0,14.259,7.92,21.993,10.521,24.528c0.328,0.319,0.846,0.758,1.497,1.758H68.914
	c-7.716,0-14.143,6.238-14.143,13.954v42.734c0-0.389-0.658-0.711-0.879-0.938c-6.731-6.936-14.645-10.307-24.363-10.307
	c-8.375,0-15.963,3.333-21.442,9.387C2.859,124.432,0,132.236,0,140.629s2.89,16.197,8.12,21.974
	c5.479,6.054,13.114,9.388,21.489,9.388c14.259,0,21.811-7.92,24.345-10.521c0.212-0.217,0.819-0.518,0.819-0.88v45.122
	c0,7.716,6.427,14.113,14.143,14.113h145.283c7.716,0,13.574-6.397,13.574-14.113V77.778
	C227.772,70.062,221.913,63.824,214.198,63.824z M101.937,197.824l5.913-57h22.396c-10.887-5-18.558-15.095-18.558-27.459
	c0-16.323,13.371-29.608,29.868-29.608c16.495,0,29.867,13.309,29.867,29.633c0,12.365-7.672,22.435-18.558,27.435h22.396l5.913,57
	H101.937z" />
                        </svg>
                    </button>
                    <span class="tooltip" role="tooltip">Zone Loads</span>
                </div>

                <div class="action-button-container">
                    <button id="toggle-panel-airflow-btn" class="btn" aria-label="Outdoor Air & Ventilation">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path
                                d="M9.59 4.59A2 2 0 1 1 11 8H2m10.59 11.41A2 2 0 1 0 14 16H2m15.73-8.27A2.5 2.5 0 1 1 19.5 12H2" />
                        </svg>
                    </button>
                    <span class="tooltip" role="tooltip">Outdoor Air & Ventilation</span>
                </div>

                <div class="action-button-container">
                    <button id="toggle-panel-daylighting-btn" class="btn" aria-label="Daylighting">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 72.668 72.668" xml:space="preserve"
                            fill="currentColor">
                            <path
                                d="M0 36.334c0 20.034 16.299 36.334 36.334 36.334s36.334-16.3 36.334-36.334S56.369 0 36.334 0 0 16.3 0 36.334M23.163 6.195c12.94-8.23 31.183-2.797 40.666 12.111C73.31 33.213 70.5 52.039 57.56 60.269 44.621 68.5 26.376 63.068 16.893 48.161c-9.481-14.908-6.669-33.735 6.27-41.966" />
                        </svg>
                    </button>
                    <span class="tooltip" role="tooltip">Daylighting</span>
                </div>






                <div class="w-full my-1 border-t border-[--grid-color]"></div>

                <div class="action-button-container">
                    <button id="toggle-panel-checklist-btn" class="btn" aria-label="Simulation Checklist">
                        <svg viewBox="0 0 32 32" data-name="Layer 1" id="Layer_1" xmlns="http://www.w3.org/2000/svg"
                            fill="currentColor">
                            <path
                                d="M9.22,12.38,5.92,16.5,3.71,14.29a1,1,0,0,0-1.42,1.42l3,3A1,1,0,0,0,6,19h.06a1,1,0,0,0,.72-.38l4-5a1,1,0,1,0-1.56-1.24Z" />
                            <path
                                d="M9.22,2.38,5.92,6.5,3.71,4.29A1,1,0,0,0,2.29,5.71l3,3A1,1,0,0,0,6,9h.06a1,1,0,0,0,.72-.38l4-5A1,1,0,1,0,9.22,2.38Z" />
                            <path d="M14,7H29a1,1,0,0,0,0-2H14a1,1,0,0,0,0,2Z" />
                            <path d="M29,15H14a1,1,0,0,0,0,2H29a1,1,0,0,0,0-2Z" />
                            <path d="M29,25H14a1,1,0,0,0,0,2H29a1,1,0,0,0,0-2Z" />
                            <path
                                d="M9.71,21.29a1,1,0,0,0-1.42,0L6,23.59l-2.29-2.3a1,1,0,0,0-1.42,1.42L4.59,25l-2.3,2.29a1,1,0,0,0,0,1.42,1,1,0,0,0,1.42,0L6,26.41l2.29,2.3a1,1,0,0,0,1.42,0,1,1,0,0,0,0-1.42L7.41,25l2.3-2.29A1,1,0,0,0,9.71,21.29Z" />
                        </svg>
                    </button>
                    <span class="tooltip" role="tooltip">Simulation Checklist</span>
                </div>

                <div class="action-button-container">
                    <button id="toggle-panel-run-btn" class="btn" aria-label="Run Simulation">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polygon points="5 3 19 12 5 21 5 3"></polygon>
                        </svg>
                    </button>
                    <span class="tooltip" role="tooltip">Run Simulation</span>
                </div>




                <div class="action-button-container">
                    <button id="toggle-analysis-btn" class="btn" aria-label="Analysis">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 495.421 495.421" xml:space="preserve"
                            fill="currentColor" stroke="none">
                            <path
                                d="M490.531 188.099a7.27 7.27 0 0 0-8.089 2.393l-85.909 110.192a15.1 15.1 0 0 1-14.407 5.619l-93.674-15.672c-4.783-.8-9.668.742-13.123 4.159l-85.609 84.633a15.1 15.1 0 0 1-9.148 4.291l-111.28 10.993a15.14 15.14 0 0 0-9.523 4.679L2.414 460.344a8.85 8.85 0 0 0-1.685 9.589 8.87 8.87 0 0 0 8.138 5.339h468.591c9.924 0 17.963-8.036 17.963-17.957V194.956a7.25 7.25 0 0 0-4.89-6.857M29.334 275.472c4.504 0 8.978-1.782 12.312-5.314l24.096-25.411c3.535 1.03 7.229 1.758 11.093 1.758 18.997 0 34.859-13.296 39.018-31.04l38.148-3.762c6.584 13.213 20.086 22.397 35.833 22.397 22.116 0 40.138-18.007 40.138-40.141 0-4.952-1.02-9.648-2.669-14.03l34.049-33.384c5.579 2.947 11.833 4.771 18.567 4.771 14.987 0 27.945-8.368 34.828-20.584l22.137 3.707c5.129 16.25 20.185 28.15 38.108 28.15 22.136 0 40.143-18.007 40.143-40.143 0-6.286-1.585-12.162-4.159-17.462l44.862-57.555c5.743-7.361 4.423-17.983-2.941-23.718-7.328-5.719-17.956-4.417-23.715 2.938l-44.848 56.869c-3.004-.725-6.108-1.212-9.343-1.212-14.192 0-26.605 7.443-33.733 18.584l-23.937-4.002c-5.794-15.077-20.316-25.855-37.403-25.855-22.131 0-40.138 18.007-40.138 40.141 0 2.691.295 5.316.79 7.858l-37.733 37.136c-4.089-1.42-8.434-2.352-13.003-2.352-16.392 0-30.469 9.895-36.708 24l-44.438 4.39c-7.328-9.648-18.817-15.984-31.854-15.984-22.116 0-40.142 18.007-40.142 40.141 0 5.729 1.254 11.157 3.434 16.084l-23.091 24.535c-6.404 6.802-6.073 17.497.71 23.895a16.85 16.85 0 0 0 11.589 4.595m345.658-167.813c8.153 0 14.792 6.634 14.792 14.787 0 8.156-6.639 14.79-14.792 14.79s-14.788-6.634-14.788-14.79c0-8.153 6.635-14.787 14.788-14.787m-95.073-11.272c8.153 0 14.793 6.634 14.793 14.787s-6.64 14.79-14.793 14.79c-8.154 0-14.787-6.637-14.787-14.79s6.633-14.787 14.787-14.787m-90.084 82.782c8.154 0 14.787 6.637 14.787 14.79s-6.633 14.79-14.787 14.79-14.792-6.637-14.792-14.79 6.639-14.79 14.792-14.79m-113 12.405c8.153 0 14.788 6.634 14.788 14.788s-6.634 14.789-14.788 14.789-14.787-6.636-14.787-14.789c0-8.154 6.633-14.788 14.787-14.788" />
                        </svg>
                    </button>
                    <span class="tooltip" role="tooltip">Analysis</span>
                </div>
            </div>
        </div>
    </div>
    <div id="view-controls"
        class="absolute top-4 left-1/2 -translate-x-1/2 z-50 pointer-events-auto flex items-center gap-2">
        <div class="action-button-container">
            <button id="dock-top-sidebar-btn"
                class="btn btn-icon p-1 bg-[--panel-bg] hover:bg-[--grid-color] rounded-full self-center"
                aria-label="Dock Top Sidebar">
                <svg class="dock-icon-undocked" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none"
                    viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" style="transform: rotate(90deg);">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M14.25 2.25c-1.32.09-2.6.48-3.83.99l-3.82 2.01a1.5 1.5 0 0 0-.8 1.34v7.32a1.5 1.5 0 0 0 .8 1.34l3.82 2.01c1.23.51 2.51.9 3.83.99m8.25-10.5h-9m9 0c.93 0 1.69.76 1.69 1.69v5.62c0 .93-.76 1.69-1.69 1.69h-9" />
                </svg>
                <svg class="dock-icon-docked hidden" xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                    viewBox="0 0 24 24" fill="currentColor" style="transform: rotate(90deg);">
                    <path
                        d="M14.25 2.25c-1.32.09-2.6.48-3.83.99l-3.82 2.01a1.5 1.5 0 0 0-.8 1.34v7.32a1.5 1.5 0 0 0 .8 1.34l3.82 2.01c1.23.51 2.51.9 3.83.99m8.25-10.5h-9m9 0c.93 0 1.69.76 1.69 1.69v5.62c0 .93-.76 1.69-1.69 1.69h-9" />
                </svg>
            </button>
            <span class="tooltip !top-full !mt-2" role="tooltip">Dock Toolbar</span>
        </div>
        <div class="ui-panel p-1">
            <div class="btn-group">
                <div class="action-button-container"><button id="view-btn-persp" class="btn active"
                        aria-label="Perspective View"><svg viewBox="0 0 24 24">
                            <path d="M3 8l8-4 8 4-8 4-8-4z" />
                            <path d="M11 8v8M19 12l-8 4" />
                            <path d="M3 8v8l8 4" />
                        </svg></button><span class="tooltip" role="tooltip">Perspective View</span></div>
                <div class="action-button-container"><button id="view-btn-ortho" class="btn"
                        aria-label="Orthographic View"><svg viewBox="0 0 24 24">
                            <path d="M4,8 L12,4 L20,8 L12,12 L4,8 Z" />
                            <path d="M4,8 L4,16 L12,20 L12,12 Z" />
                            <path d="M12,12 L12,20 L20,16 L20,8 Z" />
                        </svg></button><span class="tooltip" role="tooltip">Orthographic View</span></div>
                <div class="action-button-container"><button id="view-btn-top" class="btn" aria-label="Top View"><svg
                            viewBox="0 0 24 24">
                            <polygon class="face-fill" points="4,8 12,4 20,8 12,12" />
                            <path d="M4 8l8 4 8-4" />
                            <path d="M12 12v8M20 8l-8 4" />
                            <path d="M4 8v8l8 4" />
                        </svg></button><span class="tooltip" role="tooltip">Top View</span></div>
                <div class="action-button-container"><button id="view-btn-front" class="btn"
                        aria-label="Front View (South)"><svg viewBox="0 0 24 24">
                            <polygon class="face-fill" points="4,16 12,20 12,12 4,8" />
                            <path d="M4 8l8 4 8-4" />
                            <path d="M12 12v8M20 8l-8 4" />
                            <path d="M4 8v8l8 4" />
                        </svg></button><span class="tooltip" role="tooltip">Front View (South)</span></div>
                <div class="action-button-container"><button id="view-btn-back" class="btn"
                        aria-label="Back View (North)"><svg viewBox="0 0 24 24">
                            <polygon class="face-fill" points="12,4 20,8 20,16 12,12" />
                            <path d="M4 8l8 4 8-4" />
                            <path d="M12 12v8M20 8l-8 4" />
                            <path d="M4 8v8l8 4" />
                        </svg></button><span class="tooltip" role="tooltip">Back View (North)</span></div>
                <div class="action-button-container"><button id="view-btn-left" class="btn"
                        aria-label="Left View (West)"><svg viewBox="0 0 24 24">
                            <polygon class="face-fill" points="4,8 12,4 12,12 4,16" />
                            <path d="M4 8l8 4 8-4" />
                            <path d="M12 12v8M20 8l-8 4" />
                            <path d="M4 8v8l8 4" />
                        </svg></button><span class="tooltip" role="tooltip">Left View (West)</span></div>
                <div class="action-button-container"><button id="view-btn-right" class="btn"
                        aria-label="Right View (East)"><svg viewBox="0 0 24 24">
                            <polygon class="face-fill" points="12,4 20,8 20,16 12,20" />
                            <path d="M4 8l8 4 8-4" />
                            <path d="M12 12v8M20 8l-8 4" />
                            <path d="M4 8v8l8 4" />
                        </svg></button><span class="tooltip" role="tooltip">Right View (East)</span></div>
                <div class="action-button-container"><button id="view-btn-quad" class="btn" aria-label="Quad View"><svg
                            xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="3" y1="12" x2="21" y2="12"></line>
                            <line x1="12" y1="3" x2="12" y2="21"></line>
                        </svg></button><span class="tooltip" role="tooltip">Quad View</span></div>
            </div>
        </div>
    </div>

    <main id="window-container" class="relative">
        <div id="panel-checklist" class="floating-window ui-panel hidden">
            <div class="window-header">
                <span>Simulation Checklist</span>
                <div class="window-controls">
                    <div class="window-icon-max"></div>
                    <div class="collapse-icon"></div>
                    <div class="window-icon-close"></div>
                </div>
            </div>
            <div class="window-content">
                <!-- Checklist content will be injected here -->
            </div>
            <div class="resize-handle-edge top"></div>
            <div class="resize-handle-edge right"></div>
            <div class="resize-handle-edge bottom"></div>
            <div class="resize-handle-edge left"></div>
            <div class="resize-handle-corner top-left"></div>
            <div class="resize-handle-corner top-right"></div>
            <div class="resize-handle-corner bottom-left"></div>
            <div class="resize-handle-corner bottom-right"></div>
        </div>

        <div id="panel-run" class="floating-window ui-panel hidden" style="width: 600px; height: 500px;">
            <div class="window-header">
                <span>Run Simulation</span>
                <div class="window-controls">
                    <div class="window-icon-max"></div>
                    <div class="collapse-icon"></div>
                    <div class="window-icon-close"></div>
                </div>
            </div>
            <div class="window-content">
                <!-- Recipe list will be injected here -->
            </div>
            <div class="resize-handle-edge top"></div>
            <div class="resize-handle-edge right"></div>
            <div class="resize-handle-edge bottom"></div>
            <div class="resize-handle-edge left"></div>
            <div class="resize-handle-corner top-left"></div>
            <div class="resize-handle-corner top-right"></div>
            <div class="resize-handle-corner bottom-left"></div>
            <div class="resize-handle-corner bottom-right"></div>
        </div>




        <!-- Project Setup Panel removed (now dynamically created by energyplusProjectSetup.js) -->



        </div>
        <!-- Dimensions & Geometry Panel removed (now dynamically created by geometryPanel.js) -->


        <div id="panel-aperture" class="floating-window ui-panel hidden">
        </div>


        <!-- Materials & Constructions Panel removed (now dynamically created) -->



        <div id="project-access-prompt"
            class="fixed top-20 left-1/2 -translate-x-1/2 z-[100] ui-panel !p-3 flex items-center gap-4 hidden">
            <p class="text-sm">Please select a project folder to enable direct saving and file access.</p>
            <button id="select-folder-btn" class="btn btn-primary btn-sm">Select Folder</button>
            <button id="dismiss-prompt-btn" class="text-gray-400 hover:text-gray-200"
                aria-label="Dismiss">&times;</button>
        </div>





        <div id="panel-info" class="floating-window ui-panel hidden" style="width: 600px; height: 500px;">
            <div class="window-header">
                <span>Application Information & Help</span>
                <div class="window-controls">
                    <div class="window-icon-max"></div>
                    <div class="collapse-icon"></div>
                    <div class="window-icon-close"></div>
                </div>
            </div>
            <div class="window-content">
                <p class="mb-4">
                    Ray Modeler is a web-based graphical user interface for the Radiance Lighting Simulation Suite, with
                    an integrated AI Assistant to automate workflows and provide expert guidance. It streamlines the
                    entire daylighting and electric lighting analysis workflow, from parametric 3D modeling to
                    simulation script generation and advanced results visualization.
                </p>
                <p class="mb-4">
                    Ray Modeler is a desktop application providing a graphical user interface (GUI) for the Radiance
                    Lighting Simulation Suite. Integrated with an AI Assistant, it streamlines daylighting and electric
                    lighting analysis, from 3D modeling to simulation and results visualization.
                </p>

                <img src="./Pictures/welcome_screen.png" alt="Ray Modeler Welcome Screen"
                    class="w-full rounded-md my-4 border border-[--grid-color]">

                <h2><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M15.59 14.37a6 6 0 01-5.84 7.38v.01h-.001a6 6 0 01-5.84-7.38L6.75 8.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75l2.84 6.12zM12 12l.001.001M12 12l-.001.001M12 12l.001-.001M12 12l-.001-.001M12 6a.75.75 0 01.75-.75h.008a.75.75 0 01.75.75v.008a.75.75 0 01-.75.75h-.008A.75.75 0 0112 6zM12 3.75a.75.75 0 01.75-.75h.008a.75.75 0 01.75.75v.008a.75.75 0 01-.75.75h-.008a.75.75 0 01-.75-.75V3.75zM12 15a.75.75 0 01.75-.75h.008a.75.75 0 01.75.75v.008a.75.75 0 01-.75.75h-.008A.75.75 0 0112 15z" />
                    </svg>Getting Started</h2>
                <p class="mb-4">To use Ray Modeler, you need a modern web browser and a local installation of the
                    Radiance Lighting Simulation Suite. The desktop version (recommended) offers the best experience.
                </p>
                <ol class="list-decimal list-inside space-y-2 my-4">
                    <li><strong>Install Radiance</strong>:
                        Download and install <a href="https://www.radiance-online.org/" target="_blank"
                            class="text-[--text-secondary] underline">Radiance</a> from the official website or the <a
                            href="https://github.com/NREL/Radiance" target="_blank"
                            class="text-[--text-secondary] underline">NREL</a> GitHub repository. Ensure the Radiance
                        <code>bin</code> directory is in your system's PATH.
                    </li>
                    <li><strong>Download Ray Modeler</strong>:
                        Download the latest release for your operating system (macOS or Windows) from the project's
                        Releases page.
                    </li>
                    <li><strong>Run the Application</strong>:
                        <ul class="list-disc list-inside ml-4">
                            <li><em>Windows</em>: Run the Ray Modeler Setup <code>.exe</code> installer.</li>
                            <li><em>macOS</em>: Open the Ray Modeler <code>.dmg</code> and drag the application to your
                                Applications folder.</li>
                        </ul>
                    </li>
                </ol>
                <h4 class="font-semibold text-sm uppercase text-[--text-secondary] mt-4">Security Warnings on First
                    Launch</h4>
                <p class="mb-4">Because the app isn't code-signed, your OS might show a security warning. When a user on
                    a Mac downloads and tries to open the unsigned app, they will be stopped by Gatekeeper, which will
                    show a message like "Ray Modeler cannot be opened because the developer cannot be verified."</p>
                <ul class="list-disc list-inside ml-4 mt-2 space-y-1">
                    <li><strong>On Windows (SmartScreen)</strong>: Click "<strong>More info</strong>", then click
                        "<strong>Run anyway</strong>".</li>
                    <li><strong>On macOS (Gatekeeper)</strong>: <strong>Right-click</strong> (or Control-click) the app
                        icon, select "<strong>Open</strong>" from the menu. A new dialog box will appear that is similar
                        to the first one, but this time it will include an "<strong>Open</strong>" button. Clicking this
                        will run the app. You only need to do this once. After the first successful launch, the app can
                        be opened normally by double-clicking it.</li>
                </ul>

                <h2><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="1.5"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.572L16.5 21.75l-.398-1.178a3.375 3.375 0 00-2.456-2.456L12.5 18l1.178-.398a3.375 3.375 0 002.456-2.456L16.5 14.25l.398 1.178a3.375 3.375 0 002.456 2.456L20.5 18l-1.178.398a3.375 3.375 0 00-2.456 2.456z" />
                    </svg>Core Capabilities</h2>
                <p class="mb-4">Ray Modeler is packed with features that automate and enhance the Radiance workflow:</p>
                <ul class="list-disc list-inside space-y-1 my-4">
                    <li><strong>Parametric Scene Modeling</strong>: Define room dimensions, orientation, window-to-wall
                        ratios (WWR), and shading devices like overhangs, light shelves, louvers, and roller shades.
                    </li>
                    <li><strong>Geometry Importer</strong>: Import <code>.obj</code> models, with an interactive UI to
                        tag surfaces (walls, floors, glazing) for simulation setup.</li>
                    <li><strong>Context & Site Modeling</strong>: Adding surrounding context, either through simple
                        massing tools, topography from heightmaps, or by automatically fetching building data from
                        OpenStreetMaps.</li>
                    <li><strong>Interior Furniture Library</strong>: Place simple furniture and partition objects from a
                        pre-built library via drag-and-drop or import custom <code>.obj</code> assets..</li>
                    <li><strong>Radiance Material Editor</strong>: Configure standard Radiance materials
                        (<code>plastic</code>, <code>metal</code>, <code>glass</code>) by adjusting properties like
                        reflectance, specularity, and roughness. It also supports spectral data (<code>.dat</code>)
                        files for advanced material definitions.</li>
                    <li><strong>Advanced Glazing Systems</strong>: Model glazing using simple transmittance values or
                        incorporate complex fenestration data via Bidirectional Scattering Distribution Function (BSDF)
                        <code>.xml</code> files. The application converts intuitive transmittance to physically-based
                        transmissivity for simulations.
                    </li>
                    <li><strong>Interactive BSDF Viewer</strong>: When a BSDF <code>.xml</code> file is loaded, the
                        application can parse the Klems matrix and render an interactive 2D polar plot showing the
                        angular distribution of transmitted light for any incident angle.</li>
                    <li><strong>Electric Lighting Design</strong>: Place and configure Radiance light source types
                        (light, spotlight, glow, illum) or import luminaire data using <code>.ies</code> photometric
                        files in individual or grid-based layouts.</li>
                    <li><strong>IES Photometry Viewer</strong>: In addition to a 2D polar plot, visualize luminaire
                        distributions with an interactive 3D photometric web and view key metadata like lumens and
                        wattage directly from the <code>.ies</code> file.</li>
                    <li><strong>Daylighting Controls</strong>: Simulate energy savings by implementing
                        photosensor-controlled lighting systems with continuous, stepped, or off modes.</li>
                    <li><strong>Daylighting Control Zone Visualization</strong>: Instantly visualize which luminaires
                        are controlled by which photosensors with color-coded 3D gizmos, providing immediate feedback on
                        the daylighting strategy.</li>
                    <li><strong>Automated Radiance Workflow</strong>: Generates a complete, organized project folder
                        structure (e.g., 01_geometry, 04_skies, 07_scripts) and populates it with geometry files,
                        material definitions, sensor points, and executable run scripts for both Windows
                        (<code>.bat</code>) and macOS/Linux (<code>.sh</code>).</li>
                    <li><strong>First-Person View (FPV) Mode</strong>: Enter the Radiance viewpoint camera directly to
                        preview the exact perspective, fisheye, or parallel view that will be rendered for analysis.
                    </li>
                    <li><strong>Saved Camera Views ("Snapshots")</strong>: Save and load specific camera positions and
                        angles, complete with thumbnails, to quickly return to key perspectives during analysis.</li>
                    <li><strong>Advanced Annual Analysis</strong>: Generate and view temporal heatmaps, glare rose
                        diagrams, and combined daylight/glare scatter plots to deeply understand annual performance.
                    </li>
                    <li><strong>Recipe-Based Simulation Engine</strong>: Automate complex Radiance workflows with
                        pre-configured "recipes." The application generates all necessary geometry files, material
                        definitions, and executable run scripts (<code>.sh</code>, <code>.bat</code>) in a standardized
                        project folder. Includes recipes for <code>IES LM-83 (sDA/ASE)</code>, <code>EN 17037</code>,
                        and <code>EN 12464-1</code>.</li>
                    <li><strong>Advanced Annual Methods</strong>: Support for industry-standard annual simulation
                        methods, including 3-Phase and 5-Phase Daylight Analysis.</li>
                    <li><strong>Spectral Lighting Analysis</strong>: A full implementation of the Lark methodology to
                        run multi-channel simulations and calculate non-visual lighting metrics like melanopic and
                        neuropic illuminance.</li>
                    <li><strong>Automated Compliance Workflows</strong>: Specialized recipes for checking compliance
                        with major industry standards, including <code>IES LM-83 (sDA/ASE)</code>,
                        <code>EN 17037 (Daylight in Buildings)</code>, and
                        <code>EN 12464-1 (Light and lighting of work places)</code>.
                    </li>
                    <li><strong>Interactive HDR Image Analysis</strong>: View High-Dynamic Range (HDR) renderings with
                        exposure controls, toggle false-color luminance mode, and use a mouse-over probe to get exact
                        cd/m values. Detected glare sources can be overlaid directly onto the image for verification.
                    </li>

                    <li><strong>File System Integration</strong>: Using the File System Access API (or Electron's APIs),
                        Ray Modeler can directly read from and save to a local project folder, enabling a seamless
                        desktop-like experience.</li>
                    <li><strong>AI Assistant (Helios)</strong>: An integrated, context-aware AI chat powered by
                        generative AI (Google Gemini, Anthropic, OpenAI, OpenRouter models) to help answer questions and
                        directly manipulate the scene, run simulations, and control the UI using natural language
                        commands.</li>
                    <li><strong>Automated Report Generation</strong>: Generate comprehensive HTML reports with a single
                        click. The report includes project details, a 3D scene snapshot, key performance metrics (sDA,
                        ASE, DGP), and all generated dashboard charts (UDI, Glare Rose), ready for printing or saving as
                        a PDF.</li>
                    <li><strong>Interactive Data Table</strong>: Inspect raw simulation data in a sortable, filterable
                        table. Click on any row to instantly highlight the corresponding sensor point in the 3D model,
                        linking numerical data directly to its spatial context.</li>
                    <li><strong>Daylight Autonomy Heatmaps</strong>: Visualize annual performance not just as
                        point-in-time illuminance, but also as Daylight Autonomy (DA), showing the percentage of
                        occupied hours that each sensor point meets a specific illuminance threshold.</li>
                    <li><strong>Climate Data Analysis</strong>: Generate an interactive dashboard from the loaded EPW
                        file, including a wind rose, solar radiation charts, and temperature profiles to better
                        understand the site context.</li>
                    <li><strong>Advanced Circadian Health Dashboard</strong>: Analyze results from spectral simulations
                        to calculate and visualize key circadian lighting metrics like Circadian Stimulus (CS),
                        Equivalent Melanopic Lux (EML), and check for compliance with WELL building standards.</li>
                    <li><strong>Keyboard Shortcuts</strong>: Accelerate your workflow with keyboard shortcuts for common
                        actions, such as <code>T</code> for Top View, <code>P</code> for Perspective, and
                        <code>Ctrl+S</code> to save the project. A help modal (<code>?</code>) displays all available
                        shortcuts.
                    </li>
                    <li><strong>Multi-View Layout (Quad View)</strong>: Split the main viewport into four synchronized
                        cameras (Perspective, Top, Front, Side) for comprehensive spatial awareness and precise object
                        placement, a standard in professional 3D software.</li>
                    <li><strong>Vegetation & Tree Modeling</strong>: Add simple procedural trees and bushes from the
                        Scene Elements library to your site. The vegetation canopy uses a Radiance <code>trans</code>
                        material to accurately simulate its light-filtering effects, improving the realism of
                        site-specific analyses.</li>
                </ul>

                <h2><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="1.5"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M12 18v-5.25m0 0a6.01 6.01 0 001.5-.189m-1.5.189a6.01 6.01 0 01-1.5-.189m3.75 7.478a12.06 12.06 0 01-4.5 0m3.75 2.311a15.045 15.045 0 01-7.5 0C4.508 17.311 2.25 15.122 2.25 12c0-3.122 2.258-5.311 4.75-5.965M12 18a2.25 2.25 0 01-2.25-2.25V6.75A2.25 2.25 0 0112 4.5h.75a2.25 2.25 0 012.25 2.25v5.25a2.25 2.25 0 01-2.25 2.25h-.75z" />
                    </svg>AI Assistant (Helios)</h2>
                <p class="mb-4">The AI Assistant panel provides a chat interface to help you with your workflow. It
                    understands the application's current state and can perform actions on your behalf using natural
                    language commands.</p>

                <hr class="my-6 border-[--grid-color]">

                <h3><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="1.5"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.572L16.5 21.75l-.398-1.178a3.375 3.375 0 00-2.456-2.456L12.5 18l1.178-.398a3.375 3.375 0 002.456-2.456L16.5 14.25l.398 1.178a3.375 3.375 0 002.456 2.456L20.5 18l-1.178.398a3.375 3.375 0 00-2.456 2.456z" />
                    </svg>AI-Powered Actions (Tool Use)</h3>
                <p class="mb-4">Beyond answering questions, the assistant can directly manipulate the UI and query
                    project data. This allows for a powerful natural language workflow. Its capabilities include:</p>
                <ul class="list-disc list-inside space-y-1 my-4">
                    <li><strong>Project Validation</strong>: Ask it to
                        <code>"validate my project for an annual glare simulation"</code> and it will check for common
                        setup errors, such as a missing weather file or an incorrect viewpoint type, and report back any
                        issues.
                    </li>
                    <li><strong>Advanced Scene Manipulation</strong>:
                        <ul class="list-disc list-inside ml-4">
                            <li><strong>Shading</strong>:
                                <code>"Add a 0.5 meter deep overhang to the south wall."</code>
                            </li>
                            <li><strong>Sensor Grids</strong>:
                                <code>"Enable a sensor grid on the floor with 0.75m spacing."</code>
                            </li>
                            <li><strong>Daylighting</strong>:
                                <code>"Enable continuous daylighting controls with a setpoint of 500 lux."</code>
                            </li>
                        </ul>
                    </li>
                    <li><strong>Simulation & Recipe Control</strong>:
                        <ul class="list-disc list-inside ml-4">
                            <li><strong>Global Parameters</strong>: <code>"Set the global ambient bounces to 5."</code>
                            </li>
                            <li><strong>Recipe Configuration</strong>:
                                <code>"In the open illuminance recipe, change the time to 9:00 AM."</code>
                            </li>
                        </ul>
                    </li>
                    <li><strong>Conversational Data Exploration & Comparison</strong>:
                        <ul class="list-disc list-inside ml-4">
                            <li><strong>Data Query</strong>:
                                <code>"What is the average illuminance for the current results?"</code> or
                                <code>"How many points are above 500 lux?"</code>
                            </li>
                            <li><strong>Time Scrubbing</strong>:
                                <code>"Show me the results for the winter solstice at noon."</code>
                            </li>
                            <li><strong>Dashboard Control</strong>: <code>"Open the glare rose diagram."</code></li>
                            <li><strong>Comparative Analysis</strong>:
                                <code>"Which of my two designs has better daylight uniformity?"</code> or
                                <code>"Compare the sDA for both designs."</code>
                            </li>
                        </ul>
                    </li>
                    <li><strong>File Management</strong>:
                        <ul class="list-disc list-inside ml-4">
                            <li><strong>Load Results</strong>: <code>"Load a results file into dataset A."</code></li>
                            <li><strong>Clear Results</strong>: <code>"Clear all loaded results data."</code></li>
                        </ul>
                    </li>
                </ul>

                <h3><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="1.5"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.572L16.5 21.75l-.398-1.178a3.375 3.375 0 00-2.456-2.456L12.5 18l1.178-.398a3.375 3.375 0 002.456-2.456L16.5 14.25l.398 1.178a3.375 3.375 0 002.456 2.456L20.5 18l-1.178.398a3.375 3.375 0 00-2.456 2.456z" />
                    </svg>Design Inspector</h3>
                <p class="mb-4">The AI analyzes the entire project state to identify conflicting or suboptimal
                    combinations of settings, explains the potential consequences, and offers a one-click fix.</p>
                <div class="info-box my-4">
                    <strong>AI Analysis:</strong> "I've reviewed your project. Your wall reflectance is quite low (0.2),
                    and you're only using 2 ambient bounces. This combination will likely result in an unrealistically
                    dark rendering with noticeable splotches. I recommend increasing ambient bounces to 4 and wall
                    reflectance to 0.5."
                    <br>
                    <button class="btn btn-xs btn-secondary mt-2">[Apply Fixes]</button>
                </div>

                <h3><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="1.5"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.572L16.5 21.75l-.398-1.178a3.375 3.375 0 00-2.456-2.456L12.5 18l1.178-.398a3.375 3.375 0 002.456-2.456L16.5 14.25l.398 1.178a3.375 3.375 0 002.456 2.456L20.5 18l-1.178.398a3.375 3.375 0 00-2.456 2.456z" />
                    </svg>Results Critique</h3>
                <p class="mb-4">After a simulation completes, the AI can analyze the results, identify problems, and
                    suggest specific, actionable design changes.</p>
                <div class="info-box my-4">
                    <strong>AI Analysis:</strong> "The Daylight Glare Probability (DGP) is 0.47, which is considered
                    'Intolerable'. This is caused by low-angle sun from the west-facing window. To fix this, I suggest
                    adding vertical louvers."
                    <br>
                    <button class="btn btn-xs btn-secondary mt-2">[Add Vertical Louvers]</button>
                </div>

                <h3><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="1.5"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.572L16.5 21.75l-.398-1.178a3.375 3.375 0 00-2.456-2.456L12.5 18l1.178-.398a3.375 3.375 0 002.456-2.456L16.5 14.25l.398 1.178a3.375 3.375 0 002.456 2.456L20.5 18l-1.178.398a3.375 3.375 0 00-2.456 2.456z" />
                    </svg>Interactive Tutor</h3>
                <p class="mb-4">The AI can act as a tutor to guide new users through complex simulation workflows
                    step-by-step, teaching them the process as they go.</p>
                <div class="info-box my-4">
                    <p><strong>User</strong>: "How do I run a glare simulation?"</p>
                    <p><strong>AI</strong>: "Of course! To calculate DGP, we need a 180 fisheye view. Your current
                        viewpoint is set to Perspective. Would you like me to change it for you?"</p>
                    <p><strong>User</strong>: "Yes"</p>
                    <p><strong>AI</strong>: <em>(Changes viewpoint)</em> "Great. Next, I'll open the DGP recipe panel
                        for you." <em>(Opens recipe)</em> "Now you just need to click 'Generate Package' and run the
                        simulation."</p>
                </div>

                <h4 class="font-semibold text-sm uppercase text-[--text-secondary] mt-4">Proactive Suggestions</h4>
                <p class="mb-4">The AI Assistant monitors user actions and provides contextual, non-intrusive
                    suggestions to guide the workflow and prevent common errors. These suggestions appear as dismissible
                    chips in the UI. For example:</p>
                <ul class="list-disc list-inside space-y-1 my-4">
                    <li>After loading an <strong>EPW weather file</strong>, it will suggest opening an annual simulation
                        recipe.</li>
                    <li>If a material's <strong>reflectance is set to an unusually high or low value</strong>, it will
                        warn that this may be physically unrealistic.</li>
                    <li>If the user enables a <strong>View Grid</strong>, it will suggest opening the Imageless Annual
                        Glare recipe.</li>
                    <li>If the <strong>DGP recipe is open but the viewpoint is not set to fisheye</strong>, it will
                        offer to correct the setting.</li>
                </ul>

                <h3><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="1.5"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.572L16.5 21.75l-.398-1.178a3.375 3.375 0 00-2.456-2.456L12.5 18l1.178-.398a3.375 3.375 0 002.456-2.456L16.5 14.25l.398 1.178a3.375 3.375 0 002.456 2.456L20.5 18l-1.178.398a3.375 3.375 0 00-2.456 2.456z" />
                    </svg>Generative Design</h3>
                <p class="mb-4">Leverage the AI to perform automated, multi-step design tasks.</p>
                <ul class="list-disc list-inside space-y-1 my-4">
                    <li><strong>Scene Creation from Natural Language</strong>: Instead of manually adjusting sliders,
                        describe the space you want to build in plain English.
                        <div class="info-box !text-sm my-2">
                            "Create a long office, 12 meters deep by 5 meters wide, with a 3-meter high ceiling. Put a
                            large, continuous window across the entire south wall with a sill height of 0.8 meters. Add
                            a 1-meter deep overhang above it and place two desks in the middle of the room."
                        </div>
                    </li>
                    <li><strong>Design Optimization</strong>: Define a goal, constraints, and a design variable, and the
                        assistant will orchestrate the entire workflow to find the best solution. For example:
                        <div class="info-box !text-sm my-2">
                            "Find an overhang depth for the south wall between 0.5m and 2.0m that maximizes sDA while
                            keeping ASE below 10%."
                        </div>
                    </li>
                </ul>

                <hr class="my-6 border-[--grid-color]">

                <h3><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="1.5"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.572L16.5 21.75l-.398-1.178a3.375 3.375 0 00-2.456-2.456L12.5 18l1.178-.398a3.375 3.375 0 002.456-2.456L16.5 14.25l.398 1.178a3.375 3.375 0 002.456 2.456L20.5 18l-1.178.398a3.375 3.375 0 00-2.456 2.456z" />
                    </svg>API Key Configuration</h3>
                <p class="mb-4">The integrated AI Assistant requires an API key to function. It supports multiple
                    providers for greater flexibility.</p>
                <ul class="list-disc list-inside space-y-1 my-4">
                    <li><strong>Expanded Provider Support</strong>: Select between <strong>OpenRouter</strong>,
                        <strong>OpenAI</strong>, <strong>Google Gemini</strong>, and <strong>Anthropic</strong>.
                    </li>
                    <li><strong>Provider-Specific Keys</strong>: The application saves a separate API key for each
                        provider, so you can switch between models without re-entering credentials.</li>
                    <li><strong>AI Configuration</strong>: A settings modal ( icon) allows you to select your
                        preferred provider, choose from a list of popular models (e.g., Gemini 1.5 Pro, GPT-4o, Claude
                        3.5 Sonnet), and enter your API key.</li>
                </ul>

                <hr class="my-6 border-[--grid-color]">

                <h3><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="1.5"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.572L16.5 21.75l-.398-1.178a3.375 3.375 0 00-2.456-2.456L12.5 18l1.178-.398a3.375 3.375 0 002.456-2.456L16.5 14.25l.398 1.178a3.375 3.375 0 002.456 2.456L20.5 18l-1.178.398a3.375 3.375 0 00-2.456 2.456z" />
                    </svg>Getting Your API Key</h3>

                <h4 class="font-semibold text-sm uppercase text-[--text-secondary] mt-4">Google Gemini API Key</h4>
                <p class="mb-4">You can get a free API key for the Gemini family of models from <a
                        href="https://aistudio.google.com/prompts/new_chat" target="_blank"
                        class="text-[--text-secondary] underline">Google AI Studio</a>.</p>
                <ol class="list-decimal list-inside space-y-1 my-2 ml-4">
                    <li>Go to the Google AI Studio website.</li>
                    <li>Sign in with your Google account.</li>
                    <li>Click the "<code>Get API key</code>" button, usually located in the top-left or top-right corner
                        of the page.</li>
                    <li>A dialog will appear. Click "<code>Create API key</code>".</li>
                    <li>Your new API key will be generated and displayed.</li>
                    <li>Copy this key and paste it into the API Key field in the Ray Modeler AI settings.</li>
                </ol>
                <p class="text-xs text-[--text-secondary]"><em>Note: The Gemini API has a free tier with usage limits.
                        Be sure to review Google's current pricing and terms of service.</em></p>

                <h4 class="font-semibold text-sm uppercase text-[--text-secondary] mt-4">OpenRouter API Key</h4>
                <p class="mb-4">OpenRouter provides access to a wide variety of models from different providers through
                    a single API.</p>
                <ol class="list-decimal list-inside space-y-1 my-2 ml-4">
                    <li>Go to the <a href="https://openrouter.ai/" target="_blank"
                            class="text-[--text-secondary] underline">OpenRouter.ai</a> website and log in.</li>
                    <li>Click on your account icon in the top-right corner and select "<code>Keys</code>" from the
                        dropdown menu.</li>
                    <li>Click the "<code>+ Create Key</code>" button. Give your key a name (e.g., "RayModeler") and
                        click "<code>Create</code>".Your new API key will be generated.</li>
                    <li>Copy this key and paste it into the API Key field in the Ray Modeler AI settings.</li>
                </ol>
                <p class="text-xs text-[--text-secondary]"><em>Note: OpenRouter is a paid service. You will need to add
                        credits to your account to use most models. To use some of the free models, you may need to
                        adjust your privacy settings to allow your data to be used for model improvement.</em></p>

                <h4 class="font-semibold text-sm uppercase text-[--text-secondary] mt-4">OpenAI API Key</h4>
                <ol class="list-decimal list-inside space-y-1 my-2 ml-4">
                    <li>Go to the <a href="https://platform.openai.com/api-keys" target="_blank"
                            class="text-[--text-secondary] underline">OpenAI API keys</a> page and log in.</li>
                    <li>Click the "<code>+ Create new secret key</code>" button.</li>
                    <li>Give your key a name (e.g., "RayModeler") and click "<code>Create secret key</code>".</li>
                    <li>Copy the generated key immediately and paste it into the API Key field in the Ray Modeler AI
                        settings. You will not be able to view it again.</li>
                </ol>

                <h4 class="font-semibold text-sm uppercase text-[--text-secondary] mt-4">Anthropic API Key</h4>
                <ol class="list-decimal list-inside space-y-1 my-2 ml-4">
                    <li>Go to the <a href="https://console.anthropic.com/" target="_blank"
                            class="text-[--text-secondary] underline">Anthropic Console</a> and log in.</li>
                    <li>Navigate to the "API Keys" section in your account settings.</li>
                    <li>Click the "<code>Create Key</code>" button.</li>
                    <li>Give the key a name and click "<code>Create Key</code>".</li>
                    <li>Copy the key and paste it into the API Key field in the Ray Modeler AI settings.</li>
                </ol>
                <p class="info-box my-4"><strong>Important</strong>: Treat your API keys like passwords. Do not share
                    them publicly or commit them to version control.</p>

                <h2><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="1.5"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M6.75 6.75C6.75 5.64543 7.64543 4.75 8.75 4.75H15.25C16.3546 4.75 17.25 5.64543 17.25 6.75V19.25L12 14.75L6.75 19.25V6.75Z" />
                    </svg>UI Walkthrough</h2>
                <p class="mb-4">The interface is designed around a logical workflow, guiding the user from setup to
                    analysis.</p>
                <img src="./Pictures/main_ui.png" alt="Ray Modeler Main UI"
                    class="w-full rounded-md my-4 border border-[--grid-color]">
                <img src="./Pictures/main_ui_quad.png" alt="Ray Modeler Main UI in Quad View"
                    class="w-full rounded-md my-4 border border-[--grid-color]">
                <img src="./Pictures/panels_ui.png" alt="Ray Modeler Panels"
                    class="w-full rounded-md my-4 border border-[--grid-color]">
                <ul class="list-disc list-inside space-y-1 my-4">
                    <li><strong>3D Viewport (Center)</strong>: This is the main interactive area where your 3D scene is
                        displayed. You can navigate using standard orbit controls (mouse drag, scroll). The viewport can
                        also be split into a <strong>Quad View</strong> layout, showing synchronized Perspective, Top,
                        Front, and Side cameras for comprehensive spatial awareness.</li>
                    <li><strong>Left Toolbar</strong>: This is the primary command center for building your scene. It
                        contains buttons to open floating panels for defining all aspects of the physical model, from
                        <strong>Project Setup</strong> and <strong>Dimensions</strong> to <strong>Simulation</strong>
                        and <strong>Analysis</strong> modules.
                    </li>
                    <li><strong>Top View Controls</strong>: A quick-access toolbar to instantly switch between standard
                        orthographic (Top, Front, etc.) and perspective camera views. It also includes the button to
                        toggle the <strong>Quad View</strong> layout.</li>
                    <li><strong>Bottom Toolbar (Bottom-Left)</strong>: Provides quick access to global actions like
                        saving/loading project files, viewing application information and keyboard shortcuts, and
                        launching the AI Assistant.</li>
                    <li><strong>Floating Panels</strong>: All scene definition, simulation, and analysis tools open as
                        independent floating windows. These panels can be dragged, resized, collapsed, and arranged
                        anywhere on the screen, allowing you to create a workspace tailored to your needs.</li>
                    <li><strong>AI Assistant Sidebar (Right)</strong>: A dedicated, resizable sidebar that houses the
                        conversational AI Assistant. This keeps the AI's powerful capabilities accessible without
                        cluttering your modeling and analysis workflow.</li>
                </ul>

                <h2><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="1.5"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                    </svg>In-Depth Feature Guide</h2>

                <h3><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M10.5 6h9.75M10.5 6a1.5 1.5 0 11-3 0m3 0a1.5 1.5 0 10-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-3.75 0H7.5m9 6V6.75a.75.75 0 00-.75-.75H7.5a.75.75 0 00-.75.75v10.5a.75.75 0 00.75.75h9.75a.75.75 0 00.75-.75V6.75h-3.75z" />
                    </svg>Scene Definition Panels </h3>
                <p class="mb-4">The panels on the left toolbar are used to define the scene.</p>
                <ul class="list-disc list-inside space-y-1 my-4">
                    <li><strong>Project Setup</strong>: This is the starting point for any analysis.
                        <ul class="list-disc list-inside ml-4">
                            <li><em>Project Details</em>: Define project name, description, and building type.</li>
                            <li><em>Radiance Path</em>: Specify the local installation path for the Radiance binaries.
                                The application provides a helpful reminder and defaults based on your OS.</li>
                            <li><em>Climate & Location</em>: Upload an (<code>.epw</code>) weather file to auto-populate
                                location data or set latitude/longitude manually using an interactive map.</li>
                            <li><em>Occupancy Schedule</em>: A utility to generate an 8760-hour occupancy schedule file
                                (<code>.csv</code>) based on selected days of the week and occupied hours. This file can
                                be used in annual glare and daylighting control simulations.</li>
                        </ul>
                    </li>
                    <li><strong>Dimensions</strong>: Set the foundational geometry of the room.
                        <ul class="list-disc list-inside ml-4">
                            <li><em>Geometry Mode</em>: Choose between <strong>Parametric</strong> (for the simple box
                                model) or <strong>Imported</strong> (for complex models).</li>
                            <li><em>Parametric Controls</em>: Set the <strong>Width (X), Length (Z), Height (Y)</strong>
                                and rotate the entire room with the <strong>Orientation</strong> slider.</li>
                            <li><em>Geometry Importer</em>: Import <code>.obj</code> models. Includes tools for
                                automatic scaling and centering. After import, a <strong>Surface Tagger</strong> UI
                                appears, allowing you to assign Radiance-relevant surface types (wall, floor, glazing,
                                etc.) to each material from the original file.</li>
                        </ul>
                    </li>
                    <li><strong>Apertures</strong>: Control openings and shading systems on a per-wall basis.
                        <ul class="list-disc list-inside ml-4">
                            <li><em>Wall Selection</em>: Click on a wall in the 3D view to select it for editing. The
                                selection can be locked to prevent accidental changes.</li>
                            <li><em>Aperture Mode</em>: Define windows using either Window-to-Wall Ratio (WWR) or a
                                Manual mode for precise control over width, height, and sill height.</li>
                            <li><em>Shading Devices</em>: Each wall can have its own complex shading system, including:
                                <ul class="list-disc list-inside ml-4">
                                    <li>Overhangs, Light Shelves, Louvers, and Roller Shades with detailed parametric
                                        controls.</li>
                                    <li><strong>Imported OBJ</strong>: Import a custom shading device from an
                                        <code>.obj</code> file, with in-scene controls for position, rotation, and
                                        scale.
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                    <li><strong>Material Properties</strong>: Define the surface characteristics of the room's
                        parametric or imported geometry.</li>
                    <li><strong>Sensor Grid</strong>: Create measurement points for simulations.</li>
                    <li><strong>Viewpoint</strong>: Controls the specific camera view used by Radiance for generating
                        renderings.
                        <ul class="list-disc list-inside ml-4">
                            <li><em>FPV Mode</em>: Enter a first-person view to see exactly what Radiance will render.
                            </li>
                            <li><em>3D Gizmo</em>: A transform gizmo allows you to visually manipulate the camera's
                                position and rotation.</li>
                            <li><em>Saved Views ("Snapshots")</em>: A "Save Current View" button captures the camera's
                                state. The UI displays a list of saved views with thumbnails, which can be clicked to
                                instantly restore a perspective.</li>
                        </ul>
                    </li>
                    <li><strong>Scene Elements</strong>: Add and manage non-architectural objects in the scene.
                        <ul class="list-disc list-inside ml-4">
                            <li><em>Interior Furniture Library</em>: A panel with pre-built, low-polygon assets (desks,
                                chairs, partitions) that can be dragged and dropped into the 3D scene.</li>
                            <li><em>Context & Site Modeling</em>: Tools to model the surrounding environment for more
                                accurate simulations.
                                <ul class="list-disc list-inside ml-4">
                                    <li><strong>Simple Massing Tools</strong>: Create and place simple 3D shapes (boxes,
                                        cylinders) to represent surrounding buildings.</li>
                                    <li><strong>Topography Import</strong>: Generate a ground plane with topography from
                                        a grayscale heightmap image.</li>
                                    <li><strong>OpenStreetMaps Integration</strong>: Automatically fetch building
                                        footprints and height data for a given location to generate a basic urban
                                        context.</li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                </ul>

                <h3><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M10.5 6A2.25 2.25 0 008.25 8.25v3.75a2.25 2.25 0 002.25 2.25h3a2.25 2.25 0 002.25-2.25V8.25a2.25 2.25 0 00-2.25-2.25h-3zM3.75 6A2.25 2.25 0 001.5 8.25v10.5A2.25 2.25 0 003.75 21h10.5A2.25 2.25 0 0016.5 18.75V16.5m-12.75-3h3.75m-3.75 0h3.75m-3.75 0v3.75m0-3.75h3.75M15 12a.75.75 0 01.75-.75h.008a.75.75 0 01.75.75v.008a.75.75 0 01-.75.75h-.008A.75.75 0 0115 12zm2.25 0a.75.75 0 01.75-.75h.008a.75.75 0 01.75.75v.008a.75.75 0 01-.75.75h-.008a.75.75 0 01-.75-.75zM15 15a.75.75 0 01.75-.75h.008a.75.75 0 01.75.75v.008a.75.75 0 01-.75.75h-.008A.75.75 0 0115 15zm2.25 0a.75.75 0 01.75-.75h.008a.75.75 0 01.75.75v.008a.75.75 0 01-.75.75h-.008a.75.75 0 01-.75-.75zM15 18a.75.75 0 01.75-.75h.008a.75.75 0 01.75.75v.008a.75.75 0 01-.75.75h-.008A.75.75 0 0115 18zm2.25 0a.75.75 0 01.75-.75h.008a.75.75 0 01.75.75v.008a.75.75 0 01-.75.75h-.008a.75.75 0 01-.75-.75z" />
                    </svg>Simulation Modules (Recipes)</h3>
                <p class="mb-4">Each recipe in the Simulation Sidebar automates a specific Radiance workflow by
                    generating scripts that call core commands like <code>oconv</code>, <code>rpict</code>,
                    <code>rcontrib</code>, and <code>evalglare</code>. Global simulation parameters (<code>-ab</code>,
                    <code>-ad</code>) can be set once and overridden per recipe.
                </p>
                <ul class="list-disc list-inside space-y-1 my-4">
                    <li><strong>Global Simulation Parameters</strong>: Sets default Radiance parameters (e.g.,
                        <code>-ab</code>, <code>-ad</code>, <code>-aa</code>) that are inherited by all other recipes,
                        ensuring consistency.
                    </li>
                    <li><strong>Illuminance Map</strong>: A point-in-time calculation that produces illuminance (lux)
                        values for each point in your sensor grid.</li>
                    <li><strong>Photorealistic Rendering</strong>: Creates a high-dynamic-range (HDR) image from the
                        specified Viewpoint.</li>
                    <li><strong>Daylight Glare Probability (DGP)</strong>: Renders a 180 fisheye image and analyzes it
                        for glare using <code>evalglare</code>.</li>
                    <li><strong>Daylight Factor (DF)</strong>: Calculates the ratio of internal to external illuminance
                        under a standard CIE overcast sky.</li>
                    <li><strong>Annual Daylight (3-Phase & 5-Phase)</strong>: Generates scripts for advanced annual
                        simulations using matrix-based methods.</li>
                    <li><strong>Imageless Annual Glare</strong>: An advanced recipe using <code>rcontrib</code> and
                        <code>dcglare</code> to efficiently calculate an 8760-hour DGP profile.
                    </li>
                    <li><strong>Spectral Analysis (Lark)</strong>: Implements the Lark methodology for multi-channel
                        spectral simulations to calculate non-visual lighting metrics.</li>
                    <li><strong>Compliance Recipes</strong>: A suite of specialized recipes for checking compliance with
                        major industry standards:
                        <ul class="list-disc list-inside ml-4">
                            <li><code>IES LM-83 (sDA/ASE)</code></li>
                            <li><code>EN 17037 (Daylight in Buildings)</code></li>
                            <li><code>EN 12464-1 (Illuminance & UGR for Work Places)</code></li>
                        </ul>
                    </li>
                    <li><strong>Lighting Energy Analysis</strong>: Runs an annual simulation with daylighting controls
                        to estimate energy consumption (kWh/year) and savings.</li>
                    <li><strong>Faade Irradiation Analysis</strong>: A recipe to calculate the total annual solar
                        irradiation (in kWh/m/year) on an exterior faade, essential for envelope design and assessing
                        potential for building-integrated photovoltaics (BIPV).</li>
                    <li><strong>Annual Solar Radiation Maps</strong>: An annual simulation that calculates the
                        cumulative solar radiation on interior surfaces, visualized as a heatmap. This is critical for
                        understanding passive solar heating potential and predicting long-term material degradation.
                    </li>
                </ul>

                <h2><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                    </svg>Analysis Modules</h2>
                <p class="mb-4">The Analysis Sidebar uses a background Web Worker to parse various Radiance result files
                    without freezing the interface. The application automatically detects the file type and enables the
                    relevant visualization tools.</p>
                <ul class="list-disc list-inside space-y-1 my-4">
                    <li><strong>3D Visualization</strong>: Illuminance data is mapped as a false-color grid onto the 3D
                        model, with a customizable color scale and support for comparing two datasets.</li>
                    <li><strong>Annual Metrics Dashboard</strong>: For annual <code>.ill</code> files, this dashboard
                        visualizes key metrics like Spatial Daylight Autonomy (sDA), Annual Sunlight Exposure (ASE), and
                        Useful Daylight Illuminance (UDI).</li>
                    <li><strong>Climate Analysis Dashboard</strong>: When an EPW file is loaded, this dashboard provides
                        interactive visualizations of the climate data, including a Wind Rose, Solar Radiation chart,
                        and Annual Temperature chart.</li>
                    <li><strong>Temporal Map</strong>: After loading annual results, clicking on any sensor point in the
                        3D view generates a 24x365 heatmap showing the hour-by-hour illuminance profile for that
                        specific point.</li>
                    <li><strong>Glare Rose Diagram</strong>: For annual <code>.dgp</code> files, this generates a polar
                        chart showing the number of occupied hours that exceed a DGP threshold, organized by the sun's
                        position.</li>
                    <li><strong>Combined Daylight vs. Glare Plot</strong>: When both annual illuminance and glare files
                        are loaded, this scatter plot is available. Each point represents a sensor, plotting its
                        percentage of useful daylight hours against its percentage of glare hours.</li>
                    <li><strong>HDR Viewer</strong>: Loads and displays rendered <code>.hdr</code> images with exposure
                        controls, a false-color luminance mode, and a mouse-over probe to get exact cd/m values.</li>
                    <li><strong>Advanced Circadian Health Dashboard</strong>: Visualizes results from spectral
                        simulations, including key metrics like Circadian Stimulus (CS), Equivalent Melanopic Lux (EML),
                        and checks for compliance with WELL building standards.</li>
                    <li><strong>Automated Report Generation</strong>: A "Generate Report" button compiles all project
                        information, a 3D snapshot, key metrics, and all dashboard charts into a single, self-contained
                        HTML file for printing or saving as a PDF.</li>
                </ul>

                <h3><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="1.5"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.572L16.5 21.75l-.398-1.178a3.375 3.375 0 00-2.456-2.456L12.5 18l1.178-.398a3.375 3.375 0 002.456-2.456L16.5 14.25l.398 1.178a3.375 3.375 0 002.456 2.456L20.5 18l-1.178.398a3.375 3.375 0 00-2.456 2.456z" />
                    </svg>Desktop Integration (Electron)</h3>
                <p class="mb-4">Ray Modeler operates as an Electron-based desktop application, enabling direct
                    interaction with your file system.</p>
                <ul class="list-disc list-inside space-y-1 my-4">
                    <li><strong>Standardized Project Folder</strong>: When you save a project, the application creates a
                        complete, organized folder structure on your local machine.</li>
                    <li><strong>Simulation Console</strong>: A built-in console window appears when you run a
                        simulation, showing the live output from the Radiance processes and reporting the final exit
                        code (success or failure).</li>
                </ul>

                <h2><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M11.42 15.17L17.15 20.898A2.577 2.577 0 0021.487 18.07m-8.632-8.632l-5.17-5.17m-1.745 6.917c-.36 0-.69-.14-.94-.39l-2.06-2.06c-.25-.25-.39-.58-.39-.94s.14-.69.39-.94l2.06-2.06c.25-.25.58-.39.94-.39s.69.14.94.39l2.06 2.06c.25.25.39.58.39.94s-.14.69-.39.94l-2.06 2.06c-.25.25-.58.39-.94.39zM17.657 8.343l-5.17-5.17m5.17 5.17l5.17 5.17M12 12c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm0 0l-5.17-5.17m5.17 5.17l5.17 5.17" />
                    </svg>For Developers: Building from Source</h2>
                <p class="mb-4">You can run the application in a local development environment or build a distributable,
                    single-click installer for macOS and Windows using <code>electron-builder</code>.</p>

                <h3><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="1.5"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.572L16.5 21.75l-.398-1.178a3.375 3.375 0 00-2.456-2.456L12.5 18l1.178-.398a3.375 3.375 0 002.456-2.456L16.5 14.25l.398 1.178a3.375 3.375 0 002.456 2.456L20.5 18l-1.178.398a3.375 3.375 0 00-2.456 2.456z" />
                    </svg>Prerequisites</h3>
                <p class="mb-4">Before you begin, ensure you have the following installed on your system:</p>
                <ul class="list-disc list-inside space-y-1 my-4">
                    <li><strong>Node.js and npm</strong>: <a href="https://nodejs.org/en" target="_blank"
                            class="text-[--text-secondary] underline">Download & Install Node.js</a> (npm is included).
                    </li>
                    <li><strong>Git</strong>: <a href="https://git-scm.com/" target="_blank"
                            class="text-[--text-secondary] underline">Download & Install Git</a>.</li>
                </ul>

                <h3><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="1.5"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.572L16.5 21.75l-.398-1.178a3.375 3.375 0 00-2.456-2.456L12.5 18l1.178-.398a3.375 3.375 0 002.456-2.456L16.5 14.25l.398 1.178a3.375 3.375 0 002.456 2.456L20.5 18l-1.178.398a3.375 3.375 0 00-2.456 2.456z" />
                    </svg>Setup and Development</h3>
                <h4 class="font-semibold text-sm uppercase text-[--text-secondary] mt-4">1. Clone the Repository and
                    Install Dependencies</h4>
                <pre class="bg-[--color-base-900] text-gray-200 p-4 rounded-md my-4 overflow-x-auto"><code class="language-bash"># Clone the repository
            git clone [https://github.com/your-username/ray-modeler.git](https://github.com/your-username/ray-modeler.git)

            # Navigate into the project directory
            cd ray-modeler

            # Install the necessary npm packages
            npm install

            # Update the npm packages
            npm update</code></pre>

                <h4 class="font-semibold text-sm uppercase text-[--text-secondary] mt-4">2. Run the App in Development
                    Mode</h4>
                <p class="mb-4">To run the full Electron application with all features (including file system access and
                    simulation execution), use the start script:</p>
                <pre
                    class="bg-[--color-base-900] text-gray-200 p-4 rounded-md my-4 overflow-x-auto"><code class="language-bash">npm start</code></pre>
                <p class="mb-4">This will launch the application in a development window with access to developer tools.
                </p>

                <h3><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="1.5"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.572L16.5 21.75l-.398-1.178a3.375 3.375 0 00-2.456-2.456L12.5 18l1.178-.398a3.375 3.375 0 002.456-2.456L16.5 14.25l.398 1.178a3.375 3.375 0 002.456 2.456L20.5 18l-1.178.398a3.375 3.375 0 00-2.456 2.456z" />
                    </svg>Building for Distribution</h3>
                <p class="mb-4">The following commands use <code>electron-builder</code> to package the application into
                    a distributable format. The final installer/application files will be located in the
                    <code>dist/</code> directory.
                </p>

                <h4 class="font-semibold text-sm uppercase text-[--text-secondary] mt-4">Build for macOS</h4>
                <p class="mb-4">This command bundles the application into a standard <code>.dmg</code> disk image for
                    macOS.</p>
                <pre
                    class="bg-[--color-base-900] text-gray-200 p-4 rounded-md my-4 overflow-x-auto"><code class="language-bash">npm run build:mac</code></pre>

                <h4 class="font-semibold text-sm uppercase text-[--text-secondary] mt-4">Build for Windows (from any
                    platform)</h4>
                <p class="mb-4">This command creates NSIS installers (<code>.exe</code>) for both <strong>x64</strong>
                    and <strong>arm64</strong> Windows architectures.</p>
                <p class="mb-4"><strong>Prerequisite for macOS/Linux users</strong>: To build a Windows app on a
                    non-Windows machine, you must have <a href="https://www.winehq.org/" target="_blank"
                        class="text-[--text-secondary] underline">Wine</a> installed. You can install it easily with
                    Homebrew:</p>
                <pre
                    class="bg-[--color-base-900] text-gray-200 p-4 rounded-md my-4 overflow-x-auto"><code class="language-bash">brew install --cask wine-stable</code></pre>
                <p class="mb-4">Once Wine is installed, run the build script:</p>
                <pre
                    class="bg-[--color-base-900] text-gray-200 p-4 rounded-md my-4 overflow-x-auto"><code class="language-bash">npm run build:win</code></pre>
                <p class="mb-4">This will generate two installers in the dist/ folder, for example: Ray Modeler Setup
                    1.1.0-x64.exe and Ray Modeler Setup 1.1.0-arm64.exe.</p>

                <h3><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="1.5"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.572L16.5 21.75l-.398-1.178a3.375 3.375 0 00-2.456-2.456L12.5 18l1.178-.398a3.375 3.375 0 002.456-2.456L16.5 14.25l.398 1.178a3.375 3.375 0 002.456 2.456L20.5 18l-1.178.398a3.375 3.375 0 00-2.456 2.456z" />
                    </svg>Cross-Platform Building</h3>
                <p class="mb-4">While it's recommended to build for a specific platform on that platform (e.g., build
                    for Windows on a Windows machine), <code>electron-builder</code> supports cross-platform compilation
                    with some setup:</p>
                <ul class="list-disc list-inside space-y-1 my-4">
                    <li><strong>Building for Windows on macOS/Linux</strong>: Requires installing <strong>Wine</strong>.
                    </li>
                    <li><strong>Building for macOS on Windows/Linux</strong>: Requires a macOS machine for code signing,
                        so it's not practically feasible.</li>
                    <li><strong>Building for Linux on macOS/Windows</strong>: Can be done directly.</li>
                </ul>
                <p class="mb-4">For detailed instructions on cross-platform builds, please refer to the <a
                        href="https://www.electron.build/multi-platform-build" target="_blank"
                        class="text-[--text-secondary] underline">electron-builder documentation</a>.</p>

                <h2><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M11.42 15.17L17.15 20.898A2.577 2.577 0 0021.487 18.07m-8.632-8.632l-5.17-5.17m-1.745 6.917c-.36 0-.69-.14-.94-.39l-2.06-2.06c-.25-.25-.39-.58-.39-.94s.14-.69.39-.94l2.06-2.06c.25-.25.58-.39.94-.39s.69.14.94.39l2.06 2.06c.25.25.39.58.39.94s-.14.69-.39.94l-2.06 2.06c-.25.25-.58.39-.94.39zM17.657 8.343l-5.17-5.17m5.17 5.17l5.17 5.17M12 12c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm0 0l-5.17-5.17m5.17 5.17l5.17 5.17" />
                    </svg>Technology Stack</h2>
                <ul class="list-disc list-inside space-y-1 my-4">
                    <li><strong>3D Rendering</strong>: <a href="https://threejs.org/" target="_blank"
                            class="text-[--text-secondary] underline">Three.js</a></li>
                    <li><strong>Lighting Simulation Engine</strong>: <a href="https://www.radiance-online.org/"
                            target="_blank" class="text-[--text-secondary] underline">Radiance</a></li>
                    <li><strong>Data Visualization</strong>: <a href="https://www.chartjs.org/" target="_blank"
                            class="text-[--text-secondary] underline">Chart.js</a></li>
                    <li><strong>Mapping</strong>: <a href="https://leafletjs.com/" target="_blank"
                            class="text-[--text-secondary] underline">Leaflet</a></li>
                    <li><strong>UI Framework</strong>: <a href="http://vanilla-js.com/" target="_blank"
                            class="text-[--text-secondary] underline">Vanilla JS</a>, HTML5, <a
                            href="https://tailwindcss.com/" target="_blank"
                            class="text-[--text-secondary] underline">CSS3 with TailwindCSS utilities</a></li>
                    <li><strong>Desktop App</strong>: <a href="https://www.electronjs.org/" target="_blank"
                            class="text-[--text-secondary] underline">Electron</a> (optional, for direct script
                        execution)</li>
                </ul>

                <h2><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="1.5"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                    </svg>License</h2>
                <p class="mb-4">This project is licensed under the <a href="https://opensource.org/license/mit"
                        target="_blank" class="text-[--text-secondary] underline">MIT</a> License - also see the LICENSE
                    file for details.</p>
            </div>
            <div class="resize-handle-edge top"></div>
            <div class="resize-handle-edge right"></div>
            <div class="resize-handle-edge bottom"></div>
            <div class="resize-handle-edge left"></div>
            <div class="resize-handle-corner top-left"></div>
            <div class="resize-handle-corner top-right"></div>
            <div class="resize-handle-corner bottom-left"></div>
            <div class="resize-handle-corner bottom-right"></div>
        </div>
        <div id="simulation-console-panel" class="floating-window ui-panel hidden" style="width: 700px; height: 450px;">
            <div class="window-header">
                <span>Simulation Console</span>
                <div class="window-controls">
                    <div class="window-icon-max"></div>
                    <div class="collapse-icon"></div>
                    <div class="window-icon-close"></div>
                </div>
            </div>
            <div class="window-content !p-0 flex flex-col">
                <div id="simulation-output"
                    class="flex-grow p-3 font-mono text-xs bg-[--grid-color] overflow-y-auto whitespace-pre-wrap"></div>
                <div class="p-2 border-t border-[--grid-color]">
                    <span id="simulation-status" class="text-sm">Status: Idle</span>
                </div>
            </div>
            <div class="resize-handle-edge right"></div>
            <div class="resize-handle-edge bottom"></div>
            <div class="resize-handle-edge left"></div>
            <div class="resize-handle-corner top-left"></div>
            <div class="resize-handle-corner top-right"></div>
            <div class="resize-handle-corner bottom-left"></div>
            <div class="resize-handle-corner bottom-right"></div>

        </div>
        <div id="proactive-suggestion-container"
            class="fixed bottom-24 right-8 z-[10001] flex flex-col items-end gap-2 w-full max-w-sm pointer-events-none">
        </div>

        <div id="climate-analysis-panel" class="floating-window ui-panel hidden" style="width: 950px; height: 820px;">
            <div class="window-header">
                <span>Climate Analysis</span>
                <div class="window-controls">
                    <div class="window-icon-max"></div>
                    <div class="collapse-icon"></div>
                    <div class="window-icon-close"></div>
                </div>
            </div>
            <div class="window-content !p-4 grid grid-cols-6 grid-rows-2 gap-6 h-full">
                <div class="flex flex-col items-center h-full col-span-2">
                    <h4 class="font-semibold text-xs uppercase text-[--text-secondary] mb-2">Wind Rose</h4>
                    <div class="w-full relative flex-grow"><canvas id="wind-rose-canvas"></canvas></div>
                </div>
                <div class="flex flex-col items-center h-full col-span-2">
                    <h4 class="font-semibold text-xs uppercase text-[--text-secondary] mb-2">Monthly Solar Radiation
                        (kWh/m)</h4>
                    <div class="w-full relative flex-grow"><canvas id="solar-radiation-canvas"></canvas></div>
                </div>
                <div class="flex flex-col items-center h-full col-span-2">
                    <h4 class="font-semibold text-xs uppercase text-[--text-secondary] mb-2">Annual Temperature Range
                        (C)</h4>
                    <div class="w-full relative flex-grow"><canvas id="temperature-chart-canvas"></canvas></div>
                </div>
                <div class="flex flex-col items-center h-full col-span-3">
                    <h4 class="font-semibold text-xs uppercase text-[--text-secondary] mb-2">Humidity & Comfort Profile
                    </h4>
                    <div class="w-full relative flex-grow"><canvas id="humidity-chart-canvas"></canvas></div>
                </div>
                <div class="flex flex-col items-center h-full col-span-3">
                    <h4 class="font-semibold text-xs uppercase text-[--text-secondary] mb-2">Sun Path Diagram</h4>
                    <div class="w-full relative flex-grow"><canvas id="sun-path-canvas"></canvas></div>
                </div>
            </div>
            <div class="resize-handle-edge top"></div>
            <div class="resize-handle-edge right"></div>
            <div class="resize-handle-edge bottom"></div>
            <div class="resize-handle-edge left"></div>
            <div class="resize-handle-corner top-left"></div>
            <div class="resize-handle-corner top-right"></div>

            <div class="resize-handle-corner bottom-left"></div>
            <div class="resize-handle-corner bottom-right"></div>
        </div>


        <div id="panel-analysis-modules" class="floating-window ui-panel hidden">
            <div class="window-header">
                <span>Analysis</span>
                <div class="window-controls">
                    <div class="window-icon-max"></div>
                    <div class="collapse-icon"></div>
                    <div class="window-icon-close"></div>
                </div>
            </div>
            <div class="window-content">
                <p class="text-sm text-gray-500 mb-6">Load a simulation results file to visualize data on the 3D model.
                </p>
                <div class="param-section">
                    <label for="results-file-input-a" class="btn btn-secondary w-full cursor-pointer text-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor" stroke-width="2" class="mr-2 inline-block">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                            </path>
                        </svg>
                        <span>Load Results File (A)</span>
                    </label>
                    <input type="file" id="results-file-input-a" class="hidden"
                        accept=".txt,.res,.ill,.hdr,.dgp,.ga,.epw">
                    <p id="results-file-name-a" class="text-sm text-gray-500 mt-2 text-center truncate"></p>
                </div>
                <div id="climate-analysis-controls"
                    class="param-section hidden pt-4 border-t border-dashed border-[--grid-color]">
                    <button id="climate-dashboard-btn" class="btn btn-secondary w-full">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor" stroke-width="2" class="mr-2 inline-block">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75z"></path>
                        </svg>
                        <span>Climate Analysis</span>
                    </button>
                </div>
                <div class="param-section pt-4 border-t border-dashed border-[--grid-color]">
                    <label for="compare-mode-toggle" class="flex items-center cursor-pointer w-full">
                        <input type="checkbox" id="compare-mode-toggle">
                        <span class="ml-3 label !text-gray-600 !uppercase-none !font-normal">
                            Enable Comparative Analysis
                        </span>
                    </label>
                </div>
                <div id="comparison-file-loader" class="param-section hidden">
                    <label for="results-file-input-b" class="btn btn-secondary w-full cursor-pointer text-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor" stroke-width="2" class="mr-2 inline-block">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                            </path>
                        </svg>
                        <span>Load Comparison File (B)</span>
                    </label>
                    <input type="file" id="results-file-input-b" class="hidden" accept=".txt,.res,.ill,.hdr,.dgp,.ga">
                    <p id="results-file-name-b" class="text-sm text-gray-500 mt-2 text-center truncate"></p>
                </div>
                <div class="param-section">
                    <button id="view-hdr-btn" class="btn btn-secondary w-full hidden">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor" stroke-width="2" class="mr-2 inline-block">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z">
                            </path>
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z">
                            </path>
                        </svg>
                        <span>View HDR Image</span>
                    </button>
                </div>
                <div id="results-dashboard" class="hidden space-y-5">
                    <div class="param-section">
                        <h4 class="font-semibold text-xs uppercase text-[--text-secondary]">3D Visualization Mode</h4>
                        <div id="view-mode-selector" class="btn-group mt-1">
                            <button id="view-mode-a-btn" class="btn active">Dataset A</button>
                            <button id="view-mode-b-btn" class="btn hidden">Dataset B</button>
                            <button id="view-mode-diff-btn" class="btn hidden">Difference (A-B)</button>
                        </div>
                    </div>
                    <div id="summary-stats-container" class="param-section">
                        <div id="summary-a">
                            <h4 class="font-semibold text-xs uppercase text-[--text-secondary]">Summary: Dataset A (lux)
                            </h4>
                            <div class="grid grid-cols-3 gap-2 text-center mt-2">
                                <div><span class="block text-xs">Min</span><span id="results-min-val-a"
                                        class="data-value font-mono">--</span></div>
                                <div><span class="block text-xs">Avg</span><span id="results-avg-val-a"
                                        class="data-value font-mono">--</span></div>
                                <div><span class="block text-xs">Max</span><span id="results-max-val-a"
                                        class="data-value font-mono">--</span></div>
                            </div>
                        </div>
                        <div id="summary-b" class="hidden mt-3">
                            <h4 class="font-semibold text-xs uppercase text-[--text-secondary]">Summary: Dataset B (lux)
                            </h4>
                            <div class="grid grid-cols-3 gap-2 text-center mt-2">
                                <div><span class="block text-xs">Min</span><span id="results-min-val-b"
                                        class="data-value font-mono">--</span></div>
                                <div><span class="block text-xs">Avg</span><span id="results-avg-val-b"
                                        class="data-value font-mono">--</span></div>
                                <div><span class="block text-xs">Max</span><span id="results-max-val-b"
                                        class="data-value font-mono">--</span></div>
                            </div>
                        </div>
                    </div>
                    <div id="metric-selector-container" class="param-section hidden">
                        <label for="metric-selector" class="label">3D View Metric</label>
                        <select id="metric-selector" class="w-full mt-1">
                        </select>
                    </div>
                    <div id="color-scale-section" class="param-section">
                        <div id="standard-color-scale">
                            <h4 class="font-semibold text-xs uppercase text-[--text-secondary]">Color Scale (lux)</h4>
                            <canvas id="results-legend" height="20"
                                class="w-full mt-2 rounded border border-[--grid-color]"></canvas>
                        </div>
                        <div id="difference-color-scale" class="hidden">
                            <h4 class="font-semibold text-xs uppercase text-[--text-secondary]">Difference Scale (lux)
                            </h4>
                            <canvas id="difference-legend" height="20"
                                class="w-full mt-2 rounded border border-[--grid-color]"></canvas>
                            <div class="flex justify-between text-xs font-mono mt-1">
                                <span id="diff-legend-min-label">--</span>
                                <span>0</span>
                                <span id="diff-legend-max-label">--</span>
                            </div>
                        </div>
                        <div class="flex justify-between text-xs font-mono mt-1">
                            <span id="legend-min-label">0</span>
                            <span id="legend-max-label">1000</span>
                        </div>
                    </div>
                    <div class="space-y-3 mt-3">
                        <div>
                            <label class="label text-xs flex justify-between" for="results-scale-min">
                                <span>Scale Min</span>
                                <input type="number" id="results-scale-min-num" class="param-input-num-sm">
                            </label>
                            <input type="range" id="results-scale-min" min="0" max="5000" value="0" step="10">
                        </div>
                        <div>
                            <label class="label text-xs flex justify-between" for="results-scale-max">
                                <span>Scale Max</span>
                                <input type="number" id="results-scale-max-num" class="param-input-num-sm">
                            </label>
                            <input type="range" id="results-scale-max" min="0" max="5000" value="1000" step="10">
                        </div>
                    </div>
                    <div>
                        <label for="results-palette" class="label text-xs">Color Palette</label>
                        <select id="results-palette" class="w-full mt-1">
                            <option value="viridis" selected>Viridis</option>
                            <option value="plasma">Plasma</option>
                            <option value="inferno">Inferno</option>
                            <option value="magma">Magma</option>
                            <option value="cividis">Cividis</option>
                        </select>
                    </div>
                </div>
                <div id="glare-analysis-dashboard"
                    class="hidden space-y-5 pt-4 border-t border-dashed border-[--grid-color]">
                    <div class="param-section">
                        <h4 class="font-semibold text-xs uppercase text-[--text-secondary]">Glare Analysis (evalglare)
                        </h4>
                        <div class="grid grid-cols-2 gap-2 text-center mt-2">
                            <div><span id="glare-metric-label" class="block text-xs">DGP</span><span id="glare-val"
                                    class="data-value font-mono text-lg">--</span></div>
                            <div><span class="block text-xs">Source Count</span><span id="glare-source-count"
                                    class="data-value font-mono text-lg">--</span></div>
                        </div>
                    </div>
                    <div class="param-section">
                        <div class="flex justify-between items-center">
                            <h4 class="font-semibold text-xs uppercase text-[--text-secondary]">Detected Glare Sources
                            </h4>
                            <button id="clear-glare-highlight-btn" class="btn btn-xs btn-secondary">Clear</button>
                        </div>
                        <p class="info-box !text-xs !py-2 !px-3">Click on a source to highlight it in the 3D view.</p>
                        <ul id="glare-source-list" class="space-y-1.5 mt-2 text-sm max-h-60 overflow-y-auto">
                        </ul>
                    </div>
                </div>
                <div id="annual-glare-controls"
                    class="hidden space-y-5 pt-4 border-t border-dashed border-[--grid-color]">
                    <h4 class="font-semibold text-xs uppercase text-[--text-secondary]">Annual Glare Analysis</h4>
                    <button id="glare-rose-btn" class="btn btn-secondary w-full">Generate Glare Rose Diagram</button>
                    <button id="combined-analysis-btn" class="btn btn-secondary w-full mt-2"
                        style="display: none;">Daylight vs. Glare Plot</button>
                </div>
                <div class="param-section">
                    <button id="results-dashboard-btn" class="btn btn-primary w-full mt-4">Results Dashboard</button>
                    <button id="data-table-btn" class="btn btn-secondary w-full mt-2 hidden">Show Data Table</button>
                    <button id="generate-report-btn" class="btn btn-secondary w-full mt-2 hidden">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor" stroke-width="2" class="mr-2 inline-block">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                            </path>
                        </svg>
                        <span>Generate Report</span>
                    </button>
                </div>
            </div>
            <div class="resize-handle-edge top"></div>
            <div class="resize-handle-edge right"></div>
            <div class="resize-handle-edge bottom"></div>
            <div class="resize-handle-edge left"></div>
            <div class="resize-handle-corner top-left"></div>
            <div class="resize-handle-corner top-right"></div>
            <div class="resize-handle-corner bottom-left"></div>
            <div class="resize-handle-corner bottom-right"></div>
        </div>
        </div>

        <div id="panel-recipe-guides" class="floating-window ui-panel hidden" style="width: 600px; height: 70vh;">
            <div class="window-header">
                <span>Recipe Guides</span>
                <div class="window-controls">
                    <div class="window-icon-max"></div>
                    <div class="collapse-icon"></div>
                    <div class="window-icon-close"></div>
                </div>
            </div>
            <div class="window-content space-y-4">
                <div>
                    <label for="guide-selector" class="label">Select a Recipe Guide</label>
                    <select id="guide-selector" class="w-full mt-1">
                        <option value="" disabled selected>-- Choose a guide to display --</option>
                    </select>
                </div>
                <div id="guide-content"
                    class="prose max-w-none h-full overflow-y-auto border border-[--grid-color] p-4 rounded-md bg-[--grid-color]">
                    <p class="text-[--text-secondary]">Please select a recipe from the dropdown above to see its guide.
                    </p>
                </div>
            </div>
            <div class="resize-handle-edge top"></div>
            <div class="resize-handle-edge right"></div>
            <div class="resize-handle-edge bottom"></div>
            <div class="resize-handle-edge left"></div>
            <div class="resize-handle-corner top-left"></div>
            <div class="resize-handle-corner top-right"></div>
            <div class="resize-handle-corner bottom-left"></div>
            <div class="resize-handle-corner bottom-right"></div>
        </div>
    </main>
    <div id="left-docking-container"
        class="fixed top-0 bottom-0 left-[60px] z-[99] hidden flex-col border-r border-[--grid-color] bg-[--docked-panel-bg] overflow-hidden"
        style="width: var(--docked-panel-width, 380px);">
        <div id="docked-panels-content" class="flex-grow overflow-y-auto">
        </div>
        <div id="docked-panel-resizer" class="absolute top-0 bottom-0 right-0 w-2 cursor-ew-resize z-[100]"></div>
    </div>


    <div id="sidebar-wrapper">
        <div id="ai-assistant-toggle-container" class="action-button-container">
            <button id="ai-assistant-button" class="bottom-action-button" aria-label="Open Helios Assistant">
                <svg xmlns="http://www.w3.org/2000/svg" height="28px" viewBox="0 0 14 14" width="28px"
                    fill="currentColor">
                    <path fill-rule="evenodd" clip-rule="evenodd"
                        d="M11.958 10.945a1.786 1.786 0 1 1-3.573 0 1.786 1.786 0 0 1 3.573 0Zm-.298-3.84a1.489 1.489 0 1 1-2.978 0 1.489 1.489 0 0 1 2.978 0ZM13 5.287a.744.744 0 1 1-1.489 0 .744.744 0 0 1 1.489 0ZM8.325 4.93a3.663 3.663 0 0 1-3.662 3.662A3.663 3.663 0 0 1 1 4.931a3.663 3.663 0 0 1 3.663-3.663 3.663 3.663 0 0 1 3.662 3.663Z" />
                </svg>
            </button>
            <span class="tooltip" role="tooltip">Helios Assistant</span>
        </div>
        <aside id="right-sidebar" class="ui-panel closed flex flex-col">
            <div class="resize-handle-edge left" style="cursor: ew-resize;"></div>
            <div class="window-header">
                <div class="flex items-center gap-4">
                    <div class="ai-mode-selector">
                        <span class="font-semibold text-sm uppercase">Helios</span>
                    </div>
                </div>
                <div class="window-controls">
                    <div class="action-button-container">
                        <button id="ai-settings-btn" class="btn btn-icon" aria-label="Settings">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <path d="M18.48 18.537H21m-10.831-6.493H21m-8.199-6.493H3m18 0h-2.52M3 18.537h9.801"
                                    stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                                <path
                                    d="M17.88 18.6a2.4 2.4 0 1 1-4.8 0 2.4 2.4 0 0 1 4.8 0ZM9.48 12a2.4 2.4 0 1 1-4.8 0 2.4 2.4 0 0 1 4.8 0Zm8.4-6.6a2.4 2.4 0 1 1-4.8 0 2.4 2.4 0 0 1 4.8 0Z"
                                    stroke="var(--highlight-color)" stroke-width="1.5" stroke-linecap="round" />
                            </svg>
                        </button>
                        <span class="tooltip" role="tooltip">Helios Settings</span>
                    </div>
                    <div class="action-button-container">
                        <button id="ai-info-btn" class="btn btn-icon" aria-label="Info">
                            <svg width="24" height="24" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M16.247 4.733c0 1.684 1.271 2.825 2.84 2.825s2.842-1.142 2.842-2.825c0-1.685-1.272-2.826-2.842-2.826-1.568 0-2.84 1.141-2.84 2.826"
                                    fill="var(--highlight-color)" />
                                <path
                                    d="m10.096 14.375c0 .334-.061 1.163.008 1.662l2.479-2.983c.513-.562 1.106-.955 1.409-.849s.47.463.371.795L10.26 26.59c-.473 1.588.421 3.148 2.599 3.504 3.189 0 5.084-2.158 6.948-4.955 0-.334.111-1.213.044-1.713l-2.479 2.982c-.514.562-1.151.955-1.455.85-.28-.098-.444-.41-.389-.721l4.132-13.653c.344-1.734-.59-3.312-2.564-3.514-2.076.001-5.136 2.209-7 5.005"
                                    fill="currentColor" />
                            </svg>
                        </button>
                        <span class="tooltip" role="tooltip">Helios Info</span>
                    </div>
                    <div class="action-button-container">
                        <button id="ai-new-chat-btn" class="btn btn-icon" aria-label="New Chat">
                            <svg width="24" height="24" viewBox="0 0 24 24" data-name="Flat Color"
                                xmlns="http://www.w3.org/2000/svg" class="icon flat-color">
                                <rect x="2" y="3" width="20" height="18" rx="2" fill="currentColor" />
                                <circle cx="6" cy="12" r="1.5" fill="var(--highlight-color)" />
                            </svg>
                        </button>
                        <span class="tooltip" role="tooltip">New Chat</span>
                    </div>
                </div>
            </div>
            <div id="ai-chat-tabs"
                class="flex items-center px-4 py-2 border-b border-[--grid-color] bg-[--grid-color] gap-2">
                <button id="ai-chat-tab-1" class="ai-chat-tab active" data-tab="1">Chat 1</button>

                <button id="helios-ep-optimization-tab-btn" class="ai-chat-tab" data-tab="ep-optimization">
                    E+ Optimization
                </button>
            </div>
            <div id="helios-panel-content" class="flex-grow flex flex-col overflow-y-auto">
                <!-- Chat tab content -->
                <div id="ai-chat-content-1" class="ai-chat-content flex flex-col flex-grow">
                    <div id="ai-chat-messages" class="flex-grow p-4 space-y-4 overflow-y-auto">
                    </div>
                    <div id="ai-inspector-results" class="flex-grow p-4 space-y-3 overflow-y-auto hidden">
                        <div class="text-center text-sm text-[--text-secondary] p-4">
                            <p>Click "Run Inspector" to analyze your current project setup for potential issues and
                                design suggestions.</p>
                        </div>
                    </div>
                    <div id="ai-critique-results" class="flex-grow p-4 space-y-3 overflow-y-auto hidden">
                        <div class="text-center text-sm text-[--text-secondary] p-4">
                            <p>Load a simulation result file, then click "Analyze Results" for an AI-powered critique
                                and design suggestions.</p>
                        </div>
                    </div>

                    <div id="ai-chat-input-container" class="p-4 border-t border-[--grid-color] relative">
                        <div id="chat-resize-handle"></div>
                        <form id="ai-chat-form" class="flex gap-2 items-end">
                            <textarea id="ai-chat-input" placeholder="Ex tenebris lux" class="flex-grow"
                                autocomplete="off" rows="1"></textarea>
                            <button type="submit" id="ai-chat-send" class="btn btn-primary">Send</button>
                        </form>
                    </div>
                </div>

                <!-- EP optimization content will be injected here from template-ep-optimization-panel -->
                <div id="helios-ep-optimization-content" class="ai-chat-content hidden flex flex-col flex-grow"></div>
            </div>
        </aside>
    </div>

    <div id="results-analysis-panel" class="floating-window ui-panel hidden">
        <div class="window-header">
            <span>Results Analysis</span>
            <div class="window-controls">
                <div class="window-icon-max"></div>
                <div class="collapse-icon"></div>
                <div class="window-icon-close"></div>
            </div>

        </div>
        <div class="window-content space-y-5">
            <div class="param-section">
                <h4 class="font-semibold text-xs uppercase text-[--text-secondary]">Summary Statistics</h4>
                <div id="results-summary-stats" class="grid grid-cols-4 gap-2 text-center mt-2">
                    <div><span class="block text-xs">Min</span><span id="stats-min-val"
                            class="data-value font-mono">--</span></div>
                    <div><span class="block text-xs">Max</span><span id="stats-max-val"
                            class="data-value font-mono">--</span></div>
                    <div><span class="block text-xs">Average</span><span id="stats-avg-val"
                            class="data-value font-mono">--</span></div>
                    <div><span class="block text-xs">Uniformity</span><span id="stats-uniformity-val"
                            class="data-value font-mono">--</span></div>
                </div>
            </div>
            <div class="param-section">
                <h4 class="font-semibold text-xs uppercase text-[--text-secondary]">Analysis Tools</h4>
                <div class="btn-group mt-2">
                    <button id="highlight-min-btn" class="btn btn-secondary">Highlight Min</button>
                    <button id="highlight-max-btn" class="btn btn-secondary">Highlight Max</button>
                    <button id="clear-highlights-btn" class="btn btn-secondary">Clear</button>
                </div>
            </div>
            <div class="param-section">
                <h4 class="font-semibold text-xs uppercase text-[--text-secondary]">Illuminance Distribution</h4>
                <div class="mt-2"><canvas id="illuminance-histogram"></canvas></div>
            </div>
            <div class="param-section">
                <h4 class="font-semibold text-xs uppercase text-[--text-secondary]">False-Color Scale</h4>
                <canvas id="interactive-legend" height="20"
                    class="w-full mt-2 rounded border border-[--grid-color]"></canvas>
                <div class="flex justify-between text-xs font-mono mt-1">
                    <span id="legend-min-val">0</span>
                    <span id="legend-max-val">1000</span>
                </div>
                <div class="space-y-3 mt-3">
                    <div>
                        <label class="label text-xs flex justify-between" for="scale-min-input">
                            <span>Scale Min</span>
                            <input type="number" id="scale-min-input-num" class="param-input-num-sm">
                        </label>
                        <input type="range" id="scale-min-input" min="0" max="5000" value="0" step="10">
                    </div>
                    <div>
                        <label class="label text-xs flex justify-between" for="scale-max-input">
                            <span>Scale Max</span>
                            <input type="number" id="scale-max-input-num" class="param-input-num-sm">
                        </label>
                        <input type="range" id="scale-max-input" min="0" max="5000" value="1000" step="10">
                    </div>
                </div>
            </div>
            <div class="param-section">
                <h4 class="font-semibold text-xs uppercase text-[--text-secondary]">2D Floor Plan Heatmap</h4>
                <div id="heatmap-controls-container" class="hidden mt-2 space-y-3">
                    <div>
                        <label for="heatmap-mode-selector" class="label text-xs">Display Mode</label>
                        <select id="heatmap-mode-selector" class="w-full mt-1">
                            <option value="illuminance">Illuminance</option>
                            <option value="da">Daylight Autonomy</option>
                        </select>
                    </div>
                    <div id="da-threshold-controls" class="hidden">
                        <label class="label text-xs flex justify-between" for="da-threshold-slider">
                            <span>DA Threshold (lux)</span>
                            <span id="da-threshold-val" class="data-value font-mono">300 lux</span>
                        </label>
                        <input type="range" id="da-threshold-slider" min="50" max="1000" value="300" step="10">
                    </div>
                </div>
                <div class="mt-2 aspect-square bg-[--grid-color] rounded overflow-hidden">
                    <canvas id="heatmap-canvas" class="w-full h-full"></canvas>
                </div>
            </div>

            <div class="param-section pt-4 border-t border-dashed border-[--grid-color]">
                <h4 class="font-semibold text-xs uppercase text-[--text-secondary]">Point Annual Profile (<span
                        id="annual-profile-point-id">select point</span>)</h4>
                <p class="info-box !text-xs !py-2 !px-3">Right-click a sensor point in the 3D view and select "Show
                    Annual Profile" to populate this chart.</p>
                <div class="mt-2 h-64 relative"><canvas id="point-annual-profile-chart"></canvas></div>
            </div>

            <div id="annual-time-series-explorer"
                class="hidden space-y-5 pt-4 border-t border-dashed border-[--grid-color]">
                <h4 class="font-semibold text-xs uppercase text-[--text-secondary]">Time-Series Explorer</h4>
                <div class="pt-2">
                    <h5 class="font-semibold text-sm text-center">Space-Averaged Illuminance</h5>
                    <p class="text-xs text-center text-[--text-secondary] mt-1">Full Year (8760 hours)</p>
                    <div class="mt-2 h-40 relative"><canvas id="time-series-chart"></canvas></div>
                </div>
                <div class="pt-4">
                    <label class="label text-xs flex justify-between" for="time-scrubber">
                        <span>3D Scrubber (Hour of Year)</span>
                        <span id="time-scrubber-display" class="data-value font-mono">Jul 2, 12:00</span>
                    </label>
                    <div class="flex items-center space-x-3 mt-1">
                        <input type="range" id="time-scrubber" min="0" max="8759" value="4380" step="1">
                    </div>
                </div>
            </div>
            <div id="spectral-metrics-dashboard"
                class="hidden space-y-5 pt-4 border-t border-dashed border-[--grid-color]">
                <h4 class="font-semibold text-xs uppercase text-[--text-secondary]">Spectral Lighting Metrics</h4>
                <p class="info-box !text-xs !py-2 !px-3">These are space-averaged values from the sensor grid. Load the
                    respective text file (e.g., photopic_illuminance.txt) to see the 3D visualization.</p>
            </div>
        </div>
        <div class="resize-handle-edge top"></div>
        <div class="resize-handle-edge right"></div>
        <div class="resize-handle-edge bottom"></div>
        <div class="resize-handle-edge left"></div>
        <div class="resize-handle-corner top-left"></div>
        <div class="resize-handle-corner top-right"></div>
        <div class="resize-handle-corner bottom-left"></div>
        <div class="resize-handle-corner bottom-right"></div>
    </div>
    </div>
    </div>

    <div id="sensor-context-menu" class="hidden absolute z-[1000] ui-panel !p-1">
        <button id="set-viewpoint-here-btn" class="btn btn-secondary !py-2 !px-4 !text-sm">Set Viewpoint Here</button>
        <button id="show-annual-profile-btn" class="btn btn-secondary !py-2 !px-4 !text-sm mt-1 hidden">Show Annual
            Profile</button>
    </div>

    <div id="data-table-panel" class="floating-window ui-panel hidden" style="width: 400px; height: 500px;">
        <div class="window-header">
            <span>Interactive Data Table</span>
            <div class="window-controls">
                <div class="window-icon-max"></div>
                <div class="collapse-icon"></div>
                <div class="window-icon-close"></div>
            </div>
        </div>
        <div class="window-content !p-0 flex flex-col">
            <div class="p-3 border-b border-[--grid-color]">
                <input type="text" id="data-table-filter-input" placeholder="Filter data (e.g., > 500, <= 100)"
                    class="w-full">
            </div>
            <div class="flex-grow overflow-auto">
                <table id="results-data-table" class="w-full text-sm text-left">
                    <thead id="data-table-head" class="sticky top-0 bg-[--panel-bg] z-10">
                    </thead>
                    <tbody id="data-table-body">
                    </tbody>
                </table>
            </div>
        </div>
        <div class="resize-handle-edge top"></div>
        <div class="resize-handle-edge right"></div>
        <div class="resize-handle-edge bottom"></div>
        <div class="resize-handle-edge left"></div>
        <div class="resize-handle-corner top-left"></div>
        <div class="resize-handle-corner top-right"></div>
        <div class="resize-handle-corner bottom-left"></div>
        <div class="resize-handle-corner bottom-right"></div>
    </div>

    <div id="custom-alert" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center">
        <div class="ui-panel p-6 w-full max-w-sm mx-auto bg-[--bg-main]">
            <h3 id="custom-alert-title" class="text-lg font-bold mb-4">Notification</h3>
            <p id="custom-alert-message" class="text-sm mb-6"></p><button id="custom-alert-close"
                class="btn btn-primary w-full">Close</button>
        </div>
    </div>

    <div id="epw-upload-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center">
        <div class="ui-panel p-6 w-full max-w-lg mx-auto bg-[--bg-main] relative">
            <button id="epw-modal-close" class="absolute top-3 right-3 text-gray-500 hover:text-gray-800"
                aria-label="Close EPW Upload Modal">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
            <h3 class="text-lg font-bold mb-4">Upload Climate Data File</h3>
            <div id="modal-file-drop-area" class="file-drop-area">
                <svg width="40" height="40" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                        d="M7 16a4 4 0 01-4-4V7a4 4 0 014-4h.586a1 1 0 01.707.293l2 2a1 1 0 00.707.293H12.5A2.5 2.5 0 0115 11v.5a2.5 2.5 0 01-2.5 2.5h-1a1 1 0 00-.707.293l-2 2A1 1 0 017.586 16H7z">
                    </path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                        d="M12 11h4.5a2.5 2.5 0 012.5 2.5V17a4 4 0 01-4 4h-1.5a1 1 0 01-.707-.293l-2-2A1 1 0 009.586 18H9">
                    </path>
                </svg>
                <p>Upload EPW file or drag and drop</p>
            </div>
        </div>
    </div>
    <div id="ai-settings-modal"
        class="fixed inset-0 bg-black bg-opacity-50 z-[10002] hidden items-center justify-center">
        <div class="ui-panel p-6 w-full max-w-md mx-auto bg-[--bg-main] relative">
            <button id="ai-settings-close-btn"
                class="absolute top-3 right-3 text-[--text-secondary] hover:text-[--text-primary]"
                aria-label="Close Helios Settings">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
            <h3 class="text-lg font-bold mb-4">Helios Settings</h3>
            <form id="ai-settings-form" class="space-y-4">
                <div>
                    <label for="ai-provider-select" class="label">AI Provider</label>
                    <select id="ai-provider-select" class="w-full">
                        <option value="openrouter">OpenRouter</option>
                        <option value="openai">OpenAI</option>
                        <option value="gemini">Google Gemini</option>
                        <option value="anthropic">Anthropic</option>
                    </select>
                </div>
                <div>
                    <label for="ai-model-select" class="label">Model</label>
                    <select id="ai-model-select" class="w-full"></select>
                </div>
                <div>
                    <label for="ai-custom-model-input" class="label">Custom Model ID (Optional)</label>
                    <input type="text" id="ai-custom-model-input" placeholder="e.g., gpt-4, claude-3-sonnet"
                        class="w-full">
                    <p class="text-xs text-[--text-secondary] mt-1">Enter a custom model ID if your preferred model
                        isn't in the list above.</p>
                </div>
                <div>
                    <label for="ai-model-access-token" class="label">API Key</label>
                    <input type="password" id="ai-secret-field" placeholder="Enter your API key" class="w-full"
                        autocomplete="new-password">
                </div>
                <div id="openrouter-info-box" class="info-box !text-xs hidden">
                    <b>Note:</b> To use free models on OpenRouter, you may need to adjust your
                    <a href="https://openrouter.ai/settings/privacy" target="_blank"
                        class="text-[--text-secondary] underline">privacy settings</a>
                    to allow your data to be used for model improvement.
                </div>
                <button type="submit" class="btn btn-primary w-full mt-4">Save Settings</button>
            </form>
        </div>
    </div>

    <div id="helios-capabilities-modal"
        class="fixed inset-0 bg-black bg-opacity-50 z-[10002] hidden items-center justify-center">
        <div class="ui-panel p-6 w-full max-w-4xl mx-auto bg-[--bg-main] relative"
            style="max-height: 90vh; overflow-y: auto;">
            <button id="helios-capabilities-close-btn"
                class="absolute top-3 right-3 text-[--text-secondary] hover:text-[--text-primary]"
                aria-label="Close Helios Capabilities">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
            <div class="flex items-center gap-3 mb-6">
                <div>
                    <h3 class="text-2xl font-bold">Helios AI Assistant</h3>
                    <p class="text-[--text-secondary]">Your Comprehensive AI Assistant for Advanced Daylighting
                        Simulation</p>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="space-y-6">
                    <div>
                        <h4 class="text-lg font-semibold mb-3 flex items-center gap-2">
                            Conversational AI & Help
                        </h4>
                        <p class="text-sm text-[--text-secondary] mb-3">Get instant answers to questions about Radiance,
                            daylighting concepts, and simulation best practices.</p>
                        <div class="bg-[--grid-color] rounded-lg p-3 text-sm">
                            <strong>Examples:</strong><br>
                             "What is Daylight Autonomy and how do I calculate it?"<br>
                             "Explain the `-ab` parameter in Radiance and why it's important."<br>
                             "What's the difference between `rtrace` and `rpict`?"
                        </div>
                    </div>

                    <div>
                        <h4 class="text-lg font-semibold mb-3 flex items-center gap-2">
                            Generative Scene Design
                        </h4>
                        <p class="text-sm text-[--text-secondary] mb-3">Create complete 3D scenes using natural language
                            descriptions.</p>
                        <div class="bg-[--grid-color] rounded-lg p-3 text-sm">
                            <strong>Example:</strong> "Create a 10m x 8m office with south-facing windows and add two
                            desks in the center."
                        </div>
                    </div>

                    <div>
                        <h4 class="text-lg font-semibold mb-3 flex items-center gap-2">
                            Design Inspector
                        </h4>
                        <p class="text-sm text-[--text-secondary] mb-3">Analyze your project configuration for potential
                            issues and conflicts.</p>
                        <div class="bg-[--grid-color] rounded-lg p-3 text-sm">
                            <strong>Example:</strong> "Check my project for simulation issues"  Identifies unrealistic
                            material properties or conflicting settings.
                        </div>
                    </div>

                    <div>
                        <h4 class="text-lg font-semibold mb-3 flex items-center gap-2">
                            Results Analysis & Critique
                        </h4>
                        <p class="text-sm text-[--text-secondary] mb-3">Analyze simulation results and get specific
                            design improvement suggestions.</p>
                        <div class="bg-[--grid-color] rounded-lg p-3 text-sm">
                            <strong>Example:</strong> "Analyze my DGP results"  Identifies glare problems and suggests
                            specific fixes.
                        </div>
                    </div>
                </div>

                <div class="space-y-6">
                    <div>
                        <h4 class="text-lg font-semibold mb-3 flex items-center gap-2">
                            Data Explorer
                        </h4>
                        <p class="text-sm text-[--text-secondary] mb-3">Query and compare loaded datasets using natural
                            language commands.</p>
                        <div class="bg-[--grid-color] rounded-lg p-3 text-sm">
                            <strong>Examples:</strong><br>
                             "Compare sDA between my two designs"<br>
                             "Show me points with illuminance below 300 lux"<br>
                             "What is the average daylight factor?"
                        </div>
                    </div>

                    <div>
                        <h4 class="text-lg font-semibold mb-3 flex items-center gap-2">
                            Interactive Tutor
                        </h4>
                        <p class="text-sm text-[--text-secondary] mb-3">Get step-by-step guidance through complex
                            simulation workflows.</p>
                        <div class="bg-[--grid-color] rounded-lg p-3 text-sm">
                            <strong>Example:</strong> "Teach me how to run a glare analysis"  Step-by-step walkthrough
                            with automatic UI actions.
                        </div>
                    </div>

                    <div>
                        <h4 class="text-lg font-semibold mb-3 flex items-center gap-2">
                            Direct Action Tools
                        </h4>
                        <p class="text-sm text-[--text-secondary] mb-3">Execute specific actions directly through
                            natural language commands.</p>
                        <div class="bg-[--grid-color] rounded-lg p-3 text-sm">
                            <strong>Examples:</strong><br>
                             "Add a 0.5m overhang to the south wall"<br>
                             "Set ambient bounces to 6"<br>
                             "Load results file into dataset A"
                        </div>
                    </div>

                    <div>
                        <h4 class="text-lg font-semibold mb-3 flex items-center gap-2">
                            Design Optimization
                        </h4>
                        <p class="text-sm text-[--text-secondary] mb-3">Run automated optimization studies to find
                            optimal design parameters.</p>
                        <div class="bg-[--grid-color] rounded-lg p-3 text-sm">
                            <strong>Example:</strong> "Find the best overhang depth between 0.5m and 2.0m that maximizes
                            sDA while keeping ASE below 10%."
                        </div>
                    </div>

                    <div>
                        <h4 class="text-lg font-semibold mb-3 flex items-center gap-2">
                            EnergyPlus Integration
                        </h4>
                        <p class="text-sm text-[--text-secondary] mb-3">Generate, run, and critique EnergyPlus
                            simulations directly from your model configuration.</p>
                        <div class="bg-[--grid-color] rounded-lg p-3 text-sm">
                            <strong>Examples:</strong><br>
                             "Generate an EnergyPlus IDF from my project."<br>
                             "What is the total Site EUI for my last E+ run?"<br>
                             "Critique my EnergyPlus results and suggest improvements."
                        </div>
                    </div>

                    <div>
                        <h4 class="text-lg font-semibold mb-3 flex items-center gap-2">
                            EnergyPlus Optimization
                        </h4>
                        <p class="text-sm text-[--text-secondary] mb-3">Use a genetic algorithm to find optimal
                            EnergyPlus operational **and** envelope parameters for your building.</p>
                        <div class="bg-[--grid-color] rounded-lg p-3 text-sm">
                            <strong>Examples:</strong><br>
                             "Set up an E+ optimization to minimize total site energy."<br>
                             "Find the best Window U-Value (from 1.0 to 3.0) and SHGC (from 0.2 to 0.7)."<br>
                             "Optimize heating/cooling setpoints, but **constrain unmet heating hours to be less than
                            150**."<br>
                             "Test different infiltration rates (ACH) vs. lighting power."<br>
                             "Analyze my E+ optimization results."
                        </div>
                    </div>
                </div>
            </div>
            <div class="mt-8 pt-6 border-t border-[--grid-color]">
                <h4 class="text-lg font-semibold mb-4">Supported AI Providers</h4>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="text-center p-3 bg-[--grid-color] rounded-lg">
                        <div class="font-semibold text-sm">OpenRouter</div>
                        <div class="text-xs text-[--text-secondary]">Multiple models</div>
                    </div>
                    <div class="text-center p-3 bg-[--grid-color] rounded-lg">
                        <div class="font-semibold text-sm">OpenAI</div>
                        <div class="text-xs text-[--text-secondary]">GPT-4, GPT-3.5</div>
                    </div>
                    <div class="text-center p-3 bg-[--grid-color] rounded-lg">
                        <div class="font-semibold text-sm">Google Gemini</div>
                        <div class="text-xs text-[--text-secondary]">Gemini Pro</div>
                    </div>
                    <div class="text-center p-3 bg-[--grid-color] rounded-lg">
                        <div class="font-semibold text-sm">Anthropic</div>
                        <div class="text-xs text-[--text-secondary]">Claude models</div>
                    </div>
                </div>
            </div>

            <div class="mt-6 pt-6 border-t border-[--grid-color]">
                <p class="text-sm text-[--text-secondary] text-center">
                    Helios combines all these capabilities into a unified, context-aware assistant that understands your
                    Ray Modeler project and can help with any aspect of your daylighting simulation workflow.
                </p>
            </div>
        </div>
    </div>

    <div id="shortcut-help-modal"
        class="fixed inset-0 bg-black bg-opacity-50 z-[10002] hidden items-center justify-center">
        <div class="ui-panel p-6 w-full max-w-2xl mx-auto bg-[--bg-main] relative">
            <button id="shortcut-modal-close-btn"
                class="absolute top-3 right-3 text-[--text-secondary] hover:text-[--text-primary]"
                aria-label="Close Shortcuts">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
            <h3 class="text-lg font-bold mb-4">Keyboard Shortcuts</h3>
            <div class="grid grid-cols-2 gap-x-8 gap-y-4 text-sm">
                <div>
                    <h4 class="font-semibold uppercase text-xs text-[--text-secondary] mb-2">File</h4>
                    <div class="space-y-1">
                        <div class="flex justify-between"><span>Save Project</span>
                            <div class="flex gap-1"><kbd class="kbd">Ctrl</kbd><kbd class="kbd">S</kbd></div>
                        </div>
                        <div class="flex justify-between"><span>Load Project</span>
                            <div class="flex gap-1"><kbd class="kbd">Ctrl</kbd><kbd class="kbd">O</kbd></div>
                        </div>
                        <div class="flex justify-between"><span>Save Current View</span>
                            <div class="flex gap-1"><kbd class="kbd">Shift</kbd><kbd class="kbd">S</kbd></div>
                        </div>
                    </div>
                </div>
                <div>
                    <h4 class="font-semibold uppercase text-xs text-[--text-secondary] mb-2">Views</h4>
                    <div class="space-y-1">
                        <div class="flex justify-between"><span>Perspective</span><kbd class="kbd">P</kbd></div>
                        <div class="flex justify-between"><span>Orthographic</span><kbd class="kbd">O</kbd></div>
                        <div class="flex justify-between"><span>Top</span><kbd class="kbd">T</kbd></div>
                        <div class="flex justify-between"><span>Front</span><kbd class="kbd">F</kbd></div>
                        <div class="flex justify-between"><span>Back</span><kbd class="kbd">B</kbd></div>
                        <div class="flex justify-between"><span>Left</span><kbd class="kbd">L</kbd></div>
                        <div class="flex justify-between"><span>Right</span><kbd class="kbd">R</kbd></div>
                        <div class="flex justify-between"><span>Toggle Quad View</span><kbd class="kbd">Q</kbd></div>
                    </div>
                </div>
                <div>
                    <h4 class="font-semibold uppercase text-xs text-[--text-secondary] mb-2">Panels</h4>
                    <div class="space-y-1">
                        <div class="flex justify-between"><span>Project Setup</span><kbd class="kbd">1</kbd></div>
                        <div class="flex justify-between"><span>Dimensions</span><kbd class="kbd">2</kbd></div>
                        <div class="flex justify-between"><span>Apertures</span><kbd class="kbd">3</kbd></div>
                        <div class="flex justify-between"><span>Lighting</span><kbd classB="kbd">4</kbd></div>
                        <div class="flex justify-between"><span>Materials</span><kbd class="kbd">5</kbd></div>
                        <div class="flex justify-between"><span>Sensor Grid</span><kbd class="kbd">6</kbd></div>
                        <div class="flex justify-between"><span>Viewpoint</span><kbd class="kbd">7</kbd></div>
                        <div class="flex justify-between"><span>Scene Elements</span><kbd class="kbd">8</kbd></div>
                    </div>
                </div>
                <div>
                    <h4 class="font-semibold uppercase text-xs text-[--text-secondary] mb-2">Tools</h4>
                    <div class="space-y-1">
                        <div class="flex justify-between"><span>Info Panel</span><kbd class="kbd">I</kbd></div>
                        <div class="flex justify-between"><span>AI Assistant</span><kbd class="kbd">A</kbd></div>
                        <div class="flex justify-between"><span>Toggle FPV Mode</span><kbd class="kbd">V</kbd></div>
                        <div class="flex justify-between"><span>Toggle Gizmo</span><kbd class="kbd">G</kbd></div>
                        <div class="flex justify-between"><span>Toggle Resize Mode</span><kbd class="kbd">M</kbd></div>
                        <div class="flex justify-between"><span>Move Gizmo</span><kbd class="kbd">W</kbd></div>
                        <div class="flex justify-between"><span>Rotate Gizmo</span><kbd class="kbd">E</kbd></div>
                        <div class="flex justify-between"><span>Scale Gizmo</span><kbd class="kbd">R</kbd></div>
                    </div>
                </div>
            </div>
            <p class="text-xs text-[--text-secondary] mt-4 text-center">Shortcuts are disabled when typing in input
                fields.</p>
        </div>
    </div>

    <div id="add-opt-param-modal"
        class="fixed inset-0 bg-black bg-opacity-50 z-[10002] hidden items-center justify-center">
        <div class="ui-panel p-6 w-full max-w-md mx-auto bg-[--bg-main] relative">
            <h3 class="text-lg font-bold mb-4">Add Parameter to Optimize</h3>
            <div class="space-y-4">
                <div>
                    <label for="opt-param-domain-select" class="label">1. Select Domain</label>
                    <select id="opt-param-domain-select" class="w-full">
                        <option value="">Select Domain...</option>
                    </select>
                </div>
                <div>
                    <label for="opt-param-target-select" class="label">2. Select Target</label>
                    <select id="opt-param-target-select" class="w-full">
                        <option value="">Select Target...</option>
                    </select>
                </div>
                <div>
                    <label for="opt-param-name-select" class="label">3. Select Parameter</label>
                    <select id="opt-param-name-select" class="w-full">
                        <option value="">Select Parameter...</option>
                    </select>
                </div>
            </div>
            <div class="flex justify-end gap-3 mt-6">
                <button id="cancel-add-param-btn" class="btn btn-secondary">Cancel</button>
                <button id="confirm-add-param-btn" class="btn btn-primary">Add Parameter</button>
            </div>
        </div>
    </div>

    <div id="bottom-left-controls" class="fixed bottom-6 left-6 z-50 flex gap-4 items-center">
        <div id="theme-switcher-container" class="flex gap-2 items-center pointer-events-auto">
            <button id="theme-btn-cafe58" class="theme-btn" style="display: none;" aria-label="Switch to Cafe 58 Theme">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"
                    fill="none" stroke-linecap="round" stroke-linejoin="round">
                    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                    <path
                        d="M3 14c.83 .642 2.077 1.017 3.5 1c1.423 .017 2.67 -.358 3.5 -1c.83 -.642 2.077 -1.017 3.5 -1c1.423 -.017 2.67 .358 3.5 1">
                    </path>
                    <path d="M8 3a2.4 2.4 0 0 0 -1 2a2.4 2.4 0 0 0 1 2"></path>
                    <path d="M12 3a2.4 2.4 0 0 0 -1 2a2.4 2.4 0 0 0 1 2"></path>
                    <path d="M3 10h14v5a6 6 0 0 1 -6 6h-2a6 6 0 0 1 -6 -6v-5z"></path>
                    <path d="M16.746 16.726a3 3 0 1 0 .252 -5.555"></path>
                </svg>
            </button>
            <button id="theme-btn-cyber" class="theme-btn" style="display: none;" aria-label="Switch to Cyber Theme">
                <svg width="800" height="800" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M8 0C3.6 0 0 3.6 0 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8m0 15c-3.9 0-7-3.1-7-7 0-2.4 1.2-4.6 3.2-5.9C4.1 2.7 4 3.4 4 4c0 4.9 4 8.9 8.9 9-1.3 1.3-3 2-4.9 2" />
                </svg>
            </button>
            <button id="theme-btn-light" class="theme-btn" aria-label="Switch to Light Theme">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"
                    fill="none" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="5"></circle>
                    <line x1="12" y1="1" x2="12" y2="3"></line>
                    <line x1="12" y1="21" x2="12" y2="23"></line>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                    <line x1="1" y1="12" x2="3" y2="12"></line>
                    <line x1="21" y1="12" x2="23" y2="12"></line>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                </svg>
            </button>
            <button id="theme-btn-dark" class="theme-btn" style="display: none;" aria-label="Switch to Dark Theme">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"
                    fill="none" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
            </button>
        </div>
        <div class="action-button-container">
            <button id="save-project-button" class="bottom-action-button" aria-label="Save Project File">
                <svg xmlns="http://www.w3.org/2000/svg" height="28px" viewBox="0 0 24 24" width="28px"
                    fill="currentColor">
                    <path d="M0 0h24v24H0V0z" fill="none" />
                    <path
                        d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm2 16H5V5h11.17L19 7.83V19zm-7-7c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3zM6 6h9v4H6z" />
                </svg>
            </button>
            <span class="tooltip" role="tooltip">Save Project</span>
        </div>
        <div class="action-button-container">
            <button id="load-project-button" class="bottom-action-button" aria-label="Load Project File">
                <svg xmlns="http://www.w3.org/2000/svg" height="28px" viewBox="0 0 24 24" width="28px">
                    <path d="M0 0h24v24H0V0z" fill="none" />
                    <path
                        d="M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z" />
                </svg>
            </button>
            <span class="tooltip" role="tooltip">Load Project</span>
        </div>

        <div class="action-button-container">
            <button id="info-button" class="bottom-action-button" aria-label="Show App Info">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 462.262 462.262" xml:space="preserve" width="28px"
                    height="28px" fill="currentColor">
                    <path
                        d="M447.5 387.632H431v-8.5c0-12.958-10.542-23.5-23.5-23.5H255v-47.224c10.543-6.033 18.566-16.056 22-28.295 21.321 1.649 38.448 2.517 50.5 2.517 62.683 0 100.483-27.954 121.156-51.405 18.14-20.577 18.141-51.611.001-72.188-20.673-23.451-58.474-51.406-121.157-51.406-8.643 0-20.261.587-32.444 1.243-5.023.295-6.409 4.312-7.422 7.244-.483 1.402-5.758 16.812-7.848 22.934a24.49 24.49 0 0 1-23.184 16.579H191v-56.5c0-12.958-10.542-23.5-23.5-23.5S144 86.172 144 99.13v5.388l-52.75-33.71A71.4 71.4 0 0 0 52.863 59.63H7.5a7.5 7.5 0 0 0-5.546 12.549l59.81 65.718C53.414 143.623 48 153.224 48 163.89v23.74H7.5c-4.143 0-7.5 3.358-7.5 7.5s3.357 7.5 7.5 7.5H48v23.74c0 10.638 5.385 20.215 13.696 25.947l-59.748 65.77a7.501 7.501 0 0 0 5.551 12.543h45.363a71.4 71.4 0 0 0 38.399-11.186l78.378-50.088q7.382.855 14.531 1.66c1.304 16.006 10.57 29.785 23.828 37.367v47.248H55.5c-12.958 0-23.5 10.542-23.5 23.5v8.5H15.5c-4.143 0-7.5 3.358-7.5 7.5s3.357 7.5 7.5 7.5h432a7.5 7.5 0 1 0 0-14.999m-10.095-218.677c13.154 14.922 13.154 37.428-.001 52.351A132.4 132.4 0 0 1 407 246.801V143.459a132.4 132.4 0 0 1 30.405 25.496M167.5 90.63c4.687 0 8.5 3.813 8.5 8.5v23.796a23.55 23.55 0 0 0-11.25-1.442c-1.903.222-3.832.452-5.75.678V99.13c0-4.687 3.814-8.5 8.5-8.5m-114.637-16a56.4 56.4 0 0 1 30.321 8.826L144 122.32v.81q.001.415.046.817a6095 6095 0 0 0-66.974 8.488l-.026-.032L24.467 74.63zm106.637 113H63v-23.74c0-8.244 6.176-15.279 14.365-16.364 30.872-4.09 60.858-7.839 89.127-11.144a9 9 0 0 1 1.027-.06c2.081 0 4.052.748 5.635 2.157a8.4 8.4 0 0 1 2.846 6.344v18.307a7.5 7.5 0 0 0 7.5 7.5h73.103c16.902 0 31.924-10.744 37.38-26.735 3.647-10.687 5.744-16.813 6.946-20.314 10.069-.526 19.473-.951 26.571-.951 26.035 0 47.294 5.248 64.5 12.953v119.093c-17.206 7.705-38.465 12.953-64.5 12.953-28.177 0-84.883-4.868-158.616-13.458a9 9 0 0 0-.28-.033c-28.15-3.281-58.773-7.103-91.24-11.405C69.175 241.649 63 234.614 63 226.37v-23.74h96.5c4.143 0 7.5-3.358 7.5-7.5s-3.357-7.5-7.5-7.5M83.197 306.797a56.4 56.4 0 0 1-30.334 8.833H24.446l52.149-57.405c.122-.135.231-.276.342-.417a6139 6139 0 0 0 69.199 8.767zm178.439-27.944c-4.711 12.356-16.491 20.777-30.136 20.777-16.017 0-29.355-11.649-32.01-26.917 22.932 2.494 43.794 4.556 62.146 6.14m-38.636 35c2.76.501 5.598.777 8.5.777 2.899 0 5.739-.26 8.5-.758v41.759h-17zM47 379.132c0-4.687 3.813-8.5 8.5-8.5h352c4.687 0 8.5 3.813 8.5 8.5v8.5H47z" />
                </svg>
            </button>
            <span class="tooltip" role="tooltip">App Information</span>
        </div>
        <div class="action-button-container">
            <button id="recipe-guides-btn" class="bottom-action-button" aria-label="Show Recipe Guides">
                <svg xmlns="http://www.w3.org/2000/svg" height="28px" width="28px" viewBox="0 0 32 32">
                    <path d="M8 4h22v28H8z" style="fill:var(--btn-secondary-bg)"></path>
                    <path d="M8 4v28l16-4V0z" style="fill:var(--grid-color)"></path>
                    <path d="M2 0h22v28H2z" style="fill:var(--bg-main)"></path>
                    <path d="M26 19h2v2h-2zm3 0h1v2h-1zm-5 0h1v2h-1z" style="fill:var(--text-primary)"></path>
                    <path
                        d="M4 7h2v2H4zm3 0h2v2H7zm6 0h2v2h-2zm3 0h2v2h-2zm0 3h2v2h-2zm0 3h2v2h-2zm0 3h2v2h-2zm3 0h2v2h-2zm3 0h2v2h-2zM2 7h1v2H2zm8 0h2v2h-2z"
                        style="fill:var(--text-secondary)"></path>
                </svg>
            </button>
            <span class="tooltip" role="tooltip">Recipe Guides</span>
        </div>
        <div class="action-button-container">
            <button id="shortcut-help-btn" class="bottom-action-button" aria-label="Show Keyboard Shortcuts">
                <svg xmlns="http://www.w3.org/2000/svg" height="28px" viewBox="0 0 24 24" width="28px"
                    fill="currentColor">
                    <path d="M0 0h24v24H0V0z" fill="none" />
                    <path
                        d="M20 5H4c-1.1 0-1.99.9-1.99 2L2 17c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm-9 3h2v2h-2V8zm0 3h2v2h-2v-2zM8 8h2v2H8V8zm0 3h2v2H8v-2zm-1 2H5v-2h2v2zm0-3H5V8h2v2zm9 7H8v-2h8v2zm-1-4h-2v-2h2v2zm0-3h-2V8h2v2zm3 3h-2v-2h2v2zm0-3h-2V8h2v2z" />
                </svg>
            </button>
            <span class="tooltip" role="tooltip">Shortcuts (?)</span>
        </div>
    </div>
    </div>

    <!-- EnergyPlus Optimization Info Modal -->
    <div id="ep-optimization-info-modal"
        class="fixed inset-0 bg-black bg-opacity-50 z-[10002] hidden items-center justify-center">
        <div class="ui-panel p-6 w-full max-w-3xl mx-auto bg-[--bg-main] relative"
            style="max-height: 80vh; display: flex; flex-direction: column;">
            <button id="ep-opt-info-modal-close-btn"
                class="absolute top-3 right-3 text-[--text-secondary] hover:text-[--text-primary]"
                aria-label="Close EnergyPlus Optimization Info">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
            <div class="window-content prose" style="max-height: 100%; overflow-y: auto;">
                <h2>Guide for Performing the E+ Optimization</h2>
                <p>The "E+ Optimization" tab in the Helios panel is a dedicated interface for running Generative
                    Optimization studies specifically for **EnergyPlus configuration parameters**. Its purpose is to
                    automatically find the best possible set of E+ settings (like thermostat setpoints, internal loads,
                    or ventilation rates) by running many EnergyPlus simulations in the background. You define the goals
                    (e.g., "minimize total site energy") and constraints, and the optimizer "evolves" solutions to find
                    the best-performing parameters.</p>
                <p>This guide explains how to use this feature, covering both the manual process and how Helios (the AI)
                    can assist you.</p>

                <hr class="my-6 border-[--grid-color]">

                <h2 class="text-lg font-bold mb-4">About Generative Optimization (for EnergyPlus)</h2>
                <p>This panel uses a <strong>Genetic Algorithm (GA)</strong> to automatically find high-performing
                    EnergyPlus configurations. Unlike the Radiance-based "Optimization" tab (which optimizes shading
                    geometry), this tab optimizes the *operational parameters* of your building model.</p>
                <p>It works by modifying your project's <code>energyPlusConfig</code>, generating a new
                    <code>model.idf</code> for each design, running a full EnergyPlus simulation, and extracting the
                    performance metric (KPI) from the results. It is ideal for tuning your model to find the best
                    balance of performance and efficiency.
                </p>

                <h2>How to Run an E+ Optimization (Step-by-Step)</h2>
                <ol>
                    <li><strong>Define Your Goal(s)</strong>:
                        <ul>
                            <li><strong>Metric:</strong> Select the Key Performance Indicator (KPI) you want to optimize
                                from the **Metric** dropdown (e.g., <code>minimize_total_site_energy</code>,
                                <code>minimize_heating_kwh</code>).
                            </li>
                            <li><strong>Goal Type:</strong> Choose how to optimize this metric (<code>Minimize</code>,
                                <code>Maximize</code>, or <code>Set Target</code>).
                            </li>
                            <li><strong>Constraint (Optional):</strong> Set a "pass/fail" rule for your goal (e.g.,
                                <code>minimize_total_site_energy < 120</code>). Designs that fail this constraint are
                                discarded.
                            </li>
                        </ul>
                    </li>
                    <li><strong>Define Parameters (The "Genes")</strong>:
                        <ul>
                            <li>Click the **"Select parameters..."** dropdown.</li>
                            <li>Check the box next to the parameters you want the algorithm to change (e.g.,
                                <code>tset_cool</code>, <code>lpd_multiplier</code>). **You can select a maximum of 3.**
                            </li>
                            <li>For each parameter you add, a card will appear. Set a valid <strong>Min</strong>,
                                <strong>Max</strong>, and <strong>Step</strong> range. This defines the "search space"
                                for the optimizer.
                            </li>
                        </ul>
                    </li>
                    <li><strong>Configure Run Settings</strong>:
                        <ul>
                            <li><strong>Population:</strong> The number of designs to test in each "generation." (e.g.,
                                6-10).</li>
                            <li><strong>Max Evals:</strong> The total number of EnergyPlus simulations to run. More
                                evaluations take longer but produce better results.</li>
                        </ul>
                    </li>
                    <li><strong>Run the Optimization</strong>:
                        <ul>
                            <li>Click <strong>"Start Optimization."</strong> The "Progress Log" will show the status.
                                Each evaluation involves a full EnergyPlus run, so this process can take time.</li>
                            <li><strong>Quick Optimize</strong> runs with smaller settings for a fast, preliminary
                                result.</li>
                        </ul>
                    </li>
                    <li><strong>Analyze and Apply Results</strong>:
                        <ul>
                            <li>As the optimization runs, the <strong>Results</strong> list will fill with the best
                                solution found so far.</li>
                            <li>Click the best design in the list to select it.</li>
                            <li>Click <strong>"Apply Best Design"</strong> to permanently update your project's
                                <code>energyPlusConfig</code> with the winning parameters. This change is **not**
                                automatic.
                            </li>
                        </ul>
                    </li>
                </ol>

                <h4> How to Use Helios (The AI) for E+ Optimization</h4>
                <p>Instead of (or in addition to) using the manual form, you can use Helios in the <strong>Chat</strong>
                    tab to assist you.</p>
                <ol>
                    <li><strong>AI-Powered Setup</strong>
                        <p>You can ask Helios to configure the entire optimization for you. Go to the "Chat" tab and
                            ask:</p>
                        <blockquote>"Helios, set up an E+ optimization to minimize total site energy by testing cooling
                            setpoints between 24 and 26 and heating setpoints between 19 and 21."</blockquote>
                        <p>Helios will use its <code>configureEnergyPlusOptimization</code> tool to fill out the entire
                            form in the E+ Optimization tab. It will then ask you to review the settings and click
                            "Start Optimization" when you are ready.</p>
                    </li>
                    <li><strong>AI-Powered Execution</strong>
                        <p>Once configured (either manually or by the AI), you can start the run from the chat tab:</p>
                        <blockquote>"Start the EnergyPlus optimization in quick mode."</blockquote>
                        <p>Helios will use the <code>startEnergyPlusOptimization</code> tool to begin the run.</p>
                    </li>
                    <li><strong>AI-Powered Trend Analysis (After a Run)</strong>
                        <p>After your optimization is complete, go to the "Chat" tab and ask:</p>
                        <blockquote>"Helios, please analyze my last E+ optimization run."</blockquote>
                        <p>Helios will use its <code>analyzeEnergyPlusOptimizationResults</code> tool to get the data
                            from <em>every single simulation it ran</em>. It will then provide a high-level summary of
                            trends and insights, such as:</p>
                        <ul>
                            <li>"I found that <strong>'tset_cool' was the most critical parameter</strong> for
                                minimizing energy."</li>
                            <li>"Performance for 'lpd_multiplier' improved down to 0.7, but had diminishing returns
                                after that."</li>
                        </ul>
                    </li>
                </ol>

                <hr class="my-6 border-[--grid-color]">

                <h2>Optimization Methodologies (EnergyPlus)</h2>
                <h3>Single-Objective (SSGA)</h3>
                <p>This panel uses a <strong>Steady-State Genetic Algorithm (SSGA)</strong>. It is efficient for finding
                    the single best solution for one goal (e.g., "Minimize Site Energy").</p>
                <ol>
                    <li><strong>Initialization:</strong> Creates an initial "population" (e.g., 6) of random designs.
                    </li>
                    <li><strong>Evaluation (Fitness):</strong> Each design (e.g.,
                        <code>{"tset_cool": 25, "lpd_multiplier": 0.8}</code>) is passed to the evaluation function.
                    </li>
                    <li><strong>Selection:</strong> Selects two "parent" designs using <strong>Tournament
                            Selection</strong>.</li>
                    <li><strong>Crossover & Mutation:</strong> The two parents are "bred" to create two new "child"
                        designs, with a small chance of random mutation.</li>
                    <li><strong>Replacement:</strong> The two new children are evaluated. They are added to the
                        population, and the two <strong>worst-performing</strong> designs are removed.</li>
                    <li><strong>Repeat:</strong> This "select, breed, evaluate, replace" loop repeats until the
                        <strong>Max Evaluations</strong> is reached.
                    </li>
                </ol>
                <h3>Key Feature: Fitness Caching</h3>
                <p>The optimizer uses an <code>epFitnessCache</code> to store the result for every design it tests
                    (e.g., <code>{"tset_cool": 25, "lpd_multiplier": 0.8} -> {fitness: -118.4}</code>). If the algorithm
                    generates a design it has already simulated, it retrieves the score from this memory instead of
                    running a new, time-consuming EnergyPlus simulation. This is also what powers the AI's Trend
                    Analysis tool.</p>

                <h2>Configuration Options Explained</h2>
                <ul>
                    <li><strong>Metric (The "What"):</strong> This selects the raw data point you want to track. The
                        word "Minimize" in the label is just a hint; this dropdown only selects the <em>data
                            source</em>.
                        <ul style="list-style-type: disc; margin-left: 20px; margin-top: 8px;">
                            <li><strong>Minimize Site EUI (kWh/m):</strong> This is your **Total Energy Consumption**
                                (heating, cooling, lighting, equipment) normalized by the building's floor area. This is
                                the best metric for overall energy efficiency.</li>
                            <li><strong>Minimize Heating EUI (kWh/m):</strong> The **Heating Energy** (e.g., from gas
                                or electric heating) normalized by area. Use this to focus specifically on improving
                                winter performance.</li>
                            <li><strong>Minimize Cooling EUI (kWh/m):</strong> The **Cooling Energy** (from chillers or
                                AC) normalized by area. Use this to focus on reducing summer energy use, often by
                                testing setpoints or ventilation.</li>
                            <li><strong>Minimize Lighting EUI (kWh/m):</strong> The **Lighting Energy** normalized by
                                area. Use this to test the impact of different lighting power densities or schedules.
                            </li>
                            <li><strong>Unmet Heating Hours (hrs):</strong> The total number of hours in the year when
                                the heating system could not maintain the heating setpoint. **This is an excellent
                                metric for a *Constraint*** (e.g., `unmet_heating_hours < 150`) to ensure your
                                    energy-saving designs are still comfortable.</li>
                            <li><strong>Unmet Cooling Hours (hrs):</strong> The total number of hours when the cooling
                                system could not maintain the cooling setpoint. Also a perfect candidate for a
                                **Constraint** (e.g., `unmet_cooling_hours < 150`).</li>
                        </ul>
                    </li>
                    <li><strong>Goal (The "How"):</strong> This is the **actual instruction** for the optimizer. It
                        tells the algorithm what to do with the "Metric" data you selected.
                        <ul style="list-style-type: disc; margin-left: 20px; margin-top: 8px;">
                            <li><strong>Minimize:</strong> Find the design with the *lowest* metric value.</li>
                            <li><strong>Maximize:</strong> Find the design with the *highest* metric value.</li>
                            <li><strong>Set Target:</strong> Find the design *closest* to your target value.</li>
                        </ul>
                    </li>
                    <li><strong>Parameters (Max 3):</strong> These are the "genes" or variables that the optimizer is
                        allowed to change.
                        <ul style="list-style-type: disc; margin-left: 20px; margin-top: 8px;">
                            <li><strong>What they are:</strong> You select up to 3 parameters from the dropdown (e.g.,
                                'Cooling Setpoint', 'Lighting Power Multiplier').</li>
                            <li><strong>How they work:</strong> For each parameter, you must define a **Min** and
                                **Max** range (the "search space"). The optimizer will intelligently test different
                                combinations of values *within these ranges* (e.g., "try a cooling setpoint of 25C with
                                a lighting multiplier of 0.8").</li>
                            <li><strong>Impact:</strong> The optimizer's job is to find the *combination* of parameter
                                values that best achieves your stated "Goal" (e.g., `Minimize`) while still passing your
                                "Constraint."</li>
                            <li><strong>Window U-Value (W/mK):</strong> Optimizes the thermal conductance of the main
                                window construction. Lower values mean better insulation (less heat loss in winter) but
                                can impact passive gains.</li>
                            <li><strong>Window SHGC:</strong> Optimizes the Solar Heat Gain Coefficient of the main
                                window construction. Lower values block more solar heat (reducing cooling loads), while
                                higher values allow more passive heating (reducing heating loads).</li>
                            <li><strong>Infiltration (ACH):</strong> Optimizes the building's airtightness, defined in
                                Air Changes per Hour (ACH). Lower values (e.g., 0.2) represent a very airtight building,
                                while higher values (e.g., 1.5) are leakier, increasing both heating and cooling loads.
                            </li>
                        </ul>
                    </li>
                    <li><strong>Constraint (Optional):</strong> This is a "pass/fail" filter that every design *must*
                        pass to be considered. If a design fails this test, it is immediately discarded, even if it has
                        a great "Goal" score.
                        <ul style="list-style-type: disc; margin-left: 20px; margin-top: 8px;">
                            <li><strong>Why use it?</strong> It prevents the optimizer from "cheating." For example, if
                                you just `Minimize Heating EUI`, the optimizer might "solve" this by setting the heating
                                setpoint to 0C (an uninhabitable space). A constraint prevents this.</li>
                            <li><strong>How to write it:</strong> Use the **Metric ID** from the code (e.g.,
                                `minimize_cooling_eui`), an operator (`<`, `>`, `<=`, `>=`), and a value.</li>
                            <li><strong>Example 1 (Balanced Design):</strong>
                                <ul style="list-style-type: circle; margin-left: 20px;">
                                    <li><strong>Metric:</strong> `Minimize Site EUI (kWh/m)`</li>
                                    <li><strong>Goal:</strong> `Minimize`</li>
                                    <li><strong>Constraint:</strong> `unmet_heating_hours < 150` (Find the most
                                            efficient design *that is also comfortable*. You can also chain constraints,
                                            though the UI only supports one: `unmet_heating_hours < 150 AND
                                            unmet_cooling_hours < 150`).</li>
                                </ul>
                            </li>
                            <li><strong>Example 2 (Targeted Savings):</strong>
                                <ul style="list-style-type: circle; margin-left: 20px;">
                                    <li><strong>Metric:</strong> `Minimize Heating EUI (kWh/m)`</li>
                                    <li><strong>Goal:</strong> `Minimize`</li>
                                    <li><strong>Constraint:</strong> `minimize_cooling_eui < 40` (Find the most
                                            heating-efficient design that *also* keeps cooling energy below 40
                                            kWh/m).</li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                    <li><strong>Population / Max Evals:</strong> Standard GA settings. A <strong>Max Evals</strong> of
                        12-20 is often sufficient for 2-3 parameters.</li>
                </ul>

                <h2>Benefits & Limitations</h2>
                <ul>
                    <li><strong>Benefit:</strong> Automates the tedious task of finding optimal *configuration settings*
                        for your E+ model.</li>
                    <li><strong>Benefit:</strong> Can find non-obvious, high-performing combinations of parameters.</li>
                    <li><strong>Limitation:</strong> This is a stochastic (random) process. It is not
                        <em>guaranteed</em> to find the absolute single best solution, but it is very good at finding
                        globally "good" solutions.
                    </li>
                    <li><strong>Limitation:</strong> The process is computationally expensive. Each evaluation is a full
                        EnergyPlus simulation. Use "Quick Optimize" for exploration.</li>
                    <li><strong>Limitation:</strong> Currently limited to 3 parameters and a predefined list of options.
                    </li>
                </ul>

                <h2>What Happens When You Click "Start"</h2>
                <p>The <code>_evaluateEpDesignHeadless</code> function orchestrates the entire process for each design:
                </p>
                <ol>
                    <li>Clones the current <code>energyPlusConfig</code> from the project.</li>
                    <li>Applies the new design parameters (e.g., <code>tset_cool: 25</code>,
                        <code>lpd_multiplier: 0.8</code>).
                    </li>
                    <li>Calls <code>generateAndStoreIdf(project)</code> to create a new <strong>model.idf</strong> file
                        reflecting these changes.</li>
                    <li>Calls <code>window.electronAPI.runEnergyPlus</code> with a unique <code>runId</code> to simulate
                        this specific <strong>model.idf</strong>.</li>
                    <li>Waits for the <code>onEnergyPlusExit</code> event from the Electron backend.</li>
                    <li>Calls <code>resultsManager.parseEnergyPlusResults</code> to read the simulation outputs.</li>
                    <li>Extracts the target KPI (e.g.,
                        <code>resultsManager.getEnergyPlusKpisForUi(runId).siteEui</code>).
                    </li>
                    <li>Calculates a fitness score from this KPI (e.g., <code>score = -siteEui</code> for minimization).
                    </li>
                    <li>Returns this score to the optimizer, which then repeats the loop.</li>
                </ol>
                <p class="mt-4"><strong>Final Result:</strong> When the process is complete, the results list will show
                    the best solution. You must click **"Apply Best Design"** to save these parameters to your main
                    project configuration.</p>
            </div>
        </div>
    </div>
    <template id="template-ep-optimization-panel">
        <div id="helios-ep-optimization-content" class="flex-grow p-4 space-y-4 overflow-y-auto hidden">
            <div class="flex justify-between items-center mb-2">
                <p class="text-sm text-[--text-secondary] mb-0">
                    Configure EnergyPlus optimization over key EP parameters and KPIs.
                </p>
                <button id="ep-opt-info-btn" class="btn btn-icon" aria-label="EnergyPlus Optimization Info">
                    <svg width="18" height="18" viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg"
                        fill="var(--highlight-color)">
                        <path
                            d="M25.39 25.45a1 1 0 0 0-1.38.29c-1.41 2.16-4 4.81-6.31 5.7s-4.12.57-4.84 0c-.31-.27-1.12-1-.43-3.49.46-1.66 3.32-9.48 4-11.38l-2.18.28c-.69 1.86-3.29 8.84-3.76 10.58-.68 2.49-.34 4.3 1.09 5.56A5.6 5.6 0 0 0 15 34a9.5 9.5 0 0 0 3.45-.7c2.79-1.09 5.72-4.12 7.26-6.47a1 1 0 0 0-.32-1.38" />
                        <path
                            d="M19.3 11a4.5 4.5 0 1 0-4.5-4.5 4.5 4.5 0 0 0 4.5 4.5m0-7a2.5 2.5 0 1 1-2.5 2.5A2.5 2.5 0 0 1 19.3 4" />
                        <path
                            d="M11.81 15c.06 0 6.27-.82 7.73-1 .65-.1 1.14 0 1.3.15s.21.8-.07 1.68c-.61 1.86-3.69 11-4.59 13.71a8 8 0 0 0 1.29-.38 7.3 7.3 0 0 0 1.15-.6c1.23-3.56 3.53-10.46 4.05-12.04s.39-2.78-.3-3.6a3.16 3.16 0 0 0-3.08-.83c-1.43.15-7.47.94-7.73 1a1 1 0 0 0 .26 2Z" />
                        <path fill="none" d="M0 0h36v36H0z" />
                    </svg>
                </button>
            </div>

            <div class="border-t border-[--grid-color] pt-3">
                <h4 class="label mb-2">Objective</h4>

                <p id="ep-opt-warning-runtime" class="info-box !text-xs !py-2 !px-3 mb-3">
                    EnergyPlus runs are heavier; prefer Quick mode while exploring.
                </p>

                <div class="flex flex-col gap-3">
                    <div>
                        <label for="ep-opt-goal-metric" class="label text-xs">Metric</label>
                        <select id="ep-opt-goal-metric"
                            class="w-full mt-1 text-xs bg-black/20 border border-gray-700 rounded p-1.5 focus:border-[--accent-color] focus:ring-1 focus:ring-[--accent-color] outline-none"></select>
                    </div>
                    <div>
                        <label for="ep-opt-goal-type" class="label text-xs">Goal</label>
                        <select id="ep-opt-goal-type"
                            class="w-full mt-1 text-xs bg-black/20 border border-gray-700 rounded p-1.5 focus:border-[--accent-color] focus:ring-1 focus:ring-[--accent-color] outline-none">
                            <option value="minimize">Minimize</option>
                            <option value="maximize">Maximize</option>
                            <option value="set-target">Set Target</option>
                        </select>
                    </div>
                    <div id="ep-opt-goal-target-container" class="hidden">
                        <label for="ep-opt-goal-target-value" class="label text-xs">Target</label>
                        <input id="ep-opt-goal-target-value" type="number" step="0.1" class="w-full mt-1">
                    </div>
                </div>
                <div class="mt-3">
                    <label for="ep-opt-constraint" class="label text-xs">Constraint (optional)</label>
                    <input id="ep-opt-constraint" class="w-full mt-1"
                        placeholder="e.g. minimize_total_site_energy < 120">
                </div>
            </div>

            <div class="border-t border-[--grid-color] pt-3">
                <div class="flex items-center justify-between mb-1">
                    <h4 class="label mb-0">Parameters (max 3)</h4>
                    <span id="ep-opt-param-count" class="text-xs text-[--text-secondary]">0 / 3 selected</span>
                </div>

                <div class="relative">
                    <button id="ep-opt-param-dropdown-btn"
                        class="w-full text-left py-3 px-4 bg-[--bg-main] border border-[--grid-color] rounded-md flex justify-between items-center hover:bg-[--btn-secondary-hover-bg] transition-colors">
                        <span id="ep-opt-param-dropdown-label" class="text-[--text-secondary]">Select
                            parameters...</span>
                        <span class="text-xs opacity-50"></span>
                    </button>

                    <div id="ep-opt-param-dropdown-list"
                        class="hidden absolute z-50 w-full bg-[--panel-bg] border border-[--grid-color] rounded shadow-lg max-h-48 overflow-y-auto mt-1 p-1">
                    </div>

                </div>
                <div id="ep-opt-active-params-container" class="space-y-2 mt-2"></div>
            </div>

            <div class="border-t border-[--grid-color] pt-3">
                <h4 class="label mb-2">GA Settings</h4>
                <div class="grid grid-cols-2 gap-2 text-xs mb-3">
                    <div>
                        <label class="label text-[10px]" for="ep-opt-population-size">Population</label>
                        <input id="ep-opt-population-size" type="number" min="4" max="30" value="6"
                            class="w-full text-xs">
                    </div>
                    <div>
                        <label class="label text-[10px]" for="ep-opt-max-evals">Max Evals</label>
                        <input id="ep-opt-max-evals" type="number" min="4" max="60" value="12" class="w-full text-xs">
                    </div>
                </div>

                <div class="btn-group flex-col gap-2">
                    <button id="ep-start-optimization-btn"
                        class="btn btn-primary w-full text-xs py-2 justify-center">Start Optimization</button>
                    <button id="ep-resume-optimization-btn"
                        class="btn btn-secondary w-full text-xs py-2 justify-center">Resume</button>
                    <button id="ep-quick-optimize-btn"
                        class="btn btn-secondary w-full text-xs py-2 justify-center">Quick Optimize</button>
                    <button id="ep-cancel-optimization-btn"
                        class="btn btn-secondary w-full text-xs py-2 justify-center text-[--danger-color]">Cancel</button>
                </div>
            </div>

            <div class="border-t border-[--grid-color] pt-3">
                <div class="flex justify-between items-center mb-1">
                    <h4 class="label mb-0">Results</h4>
                    <button id="ep-apply-best-design-btn" class="btn btn-secondary btn-xs hidden text-[10px] py-1 px-2">
                        Apply Best
                    </button>
                </div>
                <ul id="ep-optimization-summary-list"
                    class="w-full h-28 p-2 bg-[--grid-color] rounded overflow-y-auto font-mono text-[9px] whitespace-pre-wrap">
                    <li id="ep-opt-summary-placeholder" class="text-[--text-secondary] text-center p-2">
                        Ready to optimize...
                    </li>
                </ul>
            </div>

            <div class="border-t border-[--grid-color] pt-3">
                <h4 class="label mb-1">Log</h4>
                <pre id="ep-optimization-log"
                    class="w-full h-20 p-2 bg-[--grid-color] rounded overflow-y-auto font-mono text-[9px] whitespace-pre-wrap">Ready...</pre>
            </div>
        </div>
    </template>
    <template id="template-dynamic-opt-param">
        <div class="dynamic-opt-param-item p-3 border border-[--grid-color] rounded bg-[--grid-color]" data-param-id="">
            <div class="flex justify-between items-center mb-2">
                <span class="dynamic-opt-param-name font-medium text-sm">Parameter Name</span>
                <button class="remove-dynamic-opt-param-btn btn btn-xs btn-danger"
                    aria-label="Remove parameter"></button>
            </div>
            <div class="grid grid-cols-3 gap-2">
                <div>
                    <label class="label text-xs">Min</label>
                    <input type="number" class="dynamic-opt-param-min w-full" step="0.1">
                </div>
                <div>
                    <label class="label text-xs">Max</label>
                    <input type="number" class="dynamic-opt-param-max w-full" step="0.1">
                </div>
                <div>
                    <label class="label text-xs">Step</label>
                    <input type="number" class="dynamic-opt-param-step w-full" step="0.01">
                </div>
            </div>
        </div>
    </template>

    <template id="template-opt-param">
        <div class="opt-param-item p-3 border border-[--grid-color] rounded bg-[--grid-color]" data-param-id="">
            <label class="flex items-center cursor-pointer">
                <input type="checkbox" class="opt-param-toggle mr-3">
                <span class="opt-param-name font-medium">Parameter Name</span>
            </label>

            <div class="opt-param-controls-continuous grid grid-cols-3 gap-2 mt-2 pl-8 hidden">
                <div>
                    <label class="label text-xs">Min</label>
                    <input type="number" class="opt-param-min w-full" step="0.1">
                </div>
                <div>
                    <label class="label text-xs">Max</label>
                    <input type="number" class="opt-param-max w-full" step="0.1">
                </div>
                <div>
                    <label class="label text-xs">Step</label>
                    <input type="number" class="opt-param-step w-full" step="0.01">
                </div>
            </div>

            <div classs="opt-param-controls-discrete mt-2 pl-8 hidden">
                <label class="label text-xs">Options (Will be chosen by optimizer)</label>
                <select class="opt-param-options w-full" disabled>
                </select>
            </div>
        </div>
    </template>

    <template id="template-view-target-item">
        <div class="view-target-item border border-[--grid-color] rounded p-2 space-y-2">
            <div class="flex items-center justify-between">
                <input type="text" placeholder="Description (e.g., Garden view)"
                    class="view-target-desc input text-xs flex-1 mr-2">
                <button class="view-target-remove btn btn-xs btn-danger" aria-label="Remove view target"></button>
            </div>

            <div class="grid grid-cols-3 gap-2">
                <div>
                    <label class="text-xs text-[--text-secondary]">Dir X</label>
                    <input type="number" step="0.1" value="0" class="view-target-dir-x input text-xs w-full">
                </div>
                <div>
                    <label class="text-xs text-[--text-secondary]">Dir Y</label>
                    <input type="number" step="0.1" value="0" class="view-target-dir-y input text-xs w-full">
                </div>
                <div>
                    <label class="text-xs text-[--text-secondary]">Dir Z</label>
                    <input type="number" step="0.1" value="1" class="view-target-dir-z input text-xs w-full">
                </div>
            </div>

            <div>
                <label class="label text-xs flex justify-between">
                    <span>Angular Width</span>
                    <span class="view-target-angle-val data-value font-mono">30</span>
                </label>
                <input type="range" min="5" max="90" value="30" step="5" class="view-target-angle w-full">
            </div>
        </div>
    </template>
    <template id="template-material-tagger">
        <div class="floating-window ui-panel">
            <div class="window-header">
                <span>Surface Tagger</span>
                <div class="window-controls">
                    <div class="window-icon-max"></div>
                    <div class="collapse-icon"></div>
                    <div class="window-icon-close"></div>
                </div>
            </div>
            <div class="window-content space-y-4">
                <p class="info-box">Assign a surface type to each material from your imported model. This is critical
                    for Radiance simulations.</p>
                <div id="material-tag-list" class="space-y-3 max-h-60 overflow-y-auto">
                </div>
                <button id="finalize-import-btn" class="btn btn-primary w-full">Finalize Import</button>
            </div>
            <div class="resize-handle-edge top"></div>
            <div class="resize-handle-edge right"></div>
            <div class="resize-handle-edge bottom"></div>
            <div class="resize-handle-edge left"></div>
            <div class="resize-handle-corner top-left"></div>
            <div class="resize-handle-corner top-right"></div>
            <div class="resize-handle-corner bottom-left"></div>
            <div class="resize-handle-corner bottom-right"></div>
        </div>
    </template>
    <template id="template-material-tag-item">
        <div class="material-tag-item grid grid-cols-2 gap-4 items-center">
            <div class="flex items-center gap-2">
                <div class="material-swatch w-4 h-4 rounded border border-gray-400"></div>
                <span class="material-name font-mono text-sm">material_name</span>
            </div>
            <select class="surface-type-selector w-full">
                <option value="INTERIOR_WALL" selected>Wall (Interior)</option>
                <option value="INTERIOR_FLOOR">Floor (Interior)</option>
                <option value="INTERIOR_CEILING">Ceiling (Interior)</option>
                <option value="GLAZING">Glazing</option>
                <option value="FRAME">Frame</option>
                <option value="SHADING_DEVICE">Shading Device</option>
                <option value="IGNORE">Ignore</option>
            </select>
        </div>
    </template>
    <template id="aperture-wall-template">
        <div class="aperture-controls space-y-5 pt-4 border-t border-[--grid-color]">
            <h3 class="font-semibold text-sm uppercase" data-template-text="heading">WALL_DIRECTION Wall Apertures</h3>
            <div>
                <label class="label" data-template-for="win-count"># of Windows</label>
                <div class="flex items-center space-x-3 mt-1"><input type="range" data-template-id="win-count" min="0"
                        max="10" value="0" step="1"><span data-template-id="win-count-val"
                        class="data-value font-mono w-12 text-left">0</span></div>
            </div>
            <div>
                <label class="label">Mode</label>
                <div class="btn-group mt-1"><button data-template-id="mode-wwr-btn"
                        class="btn active">WWR</button><button data-template-id="mode-manual-btn"
                        class="btn">Manual</button></div>
            </div>
            <div data-template-id="wwr-controls" class="space-y-5">
                <div><label class="label" data-template-for="wwr">WWR (%)</label>
                    <div class="flex items-center space-x-3 mt-1"><input type="range" data-template-id="wwr" min="0"
                            max="0.99" value="0.4" step="0.01"><span data-template-id="wwr-val"
                            class="data-value font-mono w-12 text-left">40%</span></div>
                </div>
                <div><label class="label" data-template-for="wwr-sill-height">Sill Height (m)</label>
                    <div class="flex items-center space-x-3 mt-1"><input type="range" data-template-id="wwr-sill-height"
                            min="0" max="10" value="1.0" step="0.05"><span data-template-id="wwr-sill-height-val"
                            class="data-value font-mono w-12 text-left">1.0m</span></div>
                </div>
            </div>
            <div data-template-id="manual-controls" class="hidden space-y-5">
                <div><label class="label" data-template-for="win-width">Win. Width (m)</label>
                    <div class="flex items-center space-x-3 mt-1"><input type="range" data-template-id="win-width"
                            min="0.1" max="20" value="1.5" step="0.1"><span data-template-id="win-width-val"
                            class="data-value font-mono w-12 text-left">1.5m</span></div>
                </div>
                <div><label class="label" data-template-for="win-height">Win. Height (m)</label>
                    <div class="flex items-center space-x-3 mt-1"><input type="range" data-template-id="win-height"
                            min="0.1" max="10" value="1.2" step="0.1"><span data-template-id="win-height-val"
                            class="data-value font-mono w-12 text-left">1.2m</span></div>
                </div>
                <div><label class="label" data-template-for="sill-height">Sill Height (m)</label>
                    <div class="flex items-center space-x-3 mt-1"><input type="range" data-template-id="sill-height"
                            min="0" max="10" value="1.0" step="0.05"><span data-template-id="sill-height-val"
                            class="data-value font-mono w-12 text-left">1.0m</span></div>
                </div>
            </div>
            <div class="shading-section-container space-y-4 pt-4 mt-4 border-t border-dashed border-[--grid-color]">
                <h4 class="font-semibold text-sm uppercase text-gray-700" data-template-text="shading-heading">
                    WALL_DIRECTION Wall Shading</h4>
                <label class="flex items-center cursor-pointer" data-template-for="shading-toggle"><input
                        type="checkbox" data-template-id="shading-toggle"><span
                        class="ml-3 label !text-gray-600 !uppercase-none !font-normal">Enable Shading on this
                        Wall</span></label>


                <div data-template-id="shading-controls" class="hidden space-y-5">
                    <div><label class="label" data-template-for="shading-type">Device Type</label><select
                            data-template-id="shading-type" class="w-full mt-1">
                            <option value="none" selected>None</option>
                            <option value="overhang">Overhang</option>
                            <option value="lightshelf">Light Shelf</option>
                            <option value="louver">Louver</option>
                            <option value="roller">Roller</option>
                            <option value="imported_obj">Imported OBJ</option>
                        </select></div>
                    <div data-template-id="shading-controls-overhang"
                        class="hidden space-y-4 pt-4 border-t border-[--grid-color]">
                        <div><label class="label" data-template-for="overhang-dist-above">Distance Above Top (m)</label>
                            <div class="flex items-center space-x-3 mt-1"><input type="range"
                                    data-template-id="overhang-dist-above" min="0" max="1.0" value="0" step="0.05"><span
                                    data-template-id="overhang-dist-above-val"
                                    class="data-value font-mono w-12 text-left">0.00m</span></div>
                        </div>

                        <div><label class="label" data-template-for="overhang-tilt">Tilt Angle ()</label>
                            <div class="flex items-center space-x-3 mt-1"><input type="range"
                                    data-template-id="overhang-tilt" min="-90" max="90" value="0" step="1"><span
                                    data-template-id="overhang-tilt-val"
                                    class="data-value font-mono w-12 text-left">0</span></div>
                        </div>
                        <div><label class="label" data-template-for="overhang-depth">Depth (m)</label>
                            <div class="flex items-center space-x-3 mt-1"><input type="range"
                                    data-template-id="overhang-depth" min="0" max="2.0" value="0.5" step="0.1"><span
                                    data-template-id="overhang-depth-val"
                                    class="data-value font-mono w-12 text-left">0.5m</span></div>
                        </div>
                        <div><label class="label" data-template-for="overhang-thick">Thickness (m)</label>
                            <div class="flex items-center space-x-3 mt-1"><input type="range"
                                    data-template-id="overhang-thick" min="0.005" max="0.5" value="0.05"
                                    step="0.005"><span data-template-id="overhang-thick-val"
                                    class="data-value font-mono w-12 text-left">0.050m</span></div>
                        </div>
                        <div><label class="label" data-template-for="overhang-extension">Extension From Window
                                (m)</label>
                            <div class="flex items-center space-x-3 mt-1"><input type="range"
                                    data-template-id="overhang-extension" min="0" max="1.0" value="0.0"
                                    step="0.05"><span data-template-id="overhang-extension-val"
                                    class="data-value font-mono w-12 text-left">0.00m</span></div>
                        </div>
                    </div>
                    <div data-template-id="shading-controls-lightshelf"
                        class="hidden space-y-4 pt-4 border-t border-[--grid-color]">
                        <div><label class="label">Placement</label>
                            <div class="btn-group mt-1"><button data-template-id="lightshelf-placement-ext"
                                    class="btn active">Exterior</button><button
                                    data-template-id="lightshelf-placement-int" class="btn">Interior</button><button
                                    data-template-id="lightshelf-placement-both" class="btn">Both</button></div>
                        </div>
                        <div data-template-id="lightshelf-controls-ext"
                            class="space-y-4 pt-4 border-t border-dashed border-[--grid-color]">
                            <h3 class="font-semibold text-xs uppercase text-[--text-secondary]">Exterior Shelf</h3>
                            <div><label class="label" data-template-for="lightshelf-dist-below-ext">Distance Below Top
                                    (m)</label>
                                <div class="flex items-center space-x-3 mt-1"><input type="range"
                                        data-template-id="lightshelf-dist-below-ext" min="0" max="3.0" value="0.2"
                                        step="0.05"><span data-template-id="lightshelf-dist-below-ext-val"
                                        class="data-value font-mono w-12 text-left">0.20m</span></div>
                            </div>
                            <div><label class="label" data-template-for="lightshelf-tilt-ext">Tilt Angle ()</label>
                                <div class="flex items-center space-x-3 mt-1"><input type="range"
                                        data-template-id="lightshelf-tilt-ext" min="-90" max="90" value="0"
                                        step="1"><span data-template-id="lightshelf-tilt-ext-val"
                                        class="data-value font-mono w-12 text-left">0</span></div>
                            </div>
                            <div><label class="label" data-template-for="lightshelf-depth-ext">Depth (m)</label>
                                <div class="flex items-center space-x-3 mt-1"><input type="range"
                                        data-template-id="lightshelf-depth-ext" min="0" max="2.0" value="0.5"
                                        step="0.1"><span data-template-id="lightshelf-depth-ext-val"
                                        class="data-value font-mono w-12 text-left">0.5m</span></div>
                            </div>
                            <div><label class="label" data-template-for="lightshelf-thick-ext">Thickness (m)</label>
                                <div class="flex items-center space-x-3 mt-1"><input type="range"
                                        data-template-id="lightshelf-thick-ext" min="0.005" max="0.5" value="0.05"
                                        step="0.005"><span data-template-id="lightshelf-thick-ext-val"
                                        class="data-value font-mono w-12 text-left">0.050m</span></div>
                            </div>
                        </div>
                        <div data-template-id="lightshelf-controls-int"
                            class="hidden space-y-4 pt-4 border-t border-dashed border-[--grid-color]">
                            <h3 class="font-semibold text-xs uppercase text-[--text-secondary]">Interior Shelf</h3>
                            <div><label class="label" data-template-for="lightshelf-dist-below-int">Distance Below Top
                                    (m)</label>
                                <div class="flex items-center space-x-3 mt-1"><input type="range"
                                        data-template-id="lightshelf-dist-below-int" min="0" max="3.0" value="0.2"
                                        step="0.05"><span data-template-id="lightshelf-dist-below-int-val"
                                        class="data-value font-mono w-12 text-left">0.20m</span></div>
                            </div>
                            <div><label class="label" data-template-for="lightshelf-tilt-int">Tilt Angle ()</label>
                                <div class="flex items-center space-x-3 mt-1"><input type="range"
                                        data-template-id="lightshelf-tilt-int" min="-90" max="90" value="0"
                                        step="1"><span data-template-id="lightshelf-tilt-int-val"
                                        class="data-value font-mono w-12 text-left">0</span></div>
                            </div>
                            <div><label class="label" data-template-for="lightshelf-depth-int">Depth (m)</label>
                                <div class="flex items-center space-x-3 mt-1"><input type="range"
                                        data-template-id="lightshelf-depth-int" min="0" max="2.0" value="0.5"
                                        step="0.1"><span data-template-id="lightshelf-depth-int-val"
                                        class="data-value font-mono w-12 text-left">0.5m</span></div>
                            </div>
                            <div><label class="label" data-template-for="lightshelf-thick-int">Thickness (m)</label>
                                <div class="flex items-center space-x-3 mt-1"><input type="range"
                                        data-template-id="lightshelf-thick-int" min="0.005" max="0.5" value="0.05"
                                        step="0.005"><span data-template-id="lightshelf-thick-int-val"
                                        class="data-value font-mono w-12 text-left">0.050m</span></div>
                            </div>
                        </div>
                    </div>
                    <div data-template-id="shading-controls-louver"
                        class="hidden space-y-4 pt-4 border-t border-[--grid-color]">
                        <div><label class="label">Placement</label>
                            <div class="btn-group mt-1"><button data-template-id="louver-placement-ext"
                                    class="btn active">Exterior</button><button data-template-id="louver-placement-int"
                                    class="btn">Interior</button></div>
                        </div>
                        <div><label class="label" data-template-for="louver-slat-orientation">Slat
                                Orientation</label><select data-template-id="louver-slat-orientation"
                                class="w-full mt-1">
                                <option value="horizontal" selected>Horizontal</option>
                                <option value="vertical">Vertical</option>
                            </select></div>
                        <div><label class="label" data-template-for="louver-slat-width">Slat Width (m)</label>
                            <div class="flex items-center space-x-3 mt-1"><input type="range"
                                    data-template-id="louver-slat-width" min="0.01" max="1.0" value="0.1"
                                    step="0.01"><span data-template-id="louver-slat-width-val"
                                    class="data-value font-mono w-12 text-left">0.10m</span></div>
                        </div>
                        <div><label class="label" data-template-for="louver-slat-sep">Slat Separation (m)</label>
                            <div class="flex items-center space-x-3 mt-1"><input type="range"
                                    data-template-id="louver-slat-sep" min="0.0" max="0.5" value="0.05"
                                    step="0.01"><span data-template-id="louver-slat-sep-val"
                                    class="data-value font-mono w-12 text-left">0.05m</span></div>
                        </div>
                        <div><label class="label" data-template-for="louver-slat-thick">Slat Thickness (m)</label>
                            <div class="flex items-center space-x-3 mt-1"><input type="range"
                                    data-template-id="louver-slat-thick" min="0.0" max="0.5" value="0.01"
                                    step="0.005"><span data-template-id="louver-slat-thick-val"
                                    class="data-value font-mono w-12 text-left">0.01m</span></div>
                        </div>
                        <div><label class="label" data-template-for="louver-slat-angle">Slat Angle ()</label>
                            <div class="flex items-center space-x-3 mt-1"><input type="range"
                                    data-template-id="louver-slat-angle" min="-90" max="90" value="0" step="1"><span
                                    data-template-id="louver-slat-angle-val"
                                    class="data-value font-mono w-12 text-left">0</span></div>
                        </div>
                        <div><label class="label" data-template-for="louver-dist-to-glass">Blind to Glass Distance
                                (m)</label>
                            <div class="flex items-center space-x-3 mt-1"><input type="range"
                                    data-template-id="louver-dist-to-glass" min="0.0" max="1.0" value="0.1"
                                    step="0.01"><span data-template-id="louver-dist-to-glass-val"
                                    class="data-value font-mono w-12 text-left">0.10m</span></div>
                        </div>
                    </div>
                    <div data-template-id="shading-controls-imported_obj"
                        class="hidden space-y-4 pt-4 border-t border-[--grid-color]">
                        <div>
                            <label class="label" data-template-for="shading-obj-file">OBJ File (.obj)</label>
                            <input type="file" data-template-id="shading-obj-file" accept=".obj" class="w-full text-sm">
                            <span data-file-display-for-id="shading-obj-file"
                                class="text-xs text-[--text-secondary] truncate block mt-1">No file selected.</span>
                        </div>
                        <h4 class="font-semibold text-xs uppercase text-[--text-secondary] pt-2">Transform</h4>
                        <div>
                            <label class="label text-xs">Position (X, Y, Z)</label>
                            <div class="grid grid-cols-3 gap-2 mt-1">
                                <input type="number" data-template-id="shading-obj-pos-x" value="0" step="0.1"
                                    class="param-input-num">
                                <input type="number" data-template-id="shading-obj-pos-y" value="0" step="0.1"
                                    class="param-input-num">
                                <input type="number" data-template-id="shading-obj-pos-z" value="0" step="0.1"
                                    class="param-input-num">
                            </div>
                        </div>
                        <div>
                            <label class="label text-xs">Rotation ()</label>
                            <div class="grid grid-cols-3 gap-2 mt-1">
                                <input type="number" data-template-id="shading-obj-rot-x" value="0" step="1"
                                    class="param-input-num">
                                <input type="number" data-template-id="shading-obj-rot-y" value="0" step="1"
                                    class="param-input-num">
                                <input type="number" data-template-id="shading-obj-rot-z" value="0" step="1"
                                    class="param-input-num">
                            </div>
                        </div>
                        <div>
                            <label class="label text-xs">Scale</label>
                            <div class="grid grid-cols-3 gap-2 mt-1">
                                <input type="number" data-template-id="shading-obj-scale-x" value="1" step="0.05"
                                    class="param-input-num">
                                <input type="number" data-template-id="shading-obj-scale-y" value="1" step="0.05"
                                    class="param-input-num">
                                <input type="number" data-template-id="shading-obj-scale-z" value="1" step="0.05"
                                    class="param-input-num">
                            </div>
                        </div>
                        <p class="info-box !text-xs !py-2 !px-3">Click the imported object in the 3D view to use the
                            transform gizmo for interactive placement.</p>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <input type="file" id="custom-asset-importer" class="hidden" accept=".obj,.mtl" multiple>

    <div id="panel-templates">
        <template id="template-recipe-illuminance">
            <div class="floating-window ui-panel">
                <div class="window-header">
                    <span>Recipe: Illuminance Map</span>
                    <div class="window-controls">
                        <div class="window-icon-max"></div>
                        <div class="collapse-icon"></div>
                        <div class="window-icon-close"></div>
                    </div>
                </div>
                <div class="window-content">
                    <div class="param-section">
                        <h4>Sky Definition (gensky)</h4>
                        <p class="info-box !mb-4">Define the sky for a specific moment. Location is taken from the
                            Project Setup panel.</p>
                        <div class="grid grid-cols-3 gap-4">
                            <div><label for="pit-month" class="label">Month</label><input type="number" id="pit-month"
                                    min="1" max="12" value="6" autocomplete="off"></div>
                            <div><label for="pit-day" class="label">Day</label><input type="number" id="pit-day" min="1"
                                    max="31" value="21" autocomplete="off"></div>
                            <div><label for="pit-time" class="label">Time (HH:MM)</label><input type="time"
                                    id="pit-time" value="14:30" autocomplete="off"></div>
                        </div>
                    </div>
                    <div class="param-section">
                        <label for="quality-preset" class="label">Quality Preset</label>
                        <select id="quality-preset" class="w-full mt-1">
                            <option value="draft">Draft (Fast)</option>
                            <option value="medium" selected>Medium (Balanced)</option>
                            <option value="high">High (Accurate)</option>
                            <option value="custom">Custom</option>
                        </select>
                    </div>

                    <div class="param-section">
                        <h4 class="text-base font-semibold">Grid-Based Illuminance (rtrace)</h4>
                        <p class="info-box">Calculates illuminance or irradiance values on a sensor grid. Uses global
                            simulation parameters for the calculation.</p>
                        <div class="param-section" autocomplete="off">
                            <h5 autocomplete="off">Calculation Mode &amp; Switches</h5>
                            <div class="param-grid-sim mt-2">
                                <div>
                                    <label class="label">Calculation Mode
                                        <span class="info-icon">i<span class="info-popover"><b>-I (Irradiance):</b>
                                                Computes irradiance directly. Input is measurement point and surface
                                                normal.<br><br><b>-i (Illuminance):</b> Computes radiance first, then
                                                converts to illuminance. Input is a ray origin and
                                                direction.</span></span>
                                    </label>
                                    <div class="btn-group"><button id="rtrace-mode-I" class="btn active"
                                            title="-I">Irradiance (-I)</button><button id="rtrace-mode-i" class="btn"
                                            title="-i">Illuminance (-i)</button></div>
                                </div>
                                <div>
                                    <label class="label">General Switches</label>
                                    <div class="space-y-2">
                                        <label class="flex items-center cursor-pointer"><input type="checkbox"
                                                id="rtrace-h"><span class="ml-2 text-sm">Suppress Header
                                                (-h)</span></label>
                                        <label class="flex items-center cursor-pointer"><input type="checkbox"
                                                id="rtrace-w" checked><span class="ml-2 text-sm">Suppress Warnings
                                                (-w)</span></label>
                                        <label class="flex items-center cursor-pointer"><input type="checkbox"
                                                id="rtrace-u"><span class="ml-2 text-sm">Uncorrelated Sampling
                                                (-u)</span></label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                </div>
        </template>

        <template id="template-recipe-rendering">
            <div class="floating-window ui-panel">
                <div class="window-header">
                    <span>Recipe: Photorealistic Rendering</span>
                    <div class="window-controls">
                        <div class="window-icon-max"></div>
                        <div class="collapse-icon"></div>
                        <div class="window-icon-close"></div>
                    </div>
                </div>
                <div class="window-content">
                    <div class="param-section">
                        <h4>Sky Definition (gensky)</h4>
                        <p class="info-box !mb-4">Define the sky for a specific moment. Location is taken from the
                            Project Setup panel.</p>
                        <div class="grid grid-cols-3 gap-4">
                            <div><label for="pit-month" class="label">Month</label><input type="number" id="pit-month"
                                    min="1" max="12" value="6" autocomplete="off"></div>
                            <div><label for="pit-day" class="label">Day</label><input type="number" id="pit-day" min="1"
                                    max="31" value="21" autocomplete="off"></div>
                            <div><label for="pit-time" class="label">Time (HH:MM)</label><input type="time"
                                    id="pit-time" value="14:30" autocomplete="off"></div>
                        </div>
                    </div>
                    <div class="param-section">
                        <label for="quality-preset" class="label">Quality Preset</label>
                        <select id="quality-preset" class="w-full mt-1">
                            <option value="draft">Draft (Fast)</option>
                            <option value="medium" selected>Medium (Balanced)</option>
                            <option value="high">High (Accurate)</option>
                            <option value="custom">Custom</option>
                        </select>
                    </div>

                    <div class="param-section">
                        <h4 class="text-base font-semibold">Image-Based Rendering (rpict)</h4>
                        <p class="info-box">Creates a physically-based image. Uses the view from the 'Viewpoint' panel
                            and quality settings from 'Global Simulation Parameters'. Add or override specific settings
                            below.</p>
                        <div class="accordion-item open">
                            <div class="accordion-header">Image Size &amp; Resolution <div class="accordion-chevron">
                                </div>
                            </div>
                            <div>
                                <div class="param-grid-sim" autocomplete="off">
                                    <div><label class="label" for="rpict-x">X Resolution (-x)</label><input
                                            type="number" id="rpict-x" min="1" value="512" autocomplete="off"></div>
                                    <div><label class="label" for="rpict-y">Y Resolution (-y)</label><input
                                            type="number" id="rpict-y" min="1" value="512" autocomplete="off"></div>
                                    <div><label class="label" for="rpict-pa">Pixel Aspect Ratio (-pa)</label><input
                                            type="number" id="rpict-pa" min="0" value="1.0" step="0.1"
                                            autocomplete="off"></div>
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <div class="accordion-header">Image Sampling &amp; Filtering <div class="accordion-chevron">
                                    </div>
                            </div>
                            <div style="display:none;">
                                <div class="param-grid-sim">
                                    <div class="param-item">
                                        <div class="param-item-row"><label for="rpict-ps" class="label">Pixel Sampling
                                                (-ps)</label><input type="number" class="param-input-num"
                                                id="rpict-ps-num" step="1" min="0" max="48"></div>
                                        <input type="range" id="rpict-ps" min="0" max="48" value="8" step="1">
                                    </div>
                                    <div class="param-item">
                                        <div class="param-item-row"><label for="rpict-pt" class="label">Sampling
                                                Threshold (-pt)</label><input type="number" class="param-input-num"
                                                id="rpict-pt-num" step="0.01" min="0" max="1" autocomplete="off"></div>
                                        <input type="range" id="rpict-pt" min="0" max="1" value="0.05" step="0.01"
                                            autocomplete="off">
                                    </div>
                                    <div class="param-item">
                                        <div class="param-item-row"><label for="rpict-pj" class="label">Pixel Jitter
                                                (-pj)</label><input type="number" class="param-input-num"
                                                id="rpict-pj-num" step="0.1" min="0" max="1" autocomplete="off"></div>
                                        <input type="range" id="rpict-pj" min="0" max="1" value="0.9" step="0.1"
                                            autocomplete="off">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <div class="accordion-header">General Switches<div class="accordion-chevron"></div>
                            </div>
                            <div style="display:none;">
                                <div class="grid grid-cols-2 gap-2 mt-2">
                                    <label class="flex items-center cursor-pointer"><input type="checkbox"
                                            id="rpict-i"><span class="ml-2 text-sm">Compute Irradiance
                                            (-i)</span></label>
                                    <label class="flex items-center cursor-pointer"><input type="checkbox" id="rpict-dv"
                                            checked><span class="ml-2 text-sm">Source Visible (-dv)</span></label>
                                    <label class="flex items-center cursor-pointer"><input type="checkbox"
                                            id="rpict-bv"><span class="ml-2 text-sm">Backface Visible
                                            (-bv)</span></label>
                                    <label class="flex items-center cursor-pointer"><input type="checkbox" id="rpict-w"
                                            checked><span class="ml-2 text-sm">Suppress Warnings (-w)</span></label>
                                </div>
                            </div>
                        </div>

                    </div>
        </template>

        <div id="lighting-energy-dashboard" class="hidden space-y-5 pt-4 border-t border-dashed border-[--grid-color]">
        </div>

        <div id="circadian-metrics-dashboard"
            class="hidden space-y-5 pt-4 border-t border-dashed border-[--grid-color]">
            <h4 class="font-semibold text-xs uppercase text-[--text-secondary]">Circadian Health Metrics</h4>
            <p class="info-box !text-xs !py-2 !px-3">Average metrics from the sensor grid based on the spectral
                simulation. Calculated from <code>circadian_summary.json</code>.</p>
            <div class="grid grid-cols-2 gap-4 text-center items-center">
                <div>
                    <h5 class="font-semibold text-sm">Circadian Stimulus (CS)</h5>
                    <div class="relative w-32 h-16 mx-auto mt-2">
                        <canvas id="cs-gauge"></canvas>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <span id="cs-value" class="data-value font-mono text-2xl">--</span>
                        </div>
                    </div>
                </div>
                <div class="space-y-3 text-left">
                    <div>
                        <h5 class="font-semibold text-sm">EML</h5>
                        <p class="data-value font-mono text-lg"><span id="eml-value">--</span> lux</p>
                    </div>
                    <div>
                        <h5 class="font-semibold text-sm">CCT</h5>
                        <p class="data-value font-mono text-lg"><span id="cct-value">--</span> K</p>
                    </div>
                </div>
            </div>
            <div class="param-section">
                <h5 class="font-semibold text-xs uppercase text-[--text-secondary]">WELL v2 L03 Compliance</h5>
                <ul id="well-compliance-checklist" class="mt-2 space-y-1 text-sm">
                </ul>
            </div>
        </div>

        <template id="template-recipe-dgp">
            <div class="floating-window ui-panel">
                <div class="window-header">
                    <span>Recipe: Daylight Glare Probability (DGP)</span>
                    <div class="window-controls">
                        <div class="window-icon-max"></div>
                        <div class="collapse-icon"></div>
                        <div class="window-icon-close"></div>
                    </div>
                </div>
                <div class="window-content">
                    <div class="param-section">
                        <h4>Sky Definition (gensky)</h4>
                        <p class="info-box !mb-4">Define the sky for a specific moment. Location is taken from the
                            Project Setup panel.</p>
                        <div class="grid grid-cols-3 gap-4">
                            <div><label for="pit-month" class="label">Month</label><input type="number" id="pit-month"
                                    min="1" max="12" value="6" autocomplete="off"></div>
                            <div><label for="pit-day" class="label">Day</label><input type="number" id="pit-day" min="1"
                                    max="31" value="21" autocomplete="off"></div>
                            <div><label for="pit-time" class="label">Time (HH:MM)</label><input type="time"
                                    id="pit-time" value="14:30" autocomplete="off"></div>
                        </div>
                    </div>
                    <div class="param-section">
                        <label for="quality-preset" class="label">Quality Preset</label>
                        <select id="quality-preset" class="w-full mt-1">
                            <option value="draft">Draft (Fast)</option>
                            <option value="medium" selected>Medium (Balanced)</option>
                            <option value="high">High (Accurate)</option>
                            <option value="custom">Custom</option>
                        </select>
                    </div>

                    <div class="param-section">
                        <h4 class="text-base font-semibold">Daylight Glare Probability (evalglare)</h4>
                        <p class="info-box">Calculates glare from a 180 fisheye image. For accurate results, use
                            high-quality rendering parameters. Viewpoint must be set to fisheye.</p>
                        <div class="param-section">
                            <label class="flex items-center cursor-pointer">
                                <input type="checkbox" id="evalglare-t">
                                <span class="ml-3 label !text-gray-600 !uppercase-none !font-normal">Define Task Area
                                    (-t)<span class="info-icon">i<span class="info-popover">Defines a task area on the
                                            image to automatically determine the glare threshold based on the average
                                            luminance within that area. This is the recommended
                                            method.</span></span></span>
                            </label>
                        </div>
                        <div class="param-section">
                            <h5>Verification &amp; Output</h5>
                            <div class="space-y-3 mt-2">
                                <label class="flex items-center cursor-pointer"><input type="checkbox" id="evalglare-c"
                                        checked><span
                                        class="ml-3 label !text-gray-600 !uppercase-none !font-normal">Create Check File
                                        (-c)<span class="info-icon">i<span class="info-popover">Generates a visual check
                                                image (e.g., check.hdr) with detected glare sources highlighted.
                                                Invaluable for verification.</span></span></span></label>
                                <label class="flex items-center cursor-pointer"><input type="checkbox" id="evalglare-d"
                                        checked><span
                                        class="ml-3 label !text-gray-600 !uppercase-none !font-normal">Detailed Output
                                        (-d)<span class="info-icon">i<span class="info-popover">Produces detailed
                                                output, listing the properties of each individual glare source
                                                found.</span></span></span></label>
                            </div>
                        </div>
                    </div>

                </div>
        </template>

        <template id="template-recipe-df">
            <div class="floating-window ui-panel">
                <div class="window-header">
                    <span>Recipe: Daylight Factor</span>
                    <div class="window-controls">
                        <div class="window-icon-max"></div>
                        <div class="collapse-icon"></div>
                        <div class="window-icon-close"></div>
                    </div>
                </div>
                <div class="window-content">
                    <div class="param-section">
                        <label for="quality-preset" class="label">Quality Preset</label>
                        <select id="quality-preset" class="w-full mt-1">
                            <option value="draft">Draft (Fast)</option>
                            <option value="medium" selected>Medium (Balanced)</option>
                            <option value="high">High (Accurate)</option>
                            <option value="custom">Custom</option>
                        </select>
                    </div>

                    <div class="param-section">
                        <h4 class="text-base font-semibold">Daylight Factor</h4>
                        <p class="info-box">Calculates Daylight Factor. A standard calculation uses a CIE Overcast Sky,
                            but other types are available for non-standard analysis.</p>
                        <div class="param-section">
                            <h5>gensky Parameters for DF</h5>
                            <div class="param-grid-sim mt-2">
                                <div>
                                    <label class="label" for="df-sky-type">Sky Type</label>
                                    <select id="df-sky-type" class="w-full mt-1">
                                        <option value="-c" selected>Overcast (-c)</option>
                                        <option value="+s">Sunny w/ Sun (+s)</option>
                                        <option value="-s">Sunny w/o Sun (-s)</option>
                                        <option value="+i">Intermediate w/ Sun (+i)</option>
                                        <option value="-i">Intermediate w/o Sun (-i)</option>
                                        <option value="-u">Uniform (-u)</option>
                                    </select>
                                </div>
                                <div class="param-item">
                                    <div class="param-item-row">
                                        <label for="df-ground-refl" class="label">Ground Reflectance (-g)</label>
                                        <input type="number" class="param-input-num" id="df-ground-refl-num" step="0.01"
                                            min="0" max="1" autocomplete="off">
                                    </div>
                                    <input type="range" id="df-ground-refl" min="0" max="1" value="0.2" step="0.01"
                                        autocomplete="off">
                                </div>
                            </div>
                            <div class="param-grid-sim mt-4">
                                <div class="param-item">
                                    <div class="param-item-row">
                                        <label for="df-irrad" class="label">Diffuse Horizontal Irradiance (-B)
                                            <span class="info-icon">i<span class="info-popover">To achieve a standard
                                                    outdoor illuminance of 10,000 lux for DF calculations, a horizontal
                                                    irradiance of <b>55.866 W/m</b> is used with a CIE Overcast Sky.
                                                    This may not apply to other sky types.</span></span>
                                        </label>
                                        <input type="number" class="param-input-num" id="df-irrad-num" step="0.001"
                                            min="0" max="200" autocomplete="off">
                                    </div>
                                    <input type="range" id="df-irrad" min="0" max="200" value="55.866" step="0.001"
                                        autocomplete="off">
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
        </template>

        <template id="template-recipe-annual-3ph">
            <div class="floating-window ui-panel">
                <div class="window-header">
                    <span>Recipe: Annual Daylight (3-Phase)</span>
                    <div class="window-controls">
                        <div class="window-icon-max"></div>
                        <div class="collapse-icon"></div>
                        <div class="window-icon-close"></div>
                    </div>
                </div>
                <div class="window-content">
                    <div class="param-section">
                        <label for="quality-preset" class="label">Quality Preset</label>
                        <select id="quality-preset" class="w-full mt-1">
                            <option value="draft">Draft (Fast)</option>
                            <option value="medium" selected>Medium (Balanced)</option>
                            <option value="high">High (Accurate)</option>
                            <option value="custom">Custom</option>
                        </select>
                    </div>
                    <div class="param-section">
                        <h4 class="text-base font-semibold">Three-Phase Method Parameters (V T D S)</h4>
                        <p class="info-box">Decouples the light path into View (V), Transmission (T), Daylight (D) and
                            Sky (S) matrices. </p>
                        <div class="param-section mt-4">
                            <h5 class="font-semibold text-xs uppercase text-[--text-secondary]">Phase 1: Sky Matrix (S)
                                - gendaymtx</h5>
                            <div><label class="label" for="weather-file">Weather File (.epw)</label><input type="file"
                                    id="weather-file" accept=".epw" class="w-full text-sm"></div>
                        </div>
                        <div class="param-section mt-4">
                            <h5 class="font-semibold text-xs uppercase text-[--text-secondary]">Phase 2: Transmission
                                (T) - genBSDF</h5>
                            <div><label class="label" for="bsdf-file">BSDF File (.xml)</label><input type="file"
                                    id="bsdf-file" accept=".xml" class="w-full text-sm"></div>
                        </div>
                        <div class="param-section mt-4">
                            <h5 class="font-semibold text-xs uppercase text-[--text-secondary]">Phase 3: V & D Matrices
                                - rcontrib</h5>
                            <p class="info-box !text-xs !py-2 !px-3">These are computationally intensive steps. Ambient
                                parameters from the Advanced section will be used.</p>
                        </div>
                    </div>

                </div>
        </template>

        <template id="template-recipe-annual-5ph">
            <div class="floating-window ui-panel">
                <div class="window-header">
                    <span>Recipe: Annual Daylight (5-Phase)</span>
                    <div class="window-controls">
                        <div class="window-icon-max"></div>
                        <div class="collapse-icon"></div>
                        <div class="window-icon-close"></div>
                    </div>
                </div>
                <div class="window-content">
                    <div class="param-section">
                        <label for="quality-preset" class="label">Quality Preset</label>
                        <select id="quality-preset" class="w-full mt-1">
                            <option value="draft">Draft (Fast)</option>
                            <option value="medium" selected>Medium (Balanced)</option>
                            <option value="high">High (Accurate)</option>
                            <option value="custom">Custom</option>
                        </select>
                    </div>
                    <div class="param-section">
                        <h4 class="text-base font-semibold">Five-Phase Method Parameters</h4>
                        <p class="info-box">Extends the 3-Phase method for higher accuracy with complex fenestration by
                            precisely modeling direct sun. Provide the core weather and BSDF files below.</p>
                        <div class="param-section mt-4">
                            <h5 class="font-semibold text-xs uppercase text-[--text-secondary]">Required User Inputs
                            </h5>
                            <p class="info-box !text-xs !py-2 !px-3 !mb-3">Specify the paths to the core input files.
                                All other matrices will be generated by the script.</p>
                            <div class="space-y-3">
                                <div><label class="label" for="weather-file">Weather File (.epw)</label><input
                                        type="file" id="weather-file" accept=".epw" class="w-full text-sm"></div>
                                <div><label class="label" for="bsdf-klems">Klems BSDF (T)</label><input type="file"
                                        id="bsdf-klems" accept=".xml" class="w-full text-sm"></div>
                                <div><label class="label" for="bsdf-tensor">Tensor Tree BSDF (for Cds)</label><input
                                        type="file" id="bsdf-tensor" accept=".xml" class="w-full text-sm"></div>
                            </div>
                        </div>
                    </div>
                </div>
        </template>

        <template id="template-recipe-imageless-glare">
            <div class="floating-window ui-panel">
                <div class="window-header">
                    <span>Recipe: Imageless Annual Glare</span>
                    <div class="window-controls">
                        <div class="window-icon-max"></div>
                        <div class="collapse-icon"></div>
                        <div class="window-icon-close"></div>
                    </div>
                </div>
                <div class="window-content">
                    <div class="param-section">
                        <p class="info-box">This recipe requires a "View Grid" to be defined in the Sensor Grid panel.
                        </p>
                        <label for="quality-preset" class="label">Quality Preset</label>
                        <select id="quality-preset" class="w-full mt-1">
                            <option value="draft">Draft (Fast)</option>
                            <option value="medium" selected>Medium (Balanced)</option>
                            <option value="high">High (Accurate)</option>
                            <option value="custom">Custom</option>
                        </select>
                    </div>
                    <div class="param-section space-y-3">
                        <div><label class="label" for="weather-file">Weather File (.epw)</label><input type="file"
                                id="weather-file" accept=".epw" class="w-full text-sm"></div>
                        <div><label class="label" for="bsdf-open-file">BSDF - Blinds Open (.xml)</label><input
                                type="file" id="bsdf-open-file" accept=".xml" class="w-full text-sm"></div>
                        <div><label class="label" for="bsdf-closed-file">BSDF - Blinds Closed (.xml)</label><input
                                type="file" id="bsdf-closed-file" accept=".xml" class="w-full text-sm"></div>
                    </div>
                </div>
                <div class="param-section">
                    <h4 class="text-base font-semibold">Blind Operation Parameters</h4>
                    <div class="grid grid-cols-2 gap-4">
                        <div><label class="label" for="blinds-threshold-lux">Illuminance Threshold (lux)</label><input
                                type="number" id="blinds-threshold-lux" value="1000" min="0" step="50"
                                class="w-full mt-1"></div>
                        <div><label class="label" for="blinds-trigger-percent">Area Trigger (%)</label><input
                                type="number" id="blinds-trigger-percent" value="2" min="0" max="100" step="1"
                                class="w-full mt-1" autocomplete="off"></div>
                    </div>
                </div>
            </div>
            <div class="resize-handle-edge top"></div>
            <div class="resize-handle-edge right"></div>
            <div class="resize-handle-edge bottom"></div>
            <div class="resize-handle-edge left"></div>
            <div class="resize-handle-corner top-left"></div>
            <div class="resize-handle-corner top-right"></div>
            <div class="resize-handle-corner bottom-left"></div>
            <div class="resize-handle-corner bottom-right"></div>
        </template>

        <template id="template-recipe-en17037">
            <div class="floating-window ui-panel">
                <div class="window-header">
                    <span>Recipe: EN 17037 Compliance Check</span>
                    <div class="window-controls">
                        <div class="window-icon-max"></div>
                        <div class="collapse-icon"></div>
                        <div class="window-icon-close"></div>
                    </div>
                </div>
                <div class="window-content">
                    <p class="info-box">This recipe runs the necessary simulations to check for compliance with the four
                        pillars of the EN 17037 daylighting standard.</p>

                    <div class="param-section">
                        <label for="en17037-provision-toggle" class="flex items-center cursor-pointer w-full">
                            <input type="checkbox" id="en17037-provision-toggle" checked>
                            <h4 class="ml-3 font-semibold text-sm uppercase">1. Daylight Provision</h4>
                        </label>
                        <div id="en17037-provision-controls"
                            class="space-y-3 pt-2 mt-2 border-t border-dashed border-[--grid-color]">
                            <p class="text-xs text-gray-400">Uses Climate-Based Method 2. Requires an annual simulation.
                            </p>
                            <div>
                                <label for="en17037-provision-level" class="label">Target Performance Level</label>
                                <select id="en17037-provision-level" class="w-full mt-1">
                                    <option value="minimum" selected>Minimum</option>
                                    <option value="medium">Medium</option>
                                    <option value="high">High</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="param-section">
                        <label for="en17037-sunlight-toggle" class="flex items-center cursor-pointer w-full">
                            <input type="checkbox" id="en17037-sunlight-toggle" checked>
                            <h4 class="ml-3 font-semibold text-sm uppercase">2. Exposure to Sunlight</h4>
                        </label>
                        <div id="en17037-sunlight-controls"
                            class="space-y-3 pt-2 mt-2 border-t border-dashed border-[--grid-color]">
                            <p class="text-xs text-gray-400">Checks for direct sun access on a specific day.</p>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label for="en17037-sunlight-date" class="label text-xs">Reference Day</label>
                                    <input type="text" id="en17037-sunlight-date" class="w-full mt-1 flatpickr-input"
                                        placeholder="Select date...">
                                </div>
                                <div>
                                    <label for="en17037-sunlight-level" class="label text-xs">Target Duration</label>
                                    <select id="en17037-sunlight-level" class="w-full mt-1">
                                        <option value="minimum" selected>Minimum (1.5 hours)</option>
                                        <option value="medium">Medium (3.0 hours)</option>
                                        <option value="high">High (4.0 hours)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="param-section">
                        <label for="en17037-view-toggle" class="flex items-center cursor-pointer w-full">
                            <input type="checkbox" id="en17037-view-toggle" checked>
                            <h4 class="ml-3 font-semibold text-sm uppercase">3. View Out</h4>
                        </label>
                        <div id="en17037-view-controls"
                            class="space-y-3 pt-2 mt-2 border-t border-dashed border-[--grid-color]">
                            <p class="text-xs text-gray-400">Generates a fisheye image for manual verification of view
                                quality (Horizontal Sight Angle, Layers, etc.).</p>
                            <label for="en17037-view-factor-toggle"
                                class="flex items-center cursor-pointer w-full !text-xs !text-gray-400 mt-2">
                                <input type="checkbox" id="en17037-view-factor-toggle">
                                <span class="ml-3 label !text-gray-400 !uppercase-none !font-normal">Also run
                                    quantitative View Factor calculation</span>
                            </label>
                            <div class="pt-2">
                                <label for="en17037-view-level" class="label">Target Performance Level</label>
                                <select id="en17037-view-level" class="w-full mt-1">
                                    <option value="minimum" selected>Minimum</option>
                                    <option value="medium">Medium</option>
                                    <option value="high">High</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="param-section">
                        <label for="en17037-glare-toggle" class="flex items-center cursor-pointer w-full">
                            <input type="checkbox" id="en17037-glare-toggle" checked>
                            <h4 class="ml-3 font-semibold text-sm uppercase">4. Protection from Glare</h4>
                        </label>
                        <div id="en17037-glare-controls"
                            class="space-y-3 pt-2 mt-2 border-t border-dashed border-[--grid-color]">
                            <p class="text-xs text-gray-400">Uses imageless annual DGP. Requires a 'View Grid' to be
                                defined.</p>
                            <div>
                                <label for="en17037-glare-level" class="label">Target Performance Level</label>
                                <select id="en17037-glare-level" class="w-full mt-1">
                                    <option value="minimum" selected>Minimum (DGP  0.45)</option>
                                    <option value="medium">Medium (DGP  0.40)</option>
                                    <option value="high">High (DGP  0.35)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
        </template>

        <template id="template-recipe-en-illuminance">
            <div class="floating-window ui-panel">
                <div class="window-header">
                    <span>Recipe: EN 12464-1 Illuminance</span>
                    <div class="window-controls">
                        <div class="window-icon-max"></div>
                        <div class="collapse-icon"></div>
                        <div class="window-icon-close"></div>
                    </div>
                </div>
                <div class="window-content">
                    <p class="info-box">Verifies maintained illuminance ($E_m$) and uniformity ($U_0$) on the Task and
                        Surrounding grids defined in the Sensor Grid panel.</p>
                    <div class="param-section">
                        <label for="quality-preset" class="label">Calculation Quality</label>
                        <select id="quality-preset" class="w-full mt-1">
                            <option value="draft">Draft (Fast)</option>
                            <option value="medium">Medium (Balanced)</option>
                            <option value="high" selected>Compliance (High Quality)</option>
                            <option value="custom">Custom</option>
                        </select>
                    </div>
                    <div class="accordion-item mt-4 pt-4 border-t border-dashed border-[--grid-color]">
                        <div class="accordion-header">Advanced Parameters (Overrides)<div class="accordion-chevron">
                            </div>
                        </div>
                        <div class="accordion-content" style="display: none;"></div>
                    </div>
                    <div class="execution-section mt-4 pt-4 border-t-2 border-[--grid-color]">
                        <button data-action="generate" class="btn btn-primary w-full">Generate Illuminance Check
                            Package</button>
                    </div>
                </div>
                <div class="resize-handle-edge top"></div>
                <div class="resize-handle-edge right"></div>
                <div class="resize-handle-edge bottom"></div>
                <div class="resize-handle-edge left"></div>
                <div class="resize-handle-corner top-left"></div>
                <div class="resize-handle-corner top-right"></div>
                <div class="resize-handle-corner bottom-left"></div>
                <div class="resize-handle-corner bottom-right"></div>
            </div>
        </template>

        <template id="template-recipe-lighting-energy">
            <div class="floating-window ui-panel">
                <div class="window-header">
                    <span>Recipe: Lighting Energy Analysis</span>
                    <div class="window-controls">
                        <div class="window-icon-max"></div>
                        <div class="collapse-icon"></div>
                        <div class="window-icon-close"></div>
                    </div>
                </div>
                <div class="window-content">
                    <p class="info-box">Runs an annual simulation using daylighting controls to estimate electric
                        lighting energy usage and savings. This requires the same inputs as the sDA/ASE recipe.</p>
                    <div class="param-section">
                        <h4 class="text-base font-semibold">Simulation Inputs</h4>
                        <div class="space-y-3 mt-4">
                            <div><label class="label" for="weather-file">Weather File (.epw)</label><input type="file"
                                    id="weather-file" accept=".epw" class="w-full text-sm"></div>
                            <div><label class="label" for="bsdf-open-file">BSDF - Blinds Open (.xml)</label><input
                                    type="file" id="bsdf-open-file" accept=".xml" class="w-full text-sm"></div>
                            <div><label class="label" for="bsdf-closed-file">BSDF - Blinds Closed (.xml)</label><input
                                    type="file" id="bsdf-closed-file" accept=".xml" class="w-full text-sm"></div>
                        </div>
                    </div>
                    <div class="param-section">
                        <h4 class="text-base font-semibold">Blind Operation Parameters</h4>
                        <div class="grid grid-cols-2 gap-4">
                            <div><label class="label" for="blinds-threshold-lux">Illuminance Threshold
                                    (lux)</label><input type="number" id="blinds-threshold-lux" value="1000" min="0"
                                    step="50" class="w-full mt-1" autocomplete="off"></div>
                            <div><label class="label" for="blinds-trigger-percent">Area Trigger (%)</label><input
                                    type="number" id="blinds-trigger-percent" value="2" min="0" max="100" step="1"
                                    class="w-full mt-1" autocomplete="off"></div>
                        </div>
                    </div>
                    <div class="execution-section mt-4 pt-4 border-t-2 border-[--grid-color]">
                        <h4 class="text-base font-semibold mb-3">Execution</h4>
                        <button data-action="generate" class="btn btn-primary w-full">Generate Energy Analysis
                            Package</button>
                    </div>
                </div>
                <div class="resize-handle-edge top"></div>
                <div class="resize-handle-edge right"></div>
                <div class="resize-handle-edge bottom"></div>
                <div class="resize-handle-edge left"></div>
                <div class="resize-handle-corner top-left"></div>
                <div class="resize-handle-corner top-right"></div>
                <div class="resize-handle-corner bottom-left"></div>
                <div class="resize-handle-corner bottom-right"></div>
            </div>
        </template>

        <template id="template-recipe-facade-irradiation">
            <div class="floating-window ui-panel">
                <div class="window-header">
                    <span>Recipe: Faade Irradiation Analysis</span>
                    <div class="window-controls">
                        <div class="window-icon-max"></div>
                        <div class="collapse-icon"></div>
                        <div class="window-icon-close"></div>
                    </div>
                </div>
                <div class="window-content">
                    <p class="info-box">Calculates the total annual solar irradiation (kWh/m/year) on a vertical
                        surface placed in front of a selected faade, accounting for shading from the building itself
                        and any attached shading devices.</p>

                    <div class="param-section">
                        <h4 class="text-base font-semibold">Analysis Plane & Grid</h4>
                        <div class="space-y-3 mt-4">
                            <div>
                                <label for="facade-selection" class="label">Target Faade</label>
                                <select id="facade-selection" class="w-full mt-1">
                                    <option value="S" selected>South</option>
                                    <option value="N">North</option>
                                    <option value="E">East</option>
                                    <option value="W">West</option>
                                </select>
                            </div>
                            <div class="param-item">
                                <div class="param-item-row">
                                    <label for="facade-offset" class="label">Offset from Faade (m)</label>
                                    <input type="number" class="param-input-num" id="facade-offset-num" step="0.05"
                                        min="0" max="5" autocomplete="off">
                                </div>
                                <input type="range" id="facade-offset" min="0" max="5" value="0.05" step="0.05"
                                    autocomplete="off">
                            </div>
                            <div class="param-item">
                                <div class="param-item-row">
                                    <label for="facade-grid-spacing" class="label">Grid Spacing (m)</label>
                                    <input type="number" class="param-input-num" id="facade-grid-spacing-num" step="0.1"
                                        min="0.1" max="5" autocomplete="off">
                                </div>
                                <input type="range" id="facade-grid-spacing" min="0.1" max="5" value="0.5" step="0.1"
                                    autocomplete="off">
                            </div>
                        </div>
                    </div>

                    <div class="param-section">
                        <h4 class="text-base font-semibold">Required Inputs</h4>
                        <div class="space-y-3 mt-4">
                            <div>
                                <label class="label" for="weather-file">Weather File (.epw)</label>
                                <input type="file" id="weather-file" accept=".epw" class="w-full text-sm">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="execution-section mt-4 pt-4 border-t-2 border-[--grid-color]">
                    <button data-action="generate" class="btn btn-primary w-full">Generate Irradiation Analysis
                        Package</button>
                </div>
            </div>
        </template>

        <template id="template-recipe-en-ugr">
            <div class="floating-window ui-panel">
                <div class="window-header">
                    <span>Recipe: EN 12464-1 UGR</span>
                    <div class="window-controls">
                        <div class="window-icon-max"></div>
                        <div class="collapse-icon"></div>
                        <div class="window-icon-close"></div>
                    </div>
                </div>
                <div class="window-content">
                    <p class="info-box">Calculates the Unified Glare Rating (UGR) from the observer position defined in
                        the Viewpoint panel.</p>
                    <div class="param-section">
                        <div><label for="ugr-limit" class="label">UGR Limit ($UGR_L$)</label><input type="number"
                                id="ugr-limit" value="19" min="0" step="1" class="w-full mt-1" autocomplete="off"></div>
                    </div>
                    <div class="param-section">
                        <label for="quality-preset" class="label">Calculation Quality</label>
                        <select id="quality-preset" class="w-full mt-1">
                            <option value="draft">Draft (Fast)</option>
                            <option value="medium">Medium (Balanced)</option>
                            <option value="high" selected>Compliance (High Quality)</option>
                            <option value="custom">Custom</option>
                        </select>
                    </div>
                </div>
        </template>

        <template id="template-recipe-facade-irradiation">
            <div class="floating-window ui-panel">
                <div class="window-header">
                    <span>Recipe: Faade Irradiation Analysis</span>
                    <div class="window-controls">
                        <div class="window-icon-max"></div>
                        <div class="collapse-icon"></div>
                        <div class="window-icon-close"></div>
                    </div>
                </div>
                <div class="window-content">
                    <p class="info-box">Calculates the total annual solar irradiation (kWh/m/year) on a vertical
                        surface placed in front of a selected faade, accounting for shading from the building itself
                        and any attached shading devices.</p>

                    <div class="param-section">
                        <h4 class="text-base font-semibold">Analysis Plane & Grid</h4>
                        <div class="space-y-3 mt-4">
                            <div>
                                <label for="facade-selection" class="label">Target Faade</label>
                                <select id="facade-selection" class="w-full mt-1">
                                    <option value="S" selected>South</option>
                                    <option value="N">North</option>
                                    <option value="E">East</option>
                                    <option value="W">West</option>
                                </select>
                            </div>
                            <div class="param-item">
                                <div class="param-item-row">
                                    <label for="facade-offset" class="label">Offset from Faade (m)</label>
                                    <input type="number" class="param-input-num" id="facade-offset-num" step="0.05"
                                        min="0" max="5" autocomplete="off">
                                </div>
                                <input type="range" id="facade-offset" min="0" max="5" value="0.05" step="0.05"
                                    autocomplete="off">
                            </div>
                            <div class="param-item">
                                <div class="param-item-row">
                                    <label for="facade-grid-spacing" class="label">Grid Spacing (m)</label>
                                    <input type="number" class="param-input-num" id="facade-grid-spacing-num" step="0.1"
                                        min="0.1" max="5" autocomplete="off">
                                </div>
                                <input type="range" id="facade-grid-spacing" min="0.1" max="5" value="0.5" step="0.1"
                                    autocomplete="off">
                            </div>
                        </div>
                    </div>

                    <div class="param-section">
                        <h4 class="text-base font-semibold">Required Inputs</h4>
                        <div class="space-y-3 mt-4">
                            <div>
                                <label class="label" for="weather-file">Weather File (.epw)</label>
                                <input type="file" id="weather-file" accept=".epw" class="w-full text-sm">
                            </div>
                        </div>
                    </div>
                </div>
        </template>

        <template id="template-recipe-annual-radiation">
            <div class="floating-window ui-panel">
                <div class="window-header">
                    <span>Recipe: Annual Solar Radiation</span>
                    <div class="window-controls">
                        <div class="window-icon-max"></div>
                        <div class="collapse-icon"></div>
                        <div class="window-icon-close"></div>
                    </div>
                </div>
                <div class="window-content">
                    <p class="info-box">Calculates the total annual solar radiation (kWh/m/year) on interior surfaces,
                        including the effect of shading devices. Ensure you have enabled sensor grids on the desired
                        surfaces (e.g., floor, walls) in the Sensor Grid panel.</p>
                    <div class="param-section">
                        <label for="quality-preset" class="label">Calculation Quality</label>
                        <select id="quality-preset" class="w-full mt-1">
                            <option value="draft">Draft (Fast)</option>
                            <option value="medium" selected>Medium (Balanced)</option>
                            <option value="high">High (Accurate)</option>
                            <option value="custom">Custom</option>
                        </select>
                    </div>
                    <div class="param-section space-y-3">
                        <div>
                            <label class="label" for="weather-file">Weather File (.epw)</label>
                            <input type="file" id="weather-file" accept=".epw" class="w-full text-sm">
                        </div>
                    </div>
                </div>
        </template>

    </div>

    <div id="bsdf-viewer-panel" class="floating-window ui-panel hidden" style="width: 500px; height: 650px;">
        <div class="window-header">
            <span>BSDF Viewer</span>
            <div class="window-controls">
                <div class="window-icon-max"></div>
                <div class="collapse-icon"></div>
                <div class="window-icon-close"></div>
            </div>
        </div>
        <div class="window-content !p-4 flex flex-col">
            <div class="param-section">
                <div id="bsdf-info-display" class="info-box !text-xs !py-2 !px-3 mb-4">Loading BSDF data...</div>
                <label for="bsdf-incident-angle-select" class="label">Incident Angle (Theta, Phi)</label>
                <select id="bsdf-incident-angle-select" class="w-full mt-1"></select>
            </div>
            <div class="relative aspect-square bg-[--grid-color] rounded p-2 mt-4 flex-grow">
                <canvas id="bsdf-polar-plot-canvas"></canvas>
            </div>
        </div>
        <div class="resize-handle-edge top"></div>
        <div class="resize-handle-edge right"></div>
        <div class="resize-handle-edge bottom"></div>
        <div class="resize-handle-edge left"></div>
        <div class="resize-handle-corner top-left"></div>
        <div class="resize-handle-corner top-right"></div>
        <div class="resize-handle-corner bottom-left"></div>
        <div class="resize-handle-corner bottom-right"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script
        src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/",
            "three/examples/jsm/": "https://unpkg.com/three@0.160.0/examples/jsm/"
        }
    }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <script>
        // Minimal non-invasive UI-only mitigation:
        // - Ensure no fields are flagged as password/credential targets
        // - Optionally hide known password manager overlay elements
        (function () {
            const blockSelector = [
                '[data-lastpass]',
                '[data-dashlane]',
                '[data-bitwarden]',
                '[data-keeper]',
                '[data-roboform]',
                '[data-1password]',
                '.password-manager-overlay',
                '.password-suggestion',
                '.autocomplete-suggestion',
                '.password-autofill'
            ].join(',');

            const hideOverlays = () => {
                document.querySelectorAll(blockSelector).forEach((el) => {
                    el.style.display = 'none';
                    el.style.visibility = 'hidden';
                    el.style.opacity = '0';
                    el.style.pointerEvents = 'none';
                });
            };

            const observer = new MutationObserver(() => hideOverlays());
            observer.observe(document.documentElement, {
                childList: true,
                subtree: true
            });

            hideOverlays();
        })();
    </script>

    <script type="module" src="scripts/resultsManager.js"></script>
    <script type="module" src="scripts/annualDashboard.js"></script>



    <script type="module" src="scripts/main.js"></script>
    <script type="module" src="scripts/ai-assistant.js"></script>

    <script>
        (function () {
            const canvas = document.getElementById('glow-canvas');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            let width, height;
            const items = [];

            // Configuration
            const SPACING = 40;
            const RADIUS = 150;
            const SPRING = 0.1;
            const FRICTION = 0.92;

            // Mouse state
            const mouse = { x: -1000, y: -1000 };

            // Helper for color manipulation
            function getThemeColor(dist) {
                // Simple logic to fade from highlight color to grid color based on distance
                const opacity = Math.max(0.1, 1 - (dist / 400));
                const theme = document.documentElement.getAttribute('data-theme');

                // Handle Cyber theme explicitly (Cyan)
                if (theme === 'cyber') {
                    return `rgba(0, 246, 255, ${opacity * 0.6})`;
                }

                // Handle Standard Dark theme (White)
                if (theme === 'dark') {
                    return `rgba(255, 255, 255, ${opacity * 0.5})`;
                }

                // Default for Light and Cafe58 (Dark Grey)
                return `rgba(50, 50, 50, ${opacity * 0.3})`;
            }

            class GridItem {
                constructor(x, y) {
                    this.origin = { x, y };
                    this.pos = { x, y };
                    this.vel = { x: 0, y: 0 };
                    this.target = { x, y };
                }

                update() {
                    // Vector from pos to mouse
                    const dx = this.pos.x - mouse.x;
                    const dy = this.pos.y - mouse.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    const angle = Math.atan2(dy, dx);

                    // Repulsion logic based on the provided snippet
                    // Convert range dist (0 -> RADIUS) to (100 -> 0)
                    let amount = 0;
                    if (dist < RADIUS) {
                        amount = (1 - (dist / RADIUS)) * 50; // Push amount
                    }

                    // Calculate target position (pushed away from origin)
                    this.target.x = this.origin.x + Math.cos(angle) * amount;
                    this.target.y = this.origin.y + Math.sin(angle) * amount;

                    // Spring physics
                    const fx = (this.target.x - this.pos.x) * SPRING;
                    const fy = (this.target.y - this.pos.y) * SPRING;

                    this.vel.x += fx;
                    this.vel.y += fy;
                    this.pos.x += this.vel.x;
                    this.pos.y += this.vel.y;
                    this.vel.x *= FRICTION;
                    this.vel.y *= FRICTION;
                }

                draw() {
                    const dx = this.pos.x - mouse.x;
                    const dy = this.pos.y - mouse.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);

                    ctx.fillStyle = getThemeColor(dist);

                    // Draw "Cross" shape (mimicking the PIXI texture)
                    const size = 12;
                    const thickness = 2;
                    const halfSize = size / 2;
                    const halfThick = thickness / 2;

                    ctx.save();
                    ctx.translate(this.pos.x, this.pos.y);

                    // Rotate slightly based on mouse interaction for extra effect
                    if (dist < RADIUS * 2) {
                        ctx.rotate(Math.atan2(dy, dx));
                    }

                    // Vertical bar
                    ctx.fillRect(-halfThick, -halfSize, thickness, size);
                    // Horizontal bar
                    ctx.fillRect(-halfSize, -halfThick, size, thickness);

                    ctx.restore();
                }
            }

            function init() {
                resize();
                window.addEventListener('resize', resize);
                window.addEventListener('mousemove', e => {
                    mouse.x = e.clientX;
                    mouse.y = e.clientY;
                });

                loop();
            }

            function resize() {
                width = window.innerWidth;
                height = window.innerHeight;
                canvas.width = width;
                canvas.height = height;

                items.length = 0;

                const cols = Math.ceil(width / SPACING) + 2;
                const rows = Math.ceil(height / SPACING) + 2;

                for (let i = 0; i < cols; i++) {
                    for (let j = 0; j < rows; j++) {
                        items.push(new GridItem(i * SPACING, j * SPACING));
                    }
                }
            }

            function loop() {
                ctx.clearRect(0, 0, width, height);
                items.forEach(item => {
                    item.update();
                    item.draw();
                });
                // Only animate if welcome screen is visible
                const welcome = document.getElementById('welcome-screen');
                if (welcome && welcome.style.display !== 'none') {
                    requestAnimationFrame(loop);
                }
            }

            // Initialize
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', init);
            } else {
                init();
            }
        })();
    </script>

</body>